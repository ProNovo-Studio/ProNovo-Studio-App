{
  "version": 3,
  "sources": ["../../../node_modules/.pnpm/molstar@4.18.0_@types+react@18.3.27_fp-ts@2.16.11_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/molstar/lib/mol-util/param-choice.js", "../../../node_modules/.pnpm/molstar@4.18.0_@types+react@18.3.27_fp-ts@2.16.11_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/molstar/lib/extensions/mvs/helpers/atom-ranges.js", "../../../node_modules/.pnpm/molstar@4.18.0_@types+react@18.3.27_fp-ts@2.16.11_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/molstar/lib/extensions/mvs/helpers/indexing.js", "../../../node_modules/.pnpm/molstar@4.18.0_@types+react@18.3.27_fp-ts@2.16.11_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/molstar/lib/extensions/mvs/helpers/param-definition.js", "../../../node_modules/.pnpm/molstar@4.18.0_@types+react@18.3.27_fp-ts@2.16.11_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/molstar/lib/extensions/mvs/helpers/schemas.js", "../../../node_modules/.pnpm/molstar@4.18.0_@types+react@18.3.27_fp-ts@2.16.11_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/molstar/lib/extensions/mvs/helpers/selections.js", "../../../node_modules/.pnpm/molstar@4.18.0_@types+react@18.3.27_fp-ts@2.16.11_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/molstar/lib/extensions/mvs/components/annotation-prop.js", "../../../node_modules/.pnpm/molstar@4.18.0_@types+react@18.3.27_fp-ts@2.16.11_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/molstar/lib/extensions/mvs/components/is-mvs-model-prop.js", "../../../node_modules/.pnpm/molstar@4.18.0_@types+react@18.3.27_fp-ts@2.16.11_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/molstar/lib/extensions/mvs/components/annotation-color-theme.js", "../../../node_modules/.pnpm/molstar@4.18.0_@types+react@18.3.27_fp-ts@2.16.11_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/molstar/lib/extensions/mvs/helpers/label-text.js", "../../../node_modules/.pnpm/molstar@4.18.0_@types+react@18.3.27_fp-ts@2.16.11_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/molstar/lib/extensions/mvs/components/annotation-label/visual.js", "../../../node_modules/.pnpm/molstar@4.18.0_@types+react@18.3.27_fp-ts@2.16.11_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/molstar/lib/extensions/mvs/components/annotation-label/representation.js", "../../../node_modules/.pnpm/molstar@4.18.0_@types+react@18.3.27_fp-ts@2.16.11_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/molstar/lib/extensions/mvs/components/annotation-tooltips-prop.js", "../../../node_modules/.pnpm/molstar@4.18.0_@types+react@18.3.27_fp-ts@2.16.11_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/molstar/lib/extensions/mvs/components/annotation-structure-component.js", "../../../node_modules/.pnpm/molstar@4.18.0_@types+react@18.3.27_fp-ts@2.16.11_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/molstar/lib/extensions/mvs/components/selector.js", "../../../node_modules/.pnpm/molstar@4.18.0_@types+react@18.3.27_fp-ts@2.16.11_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/molstar/lib/extensions/mvs/components/custom-label/visual.js", "../../../node_modules/.pnpm/molstar@4.18.0_@types+react@18.3.27_fp-ts@2.16.11_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/molstar/lib/extensions/mvs/components/custom-label/representation.js", "../../../node_modules/.pnpm/molstar@4.18.0_@types+react@18.3.27_fp-ts@2.16.11_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/molstar/lib/extensions/mvs/components/custom-tooltips-prop.js", "../../../node_modules/.pnpm/molstar@4.18.0_@types+react@18.3.27_fp-ts@2.16.11_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/molstar/lib/extensions/mvs/components/formats.js", "../../../node_modules/.pnpm/molstar@4.18.0_@types+react@18.3.27_fp-ts@2.16.11_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/molstar/lib/extensions/mvs/components/multilayer-color-theme.js", "../../../node_modules/.pnpm/molstar@4.18.0_@types+react@18.3.27_fp-ts@2.16.11_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/molstar/lib/extensions/mvs/behavior.js", "../../../node_modules/.pnpm/molstar@4.18.0_@types+react@18.3.27_fp-ts@2.16.11_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/molstar/lib/extensions/mvs/camera.js", "../../../node_modules/.pnpm/molstar@4.18.0_@types+react@18.3.27_fp-ts@2.16.11_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/molstar/lib/extensions/mvs/components/primitives.js", "../../../node_modules/.pnpm/molstar@4.18.0_@types+react@18.3.27_fp-ts@2.16.11_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/molstar/lib/extensions/mvs/load-extensions/is-hidden-custom-state.js", "../../../node_modules/.pnpm/molstar@4.18.0_@types+react@18.3.27_fp-ts@2.16.11_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/molstar/lib/extensions/mvs/components/surroundings.js", "../../../node_modules/.pnpm/molstar@4.18.0_@types+react@18.3.27_fp-ts@2.16.11_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/molstar/lib/extensions/mvs/load-generic.js", "../../../node_modules/.pnpm/molstar@4.18.0_@types+react@18.3.27_fp-ts@2.16.11_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/molstar/lib/extensions/mvs/load-extensions/non-covalent-interactions.js", "../../../node_modules/.pnpm/molstar@4.18.0_@types+react@18.3.27_fp-ts@2.16.11_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/molstar/lib/extensions/mvs/load-helpers.js", "../../../node_modules/.pnpm/molstar@4.18.0_@types+react@18.3.27_fp-ts@2.16.11_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/molstar/lib/extensions/mvs/tree/molstar/conversion.js", "../../../node_modules/.pnpm/molstar@4.18.0_@types+react@18.3.27_fp-ts@2.16.11_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/molstar/lib/extensions/mvs/tree/molstar/molstar-tree.js", "../../../node_modules/.pnpm/molstar@4.18.0_@types+react@18.3.27_fp-ts@2.16.11_react-dom@18.3.1_react@18.3.1__react@18.3.1/node_modules/molstar/lib/extensions/mvs/load.js"],
  "sourcesContent": ["/**\n * Copyright (c) 2023 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Adam Midlik <midlik@gmail.com>\n */\nimport { ParamDefinition } from './param-definition';\n/**\n * Represents a set of values to choose from, with a default value. Example:\n * ```\n * export const MyChoice = new Choice({ yes: 'I agree', no: 'Nope' }, 'yes');\n * export type MyChoiceType = Choice.Values<typeof MyChoice>; // 'yes'|'no'\n * ```\n */\nexport class Choice {\n    constructor(opts, defaultValue) {\n        this.defaultValue = defaultValue;\n        this.options = Object.keys(opts).map(k => [k, opts[k]]);\n        this.nameDict = opts;\n    }\n    PDSelect(defaultValue, info) {\n        return ParamDefinition.Select(defaultValue !== null && defaultValue !== void 0 ? defaultValue : this.defaultValue, this.options, info);\n    }\n    prettyName(value) {\n        return this.nameDict[value];\n    }\n    get values() {\n        return this.options.map(([value, pretty]) => value);\n    }\n}\n", "/**\n * Copyright (c) 2023 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Adam Midlik <midlik@gmail.com>\n */\nimport { SortedArray } from '../../../mol-data/int';\nimport { arrayExtend, range } from '../../../mol-util/array';\nexport const AtomRanges = {\n    /** Return the number of disjoined ranges in a `AtomRanges` object */\n    count(ranges) {\n        return ranges.from.length;\n    },\n    /** Create new `AtomRanges` without any atoms */\n    empty() {\n        return { from: [], to: [] };\n    },\n    /** Create new `AtomRanges` containing a single range of atoms `[from, to)` */\n    single(from, to) {\n        return { from: [from], to: [to] };\n    },\n    /** Add a range of atoms `[from, to)` to existing `AtomRanges` and return the modified original.\n     * The added range must start after the end of the last existing range\n     * (if it starts just on the next atom, these two ranges will get merged). */\n    add(ranges, from, to) {\n        const n = AtomRanges.count(ranges);\n        if (n > 0) {\n            const lastTo = ranges.to[n - 1];\n            if (from < lastTo)\n                throw new Error('Overlapping ranges not allowed');\n            if (from === lastTo) {\n                ranges.to[n - 1] = to;\n            }\n            else {\n                ranges.from.push(from);\n                ranges.to.push(to);\n            }\n        }\n        else {\n            ranges.from.push(from);\n            ranges.to.push(to);\n        }\n        return ranges;\n    },\n    /** Apply function `func` to each range in `ranges` */\n    foreach(ranges, func) {\n        const n = AtomRanges.count(ranges);\n        for (let i = 0; i < n; i++)\n            func(ranges.from[i], ranges.to[i]);\n    },\n    /** Apply function `func` to each range in `ranges` and return an array with results */\n    map(ranges, func) {\n        const n = AtomRanges.count(ranges);\n        const result = new Array(n);\n        for (let i = 0; i < n; i++)\n            result[i] = func(ranges.from[i], ranges.to[i]);\n        return result;\n    },\n    /** Compute the set union of multiple `AtomRanges` objects (as sets of atoms) */\n    union(ranges) {\n        const concat = AtomRanges.empty();\n        for (const r of ranges) {\n            arrayExtend(concat.from, r.from);\n            arrayExtend(concat.to, r.to);\n        }\n        const indices = range(concat.from.length).sort((i, j) => concat.from[i] - concat.from[j]); // sort by start of range\n        const result = AtomRanges.empty();\n        let last = -1;\n        for (const i of indices) {\n            const from = concat.from[i];\n            const to = concat.to[i];\n            if (last >= 0 && from <= result.to[last]) {\n                if (to > result.to[last]) {\n                    result.to[last] = to;\n                }\n            }\n            else {\n                result.from.push(from);\n                result.to.push(to);\n                last++;\n            }\n        }\n        return result;\n    },\n    /** Return a sorted subset of `atoms` which lie in any of `ranges` (i.e. set intersection of `atoms` and `ranges`).\n     * If `out` is provided, use it to store the result (clear any old contents).\n     * If `outFirstAtomIndex` is provided, fill `outFirstAtomIndex.value` with the index of the first selected atom (if any). */\n    selectAtomsInRanges(atoms, ranges, out, outFirstAtomIndex = {}) {\n        var _a, _b;\n        out !== null && out !== void 0 ? out : (out = []);\n        out.length = 0;\n        outFirstAtomIndex.value = undefined;\n        const nAtoms = atoms.length;\n        const nRanges = AtomRanges.count(ranges);\n        if (nAtoms <= nRanges) {\n            // Implementation 1 (more efficient when there are fewer atoms)\n            let iRange = SortedArray.findPredecessorIndex(SortedArray.ofSortedArray(ranges.to), atoms[0] + 1);\n            for (let iAtom = 0; iAtom < nAtoms; iAtom++) {\n                const a = atoms[iAtom];\n                while (iRange < nRanges && ranges.to[iRange] <= a)\n                    iRange++;\n                const qualifies = iRange < nRanges && ranges.from[iRange] <= a;\n                if (qualifies) {\n                    out.push(a);\n                    (_a = outFirstAtomIndex.value) !== null && _a !== void 0 ? _a : (outFirstAtomIndex.value = iAtom);\n                }\n            }\n        }\n        else {\n            // Implementation 2 (more efficient when there are fewer ranges)\n            for (let iRange = 0; iRange < nRanges; iRange++) {\n                const from = ranges.from[iRange];\n                const to = ranges.to[iRange];\n                for (let iAtom = SortedArray.findPredecessorIndex(atoms, from); iAtom < nAtoms; iAtom++) {\n                    const a = atoms[iAtom];\n                    if (a < to) {\n                        out.push(a);\n                        (_b = outFirstAtomIndex.value) !== null && _b !== void 0 ? _b : (outFirstAtomIndex.value = iAtom);\n                    }\n                    else {\n                        break;\n                    }\n                }\n            }\n        }\n        return out;\n    },\n};\n", "/**\n * Copyright (c) 2023-2025 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Adam Midlik <midlik@gmail.com>\n */\nimport { Column } from '../../../mol-data/db';\nimport { SortedArray } from '../../../mol-data/int';\nimport { filterInPlace, range, sortIfNeeded } from '../../../mol-util/array';\nimport { MultiMap, NumberMap } from './utils';\nexport const IndicesAndSortings = {\n    /** Get `IndicesAndSortings` for a model (use a cached value or create if not available yet) */\n    get(model) {\n        var _a;\n        var _b;\n        return (_a = (_b = model._dynamicPropertyData)['indices-and-sortings']) !== null && _a !== void 0 ? _a : (_b['indices-and-sortings'] = IndicesAndSortings.create(model));\n    },\n    /** Create `IndicesAndSortings` for a model */\n    create(model) {\n        const h = model.atomicHierarchy;\n        const nAtoms = h.atoms._rowCount;\n        const nChains = h.chains._rowCount;\n        const { label_entity_id, label_asym_id, auth_asym_id } = h.chains;\n        const { label_seq_id, auth_seq_id, pdbx_PDB_ins_code } = h.residues;\n        const { label_comp_id, auth_comp_id } = h.atoms;\n        const { Present } = Column.ValueKind;\n        const chainsByLabelEntityId = new MultiMap();\n        const chainsByLabelAsymId = new MultiMap();\n        const chainsByAuthAsymId = new MultiMap();\n        const residuesSortedByLabelSeqId = new Map();\n        const residuesSortedByAuthSeqId = new Map();\n        const residuesByInsCode = new Map();\n        const residuesByLabelCompId = new Map();\n        let residuesByLabelCompIdIsPure = true;\n        const residuesByAuthCompId = new Map();\n        let residuesByAuthCompIdIsPure = true;\n        const atomsById = new NumberMap(nAtoms + 1);\n        const atomsByIndex = new NumberMap(nAtoms);\n        const _labelCompIdSet = new Set();\n        const _authCompIdSet = new Set();\n        for (let iChain = 0; iChain < nChains; iChain++) {\n            chainsByLabelEntityId.add(label_entity_id.value(iChain), iChain);\n            chainsByLabelAsymId.add(label_asym_id.value(iChain), iChain);\n            chainsByAuthAsymId.add(auth_asym_id.value(iChain), iChain);\n            const iResFrom = h.residueAtomSegments.index[h.chainAtomSegments.offsets[iChain]];\n            const iResTo = h.residueAtomSegments.index[h.chainAtomSegments.offsets[iChain + 1] - 1] + 1;\n            const residuesWithLabelSeqId = filterInPlace(range(iResFrom, iResTo), iRes => label_seq_id.valueKind(iRes) === Present);\n            residuesSortedByLabelSeqId.set(iChain, Sorting.create(residuesWithLabelSeqId, label_seq_id.value));\n            const residuesWithAuthSeqId = filterInPlace(range(iResFrom, iResTo), iRes => auth_seq_id.valueKind(iRes) === Present);\n            residuesSortedByAuthSeqId.set(iChain, Sorting.create(residuesWithAuthSeqId, auth_seq_id.value));\n            const residuesHereByInsCode = new MultiMap();\n            const residuesHereByLabelCompId = new MultiMap();\n            const residuesHereByAuthCompId = new MultiMap();\n            for (let iRes = iResFrom; iRes < iResTo; iRes++) {\n                if (pdbx_PDB_ins_code.valueKind(iRes) === Present) {\n                    residuesHereByInsCode.add(pdbx_PDB_ins_code.value(iRes), iRes);\n                }\n                const iAtomFrom = h.residueAtomSegments.offsets[iRes];\n                const iAtomTo = h.residueAtomSegments.offsets[iRes + 1];\n                for (let iAtom = iAtomFrom; iAtom < iAtomTo; iAtom++) {\n                    _labelCompIdSet.add(label_comp_id.value(iAtom));\n                    _authCompIdSet.add(auth_comp_id.value(iAtom));\n                }\n                if (_labelCompIdSet.size > 1)\n                    residuesByLabelCompIdIsPure = false;\n                if (_authCompIdSet.size > 1)\n                    residuesByAuthCompIdIsPure = false;\n                for (const labelCompId of _labelCompIdSet)\n                    residuesHereByLabelCompId.add(labelCompId, iRes);\n                for (const authCompId of _authCompIdSet)\n                    residuesHereByAuthCompId.add(authCompId, iRes);\n                _labelCompIdSet.clear();\n                _authCompIdSet.clear();\n            }\n            residuesByInsCode.set(iChain, residuesHereByInsCode);\n            residuesByLabelCompId.set(iChain, residuesHereByLabelCompId);\n            residuesByAuthCompId.set(iChain, residuesHereByAuthCompId);\n        }\n        const atomId = model.atomicConformation.atomId.value;\n        const atomIndex = h.atomSourceIndex.value;\n        for (let iAtom = 0; iAtom < nAtoms; iAtom++) {\n            atomsById.set(atomId(iAtom), iAtom);\n            atomsByIndex.set(atomIndex(iAtom), iAtom);\n        }\n        return {\n            chainsByLabelEntityId, chainsByLabelAsymId, chainsByAuthAsymId,\n            residuesSortedByLabelSeqId, residuesSortedByAuthSeqId, residuesByInsCode,\n            residuesByLabelCompId, residuesByLabelCompIdIsPure, residuesByAuthCompId, residuesByAuthCompIdIsPure,\n            atomsById, atomsByIndex,\n        };\n    },\n};\nexport const Sorting = {\n    /** Create a `Sorting` from an array of keys and a function returning their corresponding values.\n     * If two keys have the same value, the smaller key will come first.\n     * This function modifies `keys` - create a copy if you need the original order! */\n    create(keys, valueFunction) {\n        sortIfNeeded(keys, (a, b) => valueFunction(a) - valueFunction(b) || a - b);\n        const values = SortedArray.ofSortedArray(keys.map(valueFunction));\n        return { keys, values };\n    },\n    /** Return a newly allocated array of keys which have value equal to `target`.\n     * The returned keys are sorted by their value. */\n    getKeysWithValue(sorting, target) {\n        return Sorting.getKeysWithValueInRange(sorting, target, target);\n    },\n    /** Return a newly allocated array of keys which have value within interval `[min, max]` (inclusive).\n     * The returned keys are sorted by their value.\n     * Undefined `min` is interpreted as negative infitity, undefined `max` is interpreted as positive infinity. */\n    getKeysWithValueInRange(sorting, min, max) {\n        const { keys, values } = sorting;\n        if (!keys)\n            return [];\n        const n = keys.length;\n        const from = (min !== undefined) ? SortedArray.findPredecessorIndex(values, min) : 0;\n        let to;\n        if (max !== undefined) {\n            to = from;\n            while (to < n && values[to] <= max)\n                to++;\n        }\n        else {\n            to = n;\n        }\n        return keys.slice(from, to);\n    },\n};\n", "/**\n * Copyright (c) 2023 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Adam Midlik <midlik@gmail.com>\n */\nimport { ParamDefinition as PD } from '../../../mol-util/param-definition';\n/** Similar to `PD.Numeric` but allows leaving empty field in UI (treated as `undefined`) */\nexport function MaybeIntegerParamDefinition(defaultValue, info) {\n    return PD.Converted(stringifyMaybeInt, parseMaybeInt, PD.Text(stringifyMaybeInt(defaultValue), info));\n}\n/** The magic with negative zero looks crazy, but it's needed if we want to be able to write negative numbers, LOL. Please help if you know a better solution. */\nfunction parseMaybeInt(input) {\n    if (input.trim() === '-')\n        return -0;\n    const num = parseInt(input);\n    return isNaN(num) ? undefined : num;\n}\nfunction stringifyMaybeInt(num) {\n    if (num === undefined)\n        return '';\n    if (Object.is(num, -0))\n        return '-';\n    return num.toString();\n}\n/** Similar to `PD.Text` but leaving empty field in UI is treated as `undefined` */\nexport function MaybeStringParamDefinition(defaultValue, info) {\n    return PD.Converted(stringifyMaybeString, parseMaybeString, PD.Text(stringifyMaybeString(defaultValue), info));\n}\nfunction parseMaybeString(input) {\n    return input === '' ? undefined : input;\n}\nfunction stringifyMaybeString(str) {\n    return str === undefined ? '' : str;\n}\n", "/**\n * Copyright (c) 2023-2025 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Adam Midlik <midlik@gmail.com>\n * @author David Sehnal <david.sehnal@gmail.com>\n */\nimport { Column } from '../../../mol-data/db';\nimport { pickObjectKeys } from '../../../mol-util/object';\nimport { Choice } from '../../../mol-util/param-choice';\nconst { str, int } = Column.Schema;\nexport const MVSAnnotationSchema = new Choice({\n    whole_structure: 'Whole Structure',\n    entity: 'Entity',\n    chain: 'Chain (label*)',\n    auth_chain: 'Chain (auth*)',\n    residue: 'Residue (label*)',\n    auth_residue: 'Residue (auth*)',\n    residue_range: 'Residue range (label*)',\n    auth_residue_range: 'Residue range (auth*)',\n    atom: 'Atom (label*)',\n    auth_atom: 'Atom (auth*)',\n    all_atomic: 'All atomic selectors',\n}, 'all_atomic');\n/** Get CIF schema definition for given annotation schema name */\nexport function getCifAnnotationSchema(schemaName) {\n    return pickObjectKeys(AllAtomicCifAnnotationSchema, FieldsForSchemas[schemaName]);\n}\n/** Definition of `all_atomic` schema for CIF (other atomic schemas are subschemas of this one) */\nconst AllAtomicCifAnnotationSchema = {\n    /** Tag for grouping multiple annotation rows with the same `group_id` (e.g. to show one label for two chains);\n     * if the `group_id` is not given, each row is processed separately */\n    group_id: str,\n    label_entity_id: str,\n    label_asym_id: str,\n    auth_asym_id: str,\n    label_seq_id: int,\n    auth_seq_id: int,\n    pdbx_PDB_ins_code: str,\n    /** Minimum label_seq_id (inclusive) */\n    beg_label_seq_id: int,\n    /** Maximum label_seq_id (inclusive) */\n    end_label_seq_id: int,\n    /** Minimum auth_seq_id (inclusive) */\n    beg_auth_seq_id: int,\n    /** Maximum auth_seq_id (inclusive) */\n    end_auth_seq_id: int,\n    label_comp_id: str,\n    auth_comp_id: str,\n    // residue_index: int, // 0-based residue index in the source file // TODO this is defined in Python builder but not supported by Molstar yet\n    /** Atom name like 'CA', 'N', 'O'... */\n    label_atom_id: str,\n    /** Atom name like 'CA', 'N', 'O'... */\n    auth_atom_id: str,\n    /** Element symbol like 'H', 'He', 'Li', 'Be' (case-insensitive)... */\n    type_symbol: str,\n    /** Unique atom identifier across conformations (_atom_site.id) */\n    atom_id: int,\n    /** 0-based index of the atom in the source data */\n    atom_index: int,\n};\n/** Allowed fields (i.e. CIF columns or JSON keys) for each annotation schema\n * (other fields will just be ignored) */\nconst FieldsForSchemas = {\n    whole_structure: ['group_id'],\n    entity: ['group_id', 'label_entity_id'],\n    chain: ['group_id', 'label_entity_id', 'label_asym_id'],\n    auth_chain: ['group_id', 'auth_asym_id'],\n    residue: ['group_id', 'label_entity_id', 'label_asym_id', 'label_seq_id'],\n    auth_residue: ['group_id', 'auth_asym_id', 'auth_seq_id', 'pdbx_PDB_ins_code'],\n    residue_range: ['group_id', 'label_entity_id', 'label_asym_id', 'beg_label_seq_id', 'end_label_seq_id'],\n    auth_residue_range: ['group_id', 'auth_asym_id', 'beg_auth_seq_id', 'end_auth_seq_id'],\n    atom: ['group_id', 'label_entity_id', 'label_asym_id', 'label_seq_id', 'label_atom_id', 'type_symbol', 'atom_id', 'atom_index'],\n    auth_atom: ['group_id', 'auth_asym_id', 'auth_seq_id', 'pdbx_PDB_ins_code', 'auth_atom_id', 'type_symbol', 'atom_id', 'atom_index'],\n    all_atomic: Object.keys(AllAtomicCifAnnotationSchema),\n};\n", "/**\n * Copyright (c) 2023-2025 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Adam Midlik <midlik@gmail.com>\n * @author David Sehnal <david.sehnal@gmail.com>\n */\nimport { Column } from '../../../mol-data/db';\nimport { StructureElement } from '../../../mol-model/structure';\nimport { arrayExtend, filterInPlace, range } from '../../../mol-util/array';\nimport { AtomRanges } from './atom-ranges';\nimport { Sorting } from './indexing';\nimport { isAnyDefined, isDefined } from './utils';\nconst EmptyArray = [];\n/** Return atom ranges in `model` which satisfy criteria given by `row` */\nexport function getAtomRangesForRow(model, row, indices) {\n    const h = model.atomicHierarchy;\n    const nAtoms = h.atoms._rowCount;\n    const hasAtomIds = isAnyDefined(row.atom_id, row.atom_index);\n    const hasAtomFilter = isAnyDefined(row.label_atom_id, row.auth_atom_id, row.type_symbol)\n        || isDefined(row.label_comp_id) && !indices.residuesByLabelCompIdIsPure\n        || isDefined(row.auth_comp_id) && !indices.residuesByAuthCompIdIsPure;\n    const hasResidueFilter = isAnyDefined(row.label_seq_id, row.auth_seq_id, row.pdbx_PDB_ins_code, row.beg_label_seq_id, row.end_label_seq_id, row.beg_auth_seq_id, row.end_auth_seq_id, row.label_comp_id, row.auth_comp_id);\n    const hasChainFilter = isAnyDefined(row.label_asym_id, row.auth_asym_id, row.label_entity_id);\n    if (hasAtomIds) {\n        const theAtom = getTheAtomForRow(model, row, indices);\n        return theAtom !== undefined ? AtomRanges.single(theAtom, theAtom + 1) : AtomRanges.empty();\n    }\n    if (!hasChainFilter && !hasResidueFilter && !hasAtomFilter) {\n        return AtomRanges.single(0, nAtoms);\n    }\n    const qualifyingChains = getQualifyingChains(model, row, indices);\n    if (!hasResidueFilter && !hasAtomFilter) {\n        const chainOffsets = h.chainAtomSegments.offsets;\n        const ranges = AtomRanges.empty();\n        for (const iChain of qualifyingChains) {\n            AtomRanges.add(ranges, chainOffsets[iChain], chainOffsets[iChain + 1]);\n        }\n        return ranges;\n    }\n    const qualifyingResidues = getQualifyingResidues(model, row, indices, qualifyingChains);\n    if (!hasAtomFilter) {\n        const residueOffsets = h.residueAtomSegments.offsets;\n        const ranges = AtomRanges.empty();\n        for (const iRes of qualifyingResidues) {\n            AtomRanges.add(ranges, residueOffsets[iRes], residueOffsets[iRes + 1]);\n        }\n        return ranges;\n    }\n    const qualifyingAtoms = getQualifyingAtoms(model, row, indices, qualifyingResidues);\n    const ranges = AtomRanges.empty();\n    for (const iAtom of qualifyingAtoms) {\n        AtomRanges.add(ranges, iAtom, iAtom + 1);\n    }\n    return ranges;\n}\n/** Return atom ranges in `model` which satisfy criteria given by any of `rows` (atoms that satisfy more rows are still included only once) */\nexport function getAtomRangesForRows(model, rows, indices) {\n    if (Array.isArray(rows)) {\n        return AtomRanges.union(rows.map(row => getAtomRangesForRow(model, row, indices)));\n    }\n    else {\n        return getAtomRangesForRow(model, rows, indices);\n    }\n}\n/** Return an array of chain indexes which satisfy criteria given by `row` */\nfunction getQualifyingChains(model, row, indices) {\n    var _a, _b, _c;\n    const { auth_asym_id, label_entity_id, _rowCount: nChains } = model.atomicHierarchy.chains;\n    let result = undefined;\n    if (isDefined(row.label_asym_id)) {\n        result = (_a = indices.chainsByLabelAsymId.get(row.label_asym_id)) !== null && _a !== void 0 ? _a : EmptyArray;\n    }\n    if (isDefined(row.auth_asym_id)) {\n        if (result) {\n            result = result.filter(i => auth_asym_id.value(i) === row.auth_asym_id);\n        }\n        else {\n            result = (_b = indices.chainsByAuthAsymId.get(row.auth_asym_id)) !== null && _b !== void 0 ? _b : EmptyArray;\n        }\n    }\n    if (isDefined(row.label_entity_id)) {\n        if (result) {\n            result = result.filter(i => label_entity_id.value(i) === row.label_entity_id);\n        }\n        else {\n            result = (_c = indices.chainsByLabelEntityId.get(row.label_entity_id)) !== null && _c !== void 0 ? _c : EmptyArray;\n        }\n    }\n    result !== null && result !== void 0 ? result : (result = range(nChains));\n    return result;\n}\n/** Return an array of residue indexes which satisfy criteria given by `row` */\nfunction getQualifyingResidues(model, row, indices, fromChains) {\n    var _a, _b, _c;\n    const { label_seq_id, auth_seq_id, pdbx_PDB_ins_code } = model.atomicHierarchy.residues;\n    const { label_comp_id, auth_comp_id } = model.atomicHierarchy.atoms;\n    const { residueAtomSegments, chainAtomSegments } = model.atomicHierarchy;\n    const { Present } = Column.ValueKind;\n    const result = [];\n    for (const iChain of fromChains) {\n        let residuesHere = undefined;\n        if (isDefined(row.label_seq_id)) {\n            const sorting = indices.residuesSortedByLabelSeqId.get(iChain);\n            residuesHere = Sorting.getKeysWithValue(sorting, row.label_seq_id);\n        }\n        if (isDefined(row.auth_seq_id)) {\n            if (residuesHere) {\n                residuesHere = residuesHere.filter(i => auth_seq_id.valueKind(i) === Present && auth_seq_id.value(i) === row.auth_seq_id);\n            }\n            else {\n                const sorting = indices.residuesSortedByAuthSeqId.get(iChain);\n                residuesHere = Sorting.getKeysWithValue(sorting, row.auth_seq_id);\n            }\n        }\n        if (isDefined(row.pdbx_PDB_ins_code)) {\n            if (residuesHere) {\n                residuesHere = residuesHere.filter(i => pdbx_PDB_ins_code.value(i) === row.pdbx_PDB_ins_code);\n            }\n            else {\n                residuesHere = (_a = indices.residuesByInsCode.get(iChain).get(row.pdbx_PDB_ins_code)) !== null && _a !== void 0 ? _a : EmptyArray;\n            }\n        }\n        if (isDefined(row.beg_label_seq_id) || isDefined(row.end_label_seq_id)) {\n            if (residuesHere) {\n                if (isDefined(row.beg_label_seq_id)) {\n                    residuesHere = residuesHere.filter(i => label_seq_id.valueKind(i) === Present && label_seq_id.value(i) >= row.beg_label_seq_id);\n                }\n                if (isDefined(row.end_label_seq_id)) {\n                    residuesHere = residuesHere.filter(i => label_seq_id.valueKind(i) === Present && label_seq_id.value(i) <= row.end_label_seq_id);\n                }\n            }\n            else {\n                const sorting = indices.residuesSortedByLabelSeqId.get(iChain);\n                residuesHere = Sorting.getKeysWithValueInRange(sorting, row.beg_label_seq_id, row.end_label_seq_id);\n            }\n        }\n        if (isDefined(row.beg_auth_seq_id) || isDefined(row.end_auth_seq_id)) {\n            if (residuesHere) {\n                if (isDefined(row.beg_auth_seq_id)) {\n                    residuesHere = residuesHere.filter(i => auth_seq_id.valueKind(i) === Present && auth_seq_id.value(i) >= row.beg_auth_seq_id);\n                }\n                if (isDefined(row.end_auth_seq_id)) {\n                    residuesHere = residuesHere.filter(i => auth_seq_id.valueKind(i) === Present && auth_seq_id.value(i) <= row.end_auth_seq_id);\n                }\n            }\n            else {\n                const sorting = indices.residuesSortedByAuthSeqId.get(iChain);\n                residuesHere = Sorting.getKeysWithValueInRange(sorting, row.beg_auth_seq_id, row.end_auth_seq_id);\n            }\n        }\n        if (isDefined(row.label_comp_id)) {\n            if (residuesHere) {\n                if (indices.residuesByLabelCompIdIsPure) {\n                    residuesHere = residuesHere.filter(i => label_comp_id.value(residueAtomSegments.offsets[i]) === row.label_comp_id);\n                }\n                else {\n                    residuesHere = residuesHere.filter(i => {\n                        for (let iAtom = residueAtomSegments.offsets[i], stop = residueAtomSegments.offsets[i + 1]; iAtom < stop; iAtom++) {\n                            if (label_comp_id.value(iAtom) === row.label_comp_id)\n                                return true;\n                        }\n                    });\n                }\n            }\n            else {\n                residuesHere = (_b = indices.residuesByLabelCompId.get(iChain).get(row.label_comp_id)) !== null && _b !== void 0 ? _b : EmptyArray;\n            }\n        }\n        if (isDefined(row.auth_comp_id)) {\n            if (residuesHere) {\n                if (indices.residuesByAuthCompIdIsPure) {\n                    residuesHere = residuesHere.filter(i => auth_comp_id.value(residueAtomSegments.offsets[i]) === row.auth_comp_id);\n                }\n                else {\n                    residuesHere = residuesHere.filter(i => {\n                        for (let iAtom = residueAtomSegments.offsets[i], stop = residueAtomSegments.offsets[i + 1]; iAtom < stop; iAtom++) {\n                            if (auth_comp_id.value(iAtom) === row.auth_comp_id)\n                                return true;\n                        }\n                    });\n                }\n            }\n            else {\n                residuesHere = (_c = indices.residuesByAuthCompId.get(iChain).get(row.auth_comp_id)) !== null && _c !== void 0 ? _c : EmptyArray;\n            }\n        }\n        if (!residuesHere) {\n            const firstResidueForChain = residueAtomSegments.index[chainAtomSegments.offsets[iChain]];\n            const firstResidueAfterChain = residueAtomSegments.index[chainAtomSegments.offsets[iChain + 1] - 1] + 1;\n            residuesHere = range(firstResidueForChain, firstResidueAfterChain);\n        }\n        arrayExtend(result, residuesHere);\n    }\n    return result;\n}\n/** Return an array of atom indexes which satisfy criteria given by `row` */\nfunction getQualifyingAtoms(model, row, indices, fromResidues) {\n    const { label_atom_id, auth_atom_id, type_symbol, label_comp_id, auth_comp_id } = model.atomicHierarchy.atoms;\n    const residueAtomSegments_offsets = model.atomicHierarchy.residueAtomSegments.offsets;\n    const result = [];\n    for (const iRes of fromResidues) {\n        const atomIdcs = range(residueAtomSegments_offsets[iRes], residueAtomSegments_offsets[iRes + 1]);\n        if (isDefined(row.label_atom_id)) {\n            filterInPlace(atomIdcs, iAtom => label_atom_id.value(iAtom) === row.label_atom_id);\n        }\n        if (isDefined(row.auth_atom_id)) {\n            filterInPlace(atomIdcs, iAtom => auth_atom_id.value(iAtom) === row.auth_atom_id);\n        }\n        if (isDefined(row.type_symbol)) {\n            filterInPlace(atomIdcs, iAtom => { var _a; return type_symbol.value(iAtom) === ((_a = row.type_symbol) === null || _a === void 0 ? void 0 : _a.toUpperCase()); });\n        }\n        if (isDefined(row.label_comp_id) && !indices.residuesByLabelCompIdIsPure) {\n            filterInPlace(atomIdcs, iAtom => label_comp_id.value(iAtom) === row.label_comp_id);\n        }\n        if (isDefined(row.auth_comp_id) && !indices.residuesByAuthCompIdIsPure) {\n            filterInPlace(atomIdcs, iAtom => auth_comp_id.value(iAtom) === row.auth_comp_id);\n        }\n        arrayExtend(result, atomIdcs);\n    }\n    return result;\n}\n/** Return index of atom in `model` which satistfies criteria given by `row`, if any.\n * Only works when `row.atom_id` and/or `row.atom_index` is defined (otherwise use `getAtomRangesForRow`). */\nfunction getTheAtomForRow(model, row, indices) {\n    let iAtom = undefined;\n    if (!isDefined(row.atom_id) && !isDefined(row.atom_index))\n        throw new Error('ArgumentError: at least one of row.atom_id, row.atom_index must be defined.');\n    if (isDefined(row.atom_id) && isDefined(row.atom_index)) {\n        const a1 = indices.atomsById.get(row.atom_id);\n        const a2 = indices.atomsByIndex.get(row.atom_index);\n        if (a1 !== a2)\n            return undefined;\n        iAtom = a1;\n    }\n    if (isDefined(row.atom_id)) {\n        iAtom = indices.atomsById.get(row.atom_id);\n    }\n    if (isDefined(row.atom_index)) {\n        iAtom = indices.atomsByIndex.get(row.atom_index);\n    }\n    if (iAtom === undefined)\n        return undefined;\n    if (!atomQualifies(model, iAtom, row))\n        return undefined;\n    return iAtom;\n}\n/** Return true if `iAtom`-th atom in `model` satisfies all selection criteria given by `row`. */\nexport function atomQualifies(model, iAtom, row) {\n    var _a;\n    const h = model.atomicHierarchy;\n    const iChain = h.chainAtomSegments.index[iAtom];\n    const label_asym_id = h.chains.label_asym_id.value(iChain);\n    const auth_asym_id = h.chains.auth_asym_id.value(iChain);\n    const label_entity_id = h.chains.label_entity_id.value(iChain);\n    if (!matches(row.label_asym_id, label_asym_id))\n        return false;\n    if (!matches(row.auth_asym_id, auth_asym_id))\n        return false;\n    if (!matches(row.label_entity_id, label_entity_id))\n        return false;\n    const iRes = h.residueAtomSegments.index[iAtom];\n    const label_seq_id = (h.residues.label_seq_id.valueKind(iRes) === Column.ValueKind.Present) ? h.residues.label_seq_id.value(iRes) : undefined;\n    const auth_seq_id = (h.residues.auth_seq_id.valueKind(iRes) === Column.ValueKind.Present) ? h.residues.auth_seq_id.value(iRes) : undefined;\n    const pdbx_PDB_ins_code = h.residues.pdbx_PDB_ins_code.value(iRes);\n    if (!matches(row.label_seq_id, label_seq_id))\n        return false;\n    if (!matches(row.auth_seq_id, auth_seq_id))\n        return false;\n    if (!matches(row.pdbx_PDB_ins_code, pdbx_PDB_ins_code))\n        return false;\n    if (!matchesRange(row.beg_label_seq_id, row.end_label_seq_id, label_seq_id))\n        return false;\n    if (!matchesRange(row.beg_auth_seq_id, row.end_auth_seq_id, auth_seq_id))\n        return false;\n    const label_comp_id = h.atoms.label_comp_id.value(iAtom);\n    const auth_comp_id = h.atoms.auth_comp_id.value(iAtom);\n    const label_atom_id = h.atoms.label_atom_id.value(iAtom);\n    const auth_atom_id = h.atoms.auth_atom_id.value(iAtom);\n    const type_symbol = h.atoms.type_symbol.value(iAtom);\n    const atom_id = model.atomicConformation.atomId.value(iAtom);\n    const atom_index = h.atomSourceIndex.value(iAtom);\n    if (!matches(row.label_comp_id, label_comp_id))\n        return false;\n    if (!matches(row.auth_comp_id, auth_comp_id))\n        return false;\n    if (!matches(row.label_atom_id, label_atom_id))\n        return false;\n    if (!matches(row.auth_atom_id, auth_atom_id))\n        return false;\n    if (!matches((_a = row.type_symbol) === null || _a === void 0 ? void 0 : _a.toUpperCase(), type_symbol))\n        return false;\n    if (!matches(row.atom_id, atom_id))\n        return false;\n    if (!matches(row.atom_index, atom_index))\n        return false;\n    return true;\n}\n/** Return true if `value` equals `requiredValue` or if `requiredValue` if not defined.  */\nfunction matches(requiredValue, value) {\n    return !isDefined(requiredValue) || value === requiredValue;\n}\n/** Return true if `requiredMin <= value <= requiredMax`.\n * Undefined `requiredMin` behaves like negative infinity.\n * Undefined `requiredMax` behaves like positive infinity. */\nfunction matchesRange(requiredMin, requiredMax, value) {\n    if (isDefined(requiredMin) && (!isDefined(value) || value < requiredMin))\n        return false;\n    if (isDefined(requiredMax) && (!isDefined(value) || value > requiredMax))\n        return false;\n    return true;\n}\n/** Convert an annotation row into a MolScript expression */\nexport function rowToExpression(row) {\n    return StructureElement.Schema.toExpression(row);\n}\n/** Convert multiple annotation rows into a MolScript expression.\n * (with union semantics, i.e. an atom qualifies if it qualifies for at least one of the rows) */\nexport function rowsToExpression(rows) {\n    return StructureElement.Schema.toExpression({\n        items: rows\n    });\n}\n/** Return row indices grouped by `row.group_id`. Rows with `row.group_id===undefined` are treated as separate groups. */\nexport function groupRows(rows) {\n    let counter = 0;\n    const groupMap = new Map();\n    const groups = [];\n    for (let i = 0; i < rows.length; i++) {\n        const group_id = rows[i].group_id;\n        if (group_id === undefined) {\n            groups.push(counter++);\n        }\n        else {\n            const groupIndex = groupMap.get(group_id);\n            if (groupIndex === undefined) {\n                groupMap.set(group_id, counter);\n                groups.push(counter);\n                counter++;\n            }\n            else {\n                groups.push(groupIndex);\n            }\n        }\n    }\n    const rowIndices = range(rows.length).sort((i, j) => groups[i] - groups[j]);\n    const offsets = [];\n    for (let i = 0; i < rows.length; i++) {\n        if (i === 0 || groups[rowIndices[i]] !== groups[rowIndices[i - 1]])\n            offsets.push(i);\n    }\n    offsets.push(rowIndices.length);\n    return { count: offsets.length - 1, offsets, grouped: rowIndices };\n}\n", "/**\n * Copyright (c) 2023-2024 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Adam Midlik <midlik@gmail.com>\n */\nimport { Column } from '../../../mol-data/db';\nimport { CIF, CifBlock, CifFile } from '../../../mol-io/reader/cif';\nimport { toTable } from '../../../mol-io/reader/cif/schema';\nimport { MmcifFormat } from '../../../mol-model-formats/structure/mmcif';\nimport { CustomModelProperty } from '../../../mol-model-props/common/custom-model-property';\nimport { CustomPropertyDescriptor } from '../../../mol-model/custom-property';\nimport { arrayExtend } from '../../../mol-util/array';\nimport { Asset } from '../../../mol-util/assets';\nimport { canonicalJsonString } from '../../../mol-util/json';\nimport { pickObjectKeys, promiseAllObj } from '../../../mol-util/object';\nimport { Choice } from '../../../mol-util/param-choice';\nimport { ParamDefinition as PD } from '../../../mol-util/param-definition';\nimport { AtomRanges } from '../helpers/atom-ranges';\nimport { IndicesAndSortings } from '../helpers/indexing';\nimport { MaybeStringParamDefinition } from '../helpers/param-definition';\nimport { MVSAnnotationSchema, getCifAnnotationSchema } from '../helpers/schemas';\nimport { atomQualifies, getAtomRangesForRow } from '../helpers/selections';\nimport { safePromise } from '../helpers/utils';\n/** Allowed values for the annotation format parameter */\nconst MVSAnnotationFormat = new Choice({ json: 'json', cif: 'cif', bcif: 'bcif' }, 'json');\nconst MVSAnnotationFormatTypes = { json: 'string', cif: 'string', bcif: 'binary' };\nexport const MVSAnnotationsParams = {\n    annotations: PD.ObjectList({\n        source: PD.MappedStatic('source-cif', {\n            'source-cif': PD.EmptyGroup(),\n            'url': PD.Group({\n                url: PD.Text(''),\n                format: MVSAnnotationFormat.PDSelect(),\n            }),\n        }),\n        schema: MVSAnnotationSchema.PDSelect(),\n        cifBlock: PD.MappedStatic('index', {\n            index: PD.Group({ index: PD.Numeric(0, { min: 0, step: 1 }, { description: '0-based index of the block' }) }),\n            header: PD.Group({ header: PD.Text(undefined, { description: 'Block header' }) }),\n        }, { description: 'Specify which CIF block contains annotation data (only relevant when format=cif or format=bcif)' }),\n        cifCategory: MaybeStringParamDefinition(undefined, { description: 'Specify which CIF category contains annotation data (only relevant when format=cif or format=bcif)' }),\n        id: PD.Text('', { description: 'Arbitrary identifier that can be referenced by MVSAnnotationColorTheme' }),\n    }, obj => obj.id),\n};\n/** Provider for custom model property \"Annotations\" */\nexport const MVSAnnotationsProvider = CustomModelProperty.createProvider({\n    label: 'MVS Annotations',\n    descriptor: CustomPropertyDescriptor({\n        name: 'mvs-annotations',\n    }),\n    type: 'static',\n    defaultParams: MVSAnnotationsParams,\n    getParams: (data) => MVSAnnotationsParams,\n    isApplicable: (data) => true,\n    obtain: async (ctx, data, props) => {\n        var _a;\n        props = { ...PD.getDefaultValues(MVSAnnotationsParams), ...props };\n        const specs = (_a = props.annotations) !== null && _a !== void 0 ? _a : [];\n        const annots = await MVSAnnotations.fromSpecs(ctx, specs, data);\n        return { value: annots };\n    }\n});\n/** Represents multiple annotations retrievable by their ID */\nexport class MVSAnnotations {\n    constructor(dict) {\n        this.dict = dict;\n    }\n    static async fromSpecs(ctx, specs, model) {\n        var _a;\n        const sources = specs.map(annotationSourceFromSpec);\n        const files = await getFilesFromSources(ctx, sources, model);\n        const annots = {};\n        for (let i = 0; i < specs.length; i++) {\n            const spec = specs[i];\n            try {\n                const file = files[i];\n                if (!file.ok)\n                    throw file.error;\n                annots[spec.id] = await MVSAnnotation.fromSpec(ctx, spec, file.value);\n            }\n            catch (err) {\n                (_a = ctx.errorContext) === null || _a === void 0 ? void 0 : _a.add('mvs', `Failed to obtain annotation (${err}).\\nAnnotation specification source params: ${JSON.stringify(spec.source.params)}`);\n                console.error(`Failed to obtain annotation (${err}).\\nAnnotation specification:`, spec);\n                annots[spec.id] = MVSAnnotation.createEmpty(spec.schema);\n            }\n        }\n        return new MVSAnnotations(annots);\n    }\n    getAnnotation(id) {\n        return this.dict[id];\n    }\n    getAllAnnotations() {\n        return Object.values(this.dict);\n    }\n}\n/** Retrieve annotation with given `annotationId` from custom model property \"MVS Annotations\" and the model from which it comes */\nexport function getMVSAnnotationForStructure(structure, annotationId) {\n    const models = structure.isEmpty ? [] : structure.models;\n    for (const model of models) {\n        if (model.customProperties.has(MVSAnnotationsProvider.descriptor)) {\n            const annots = MVSAnnotationsProvider.get(model).value;\n            const annotation = annots === null || annots === void 0 ? void 0 : annots.getAnnotation(annotationId);\n            if (annotation) {\n                return { annotation, model };\n            }\n        }\n    }\n    return { annotation: undefined, model: undefined };\n}\n/** Main class for processing MVS annotation */\nexport class MVSAnnotation {\n    constructor(data, schema) {\n        this.data = data;\n        this.schema = schema;\n        /** Store mapping `ElementIndex` -> annotation row index for each `Model`, -1 means no row applies */\n        this.indexedModels = new Map();\n        this.rows = undefined;\n    }\n    /** Create a new `MVSAnnotation` based on specification `spec`. Use `file` if provided, otherwise download the file.\n     * Throw error if download fails or problem with data. */\n    static async fromSpec(ctx, spec, file) {\n        var _a;\n        file !== null && file !== void 0 ? file : (file = await getFileFromSource(ctx, annotationSourceFromSpec(spec)));\n        let data;\n        switch (file.format) {\n            case 'json':\n                data = file;\n                break;\n            case 'cif':\n                if (file.data.blocks.length === 0)\n                    throw new Error('No block in CIF');\n                const blockSpec = spec.cifBlock;\n                let block;\n                switch (blockSpec.name) {\n                    case 'header':\n                        const foundBlock = file.data.blocks.find(b => b.header === blockSpec.params.header);\n                        if (!foundBlock)\n                            throw new Error(`CIF block with header ${blockSpec.params.header} not found`);\n                        block = foundBlock;\n                        break;\n                    case 'index':\n                        block = file.data.blocks[blockSpec.params.index];\n                        if (!block)\n                            throw new Error(`CIF block with index ${blockSpec.params.index} not found`);\n                        break;\n                }\n                const categoryName = (_a = spec.cifCategory) !== null && _a !== void 0 ? _a : Object.keys(block.categories)[0];\n                if (!categoryName)\n                    throw new Error('There are no categories in CIF block');\n                const category = block.categories[categoryName];\n                if (!category)\n                    throw new Error(`CIF category ${categoryName} not found`);\n                data = { format: 'cif', data: category };\n                break;\n        }\n        return new MVSAnnotation(data, spec.schema);\n    }\n    static createEmpty(schema) {\n        return new MVSAnnotation({ format: 'json', data: [] }, schema);\n    }\n    /** Reference implementation of `getAnnotationForLocation`, just for checking, DO NOT USE DIRECTLY */\n    getAnnotationForLocation_Reference(loc) {\n        const model = loc.unit.model;\n        const iAtom = loc.element;\n        let result = undefined;\n        for (const row of this.getRows()) {\n            if (atomQualifies(model, iAtom, row))\n                result = row;\n        }\n        return result;\n    }\n    /** Return value of field `fieldName` assigned to location `loc`, if any */\n    getValueForLocation(loc, fieldName) {\n        const indexedModel = this.getIndexedModel(loc.unit.model);\n        const iRow = indexedModel[loc.element];\n        return this.getValueForRow(iRow, fieldName);\n    }\n    /** Return value of field `fieldName` assigned to `i`-th annotation row, if any */\n    getValueForRow(i, fieldName) {\n        if (i < 0)\n            return undefined;\n        switch (this.data.format) {\n            case 'json':\n                const value = getValueFromJson(i, fieldName, this.data.data);\n                if (value === undefined || typeof value === 'string')\n                    return value;\n                else\n                    return `${value}`;\n            case 'cif':\n                return getValueFromCif(i, fieldName, this.data.data);\n        }\n    }\n    /** Return cached `ElementIndex` -> `MVSAnnotationRow` mapping for `Model` (or create it if not cached yet) */\n    getIndexedModel(model) {\n        const key = model.id;\n        if (!this.indexedModels.has(key)) {\n            const result = this.getRowForEachAtom(model);\n            this.indexedModels.set(key, result);\n        }\n        return this.indexedModels.get(key);\n    }\n    /** Create `ElementIndex` -> `MVSAnnotationRow` mapping for `Model` */\n    getRowForEachAtom(model) {\n        const indices = IndicesAndSortings.get(model);\n        const nAtoms = model.atomicHierarchy.atoms._rowCount;\n        const result = Array(nAtoms).fill(-1);\n        const rows = this.getRows();\n        for (let i = 0, nRows = rows.length; i < nRows; i++) {\n            const atomRanges = getAtomRangesForRow(model, rows[i], indices);\n            AtomRanges.foreach(atomRanges, (from, to) => result.fill(i, from, to));\n        }\n        return result;\n    }\n    /** Parse and return all annotation rows in this annotation */\n    _getRows() {\n        switch (this.data.format) {\n            case 'json':\n                return getRowsFromJson(this.data.data, this.schema);\n            case 'cif':\n                return getRowsFromCif(this.data.data, this.schema);\n        }\n    }\n    /** Parse and return all annotation rows in this annotation, or return cached result if available */\n    getRows() {\n        var _a;\n        return (_a = this.rows) !== null && _a !== void 0 ? _a : (this.rows = this._getRows());\n    }\n}\nfunction getValueFromJson(rowIndex, fieldName, data) {\n    var _a, _b;\n    const js = data;\n    if (Array.isArray(js)) {\n        const row = (_a = js[rowIndex]) !== null && _a !== void 0 ? _a : {};\n        return row[fieldName];\n    }\n    else {\n        const column = (_b = js[fieldName]) !== null && _b !== void 0 ? _b : [];\n        return column[rowIndex];\n    }\n}\nfunction getValueFromCif(rowIndex, fieldName, data) {\n    const column = data.getField(fieldName);\n    if (!column)\n        return undefined;\n    if (column.valueKind(rowIndex) !== Column.ValueKind.Present)\n        return undefined;\n    return column.str(rowIndex);\n}\nfunction getRowsFromJson(data, schema) {\n    const js = data;\n    const cifSchema = getCifAnnotationSchema(schema);\n    if (Array.isArray(js)) {\n        // array of objects\n        return js.map(row => pickObjectKeys(row, Object.keys(cifSchema)));\n    }\n    else {\n        // object of arrays\n        const rows = [];\n        const keys = Object.keys(js).filter(key => Object.hasOwn(cifSchema, key));\n        if (keys.length > 0) {\n            const n = js[keys[0]].length;\n            if (keys.some(key => js[key].length !== n))\n                throw new Error('FormatError: arrays must have the same length.');\n            for (let i = 0; i < n; i++) {\n                const item = {};\n                for (const key of keys) {\n                    item[key] = js[key][i];\n                }\n                rows.push(item);\n            }\n        }\n        return rows;\n    }\n}\nfunction getRowsFromCif(data, schema) {\n    const rows = [];\n    const cifSchema = getCifAnnotationSchema(schema);\n    const table = toTable(cifSchema, data);\n    arrayExtend(rows, getRowsFromTable(table)); // Avoiding Table.getRows(table) as it replaces . and ? fields by 0 or ''\n    return rows;\n}\n/** Same as `Table.getRows` but omits `.` and `?` fields (instead of using type defaults) */\nfunction getRowsFromTable(table) {\n    const rows = [];\n    const columns = table._columns;\n    const nRows = table._rowCount;\n    const Present = Column.ValueKind.Present;\n    for (let iRow = 0; iRow < nRows; iRow++) {\n        const row = {};\n        for (const col of columns) {\n            if (table[col].valueKind(iRow) === Present) {\n                row[col] = table[col].value(iRow);\n            }\n        }\n        rows[iRow] = row;\n    }\n    return rows;\n}\nasync function getFileFromSource(ctx, source, model) {\n    switch (source.kind) {\n        case 'source-cif':\n            return { format: 'cif', data: getSourceFileFromModel(model) };\n        case 'url':\n            const url = Asset.getUrlAsset(ctx.assetManager, source.url);\n            const dataType = MVSAnnotationFormatTypes[source.format];\n            const dataWrapper = await ctx.assetManager.resolve(url, dataType).runInContext(ctx.runtime);\n            const rawData = dataWrapper.data;\n            if (!rawData)\n                throw new Error('Missing data');\n            switch (source.format) {\n                case 'json':\n                    const json = JSON.parse(rawData);\n                    return { format: 'json', data: json };\n                case 'cif':\n                case 'bcif':\n                    const parsed = await CIF.parse(rawData).run();\n                    if (parsed.isError)\n                        throw new Error(`Failed to parse ${source.format}`);\n                    return { format: 'cif', data: parsed.result };\n            }\n    }\n}\n/** Like `sources.map(s => safePromise(getFileFromSource(ctx, s)))`\n * but downloads a repeating source only once. */\nasync function getFilesFromSources(ctx, sources, model) {\n    var _a;\n    const promises = {};\n    for (const src of sources) {\n        const key = canonicalJsonString(src);\n        (_a = promises[key]) !== null && _a !== void 0 ? _a : (promises[key] = safePromise(getFileFromSource(ctx, src, model)));\n    }\n    const files = await promiseAllObj(promises);\n    return sources.map(src => files[canonicalJsonString(src)]);\n}\nfunction getSourceFileFromModel(model) {\n    if (model && MmcifFormat.is(model.sourceData)) {\n        if (model.sourceData.data.file) {\n            return model.sourceData.data.file;\n        }\n        else {\n            const frame = model.sourceData.data.frame;\n            const block = CifBlock(Array.from(frame.categoryNames), frame.categories, frame.header);\n            const file = CifFile([block]);\n            return file;\n        }\n    }\n    else {\n        console.warn('Could not get CifFile from Model, returning empty CifFile');\n        return CifFile([]);\n    }\n}\nfunction annotationSourceFromSpec(s) {\n    switch (s.source.name) {\n        case 'url':\n            return { kind: 'url', ...s.source.params };\n        case 'source-cif':\n            return { kind: 'source-cif' };\n    }\n}\n", "/**\n * Copyright (c) 2024 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Adam Midlik <midlik@gmail.com>\n */\nimport { CustomModelProperty } from '../../../mol-model-props/common/custom-model-property';\nimport { CustomPropertyDescriptor } from '../../../mol-model/custom-property';\nimport { ParamDefinition as PD } from '../../../mol-util/param-definition';\nexport const IsMVSModelParams = {\n    isMvs: PD.Boolean(false, { description: 'Flag this model as managed by MolViewSpec and enable MolViewSpec features' }),\n};\n/** Provider for custom model property \"Is MVS\" */\nexport const IsMVSModelProvider = CustomModelProperty.createProvider({\n    label: 'MVS',\n    descriptor: CustomPropertyDescriptor({\n        name: 'mvs-is-mvs-model',\n    }),\n    type: 'static',\n    defaultParams: IsMVSModelParams,\n    getParams: (data) => IsMVSModelParams,\n    isApplicable: (data) => true,\n    obtain: async (ctx, data, props) => ({ value: {} }),\n});\n/** Decide if the model is flagged as managed by MolViewSpec */\nexport function isMVSModel(model) {\n    var _a;\n    return !!((_a = IsMVSModelProvider.props(model)) === null || _a === void 0 ? void 0 : _a.isMvs);\n}\n/** Decide if the structure is flagged as managed by MolViewSpec */\nexport function isMVSStructure(structure) {\n    return structure.models.some(isMVSModel);\n}\n", "/**\n * Copyright (c) 2023-2024 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Adam Midlik <midlik@gmail.com>\n */\nimport { Bond, StructureElement } from '../../../mol-model/structure';\nimport { ColorNames } from '../../../mol-util/color/names';\nimport { ParamDefinition as PD } from '../../../mol-util/param-definition';\nimport { decodeColor } from '../helpers/utils';\nimport { getMVSAnnotationForStructure } from './annotation-prop';\nimport { isMVSStructure } from './is-mvs-model-prop';\n/** Parameter definition for color theme \"MVS Annotation\" */\nexport const MVSAnnotationColorThemeParams = {\n    annotationId: PD.Text('', { description: 'Reference to \"Annotation\" custom model property' }),\n    fieldName: PD.Text('color', { description: 'Annotation field (column) from which to take color values' }),\n    background: PD.Color(ColorNames.gainsboro, { description: 'Color for elements without annotation' }),\n};\n/** Return color theme that assigns colors based on an annotation file.\n * The annotation file itself is handled by a custom model property (`MVSAnnotationsProvider`),\n * the color theme then just uses this property. */\nexport function MVSAnnotationColorTheme(ctx, props) {\n    let color = () => props.background;\n    if (ctx.structure && !ctx.structure.isEmpty) {\n        const { annotation } = getMVSAnnotationForStructure(ctx.structure, props.annotationId);\n        if (annotation) {\n            const colorForStructureElementLocation = (location) => {\n                var _a;\n                // if (annot.getAnnotationForLocation(location)?.color !== annot.getAnnotationForLocation_Reference(location)?.color) throw new Error('AssertionError');\n                return (_a = decodeColor(annotation === null || annotation === void 0 ? void 0 : annotation.getValueForLocation(location, props.fieldName))) !== null && _a !== void 0 ? _a : props.background;\n            };\n            const auxLocation = StructureElement.Location.create(ctx.structure);\n            color = (location) => {\n                if (StructureElement.Location.is(location)) {\n                    return colorForStructureElementLocation(location);\n                }\n                else if (Bond.isLocation(location)) {\n                    // this will be applied for each bond twice, to get color of each half (a* refers to the adjacent atom, b* to the opposite atom)\n                    auxLocation.unit = location.aUnit;\n                    auxLocation.element = location.aUnit.elements[location.aIndex];\n                    return colorForStructureElementLocation(auxLocation);\n                }\n                return props.background;\n            };\n        }\n        else {\n            console.error(`Annotation source \"${props.annotationId}\" not present`);\n        }\n    }\n    return {\n        factory: MVSAnnotationColorTheme,\n        granularity: 'group',\n        preferSmoothing: true,\n        color: color,\n        props: props,\n        description: 'Assigns colors based on custom MolViewSpec annotation data.',\n    };\n}\n/** A thingy that is needed to register color theme \"MVS Annotation\" */\nexport const MVSAnnotationColorThemeProvider = {\n    name: 'mvs-annotation',\n    label: 'MVS Annotation',\n    category: 'Miscellaneous', // ColorTheme.Category.Misc can cause webpack build error due to import ordering\n    factory: MVSAnnotationColorTheme,\n    getParams: ctx => MVSAnnotationColorThemeParams,\n    defaultValues: PD.getDefaultValues(MVSAnnotationColorThemeParams),\n    isApplicable: (ctx) => !!ctx.structure && isMVSStructure(ctx.structure),\n};\n", "/**\n * Copyright (c) 2023 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Adam Midlik <midlik@gmail.com>\n */\nimport { BoundaryHelper } from '../../../mol-math/geometry/boundary-helper';\nimport { Vec3 } from '../../../mol-math/linear-algebra';\nimport { StructureElement, StructureProperties } from '../../../mol-model/structure';\nimport { arrayExtend } from '../../../mol-util/array';\nimport { AtomRanges } from './atom-ranges';\nimport { IndicesAndSortings } from './indexing';\nimport { getAtomRangesForRows } from './selections';\nconst tmpVec = Vec3();\nconst tmpArray = [];\nconst boundaryHelper = new BoundaryHelper('98');\nconst outAtoms = [];\nconst outFirstAtomIndex = {};\n/** Return `TextProps` (position, size, etc.) for a text that is to be bound to a substructure of `structure` defined by union of `rows`.\n * Derives `center` and `depth` from the boundary sphere of the substructure, `scale` from the number of heavy atoms in the substructure. */\nexport function textPropsForSelection(structure, sizeFunction, rows, onlyInModel) {\n    var _a;\n    var _b;\n    const loc = StructureElement.Location.create(structure);\n    const { units } = structure;\n    const { type_symbol } = StructureProperties.atom;\n    tmpArray.length = 0;\n    let includedAtoms = 0;\n    let includedHeavyAtoms = 0;\n    let group = undefined;\n    let atomSize = undefined;\n    const rangesByModel = {};\n    for (let iUnit = 0, nUnits = units.length; iUnit < nUnits; iUnit++) {\n        const unit = units[iUnit];\n        if (onlyInModel && unit.model.id !== onlyInModel.id)\n            continue;\n        const ranges = (_a = rangesByModel[_b = unit.model.id]) !== null && _a !== void 0 ? _a : (rangesByModel[_b] = getAtomRangesForRows(unit.model, rows, IndicesAndSortings.get(unit.model)));\n        loc.unit = unit;\n        AtomRanges.selectAtomsInRanges(unit.elements, ranges, outAtoms, outFirstAtomIndex);\n        for (const atom of outAtoms) {\n            loc.element = atom;\n            unit.conformation.position(atom, tmpVec);\n            arrayExtend(tmpArray, tmpVec);\n            group !== null && group !== void 0 ? group : (group = structure.serialMapping.cumulativeUnitElementCount[iUnit] + outFirstAtomIndex.value);\n            atomSize !== null && atomSize !== void 0 ? atomSize : (atomSize = sizeFunction(loc));\n            includedAtoms++;\n            if (type_symbol(loc) !== 'H')\n                includedHeavyAtoms++;\n        }\n    }\n    if (includedAtoms > 0) {\n        const { center, radius } = (includedAtoms > 1) ? boundarySphere(tmpArray) : { center: Vec3.fromArray(Vec3(), tmpArray, 0), radius: 1.1 * atomSize };\n        const scale = (includedHeavyAtoms || includedAtoms) ** (1 / 3);\n        return { center, depth: radius, scale, group: group };\n    }\n}\n/** Calculate the boundary sphere for a set of points given by their flattened coordinates (`flatCoords.slice(0,3)` is the first point etc.) */\nfunction boundarySphere(flatCoords) {\n    const length = flatCoords.length;\n    boundaryHelper.reset();\n    for (let offset = 0; offset < length; offset += 3) {\n        Vec3.fromArray(tmpVec, flatCoords, offset);\n        boundaryHelper.includePosition(tmpVec);\n    }\n    boundaryHelper.finishedIncludeStep();\n    for (let offset = 0; offset < length; offset += 3) {\n        Vec3.fromArray(tmpVec, flatCoords, offset);\n        boundaryHelper.radiusPosition(tmpVec);\n    }\n    return boundaryHelper.getSphere();\n}\n", "/**\n * Copyright (c) 2023 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Adam Midlik <midlik@gmail.com>\n */\nimport { TextBuilder } from '../../../../mol-geo/geometry/text/text-builder';\nimport { ComplexTextVisual } from '../../../../mol-repr/structure/complex-visual';\nimport * as Original from '../../../../mol-repr/structure/visual/label-text';\nimport { ElementIterator, eachSerialElement, getSerialElementLoci } from '../../../../mol-repr/structure/visual/util/element';\nimport { ColorNames } from '../../../../mol-util/color/names';\nimport { omitObjectKeys } from '../../../../mol-util/object';\nimport { ParamDefinition as PD } from '../../../../mol-util/param-definition';\nimport { textPropsForSelection } from '../../helpers/label-text';\nimport { groupRows } from '../../helpers/selections';\nimport { getMVSAnnotationForStructure } from '../annotation-prop';\nexport const MVSAnnotationLabelTextParams = {\n    annotationId: PD.Text('', { description: 'Reference to \"Annotation\" custom model property', isEssential: true }),\n    fieldName: PD.Text('label', { description: 'Annotation field (column) from which to take label contents', isEssential: true }),\n    ...omitObjectKeys(Original.LabelTextParams, ['level', 'chainScale', 'residueScale', 'elementScale']),\n    borderColor: { ...Original.LabelTextParams.borderColor, defaultValue: ColorNames.black },\n};\n/** Create \"label-text\" visual for \"MVS Annotation Label\" representation */\nexport function MVSAnnotationLabelTextVisual(materialId) {\n    return ComplexTextVisual({\n        defaultProps: PD.getDefaultValues(MVSAnnotationLabelTextParams),\n        createGeometry: createLabelText,\n        createLocationIterator: ElementIterator.fromStructure,\n        getLoci: getSerialElementLoci,\n        eachLocation: eachSerialElement,\n        setUpdateState: (state, newProps, currentProps) => {\n            state.createGeometry = newProps.annotationId !== currentProps.annotationId || newProps.fieldName !== currentProps.fieldName;\n        }\n    }, materialId);\n}\nfunction createLabelText(ctx, structure, theme, props, text) {\n    var _a;\n    const { annotation, model } = getMVSAnnotationForStructure(structure, props.annotationId);\n    const rows = (_a = annotation === null || annotation === void 0 ? void 0 : annotation.getRows()) !== null && _a !== void 0 ? _a : [];\n    const { count, offsets, grouped } = groupRows(rows);\n    const builder = TextBuilder.create(props, count, count / 2, text);\n    for (let iGroup = 0; iGroup < count; iGroup++) {\n        const iFirstRowInGroup = grouped[offsets[iGroup]];\n        const labelText = annotation.getValueForRow(iFirstRowInGroup, props.fieldName);\n        if (!labelText)\n            continue;\n        const rowsInGroup = grouped.slice(offsets[iGroup], offsets[iGroup + 1]).map(j => rows[j]);\n        const p = textPropsForSelection(structure, theme.size.size, rowsInGroup, model);\n        if (!p)\n            continue;\n        builder.add(labelText, p.center[0], p.center[1], p.center[2], p.depth, p.scale, p.group);\n    }\n    return builder.getText();\n}\n", "/**\n * Copyright (c) 2023-2024 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Adam Midlik <midlik@gmail.com>\n */\nimport { Representation } from '../../../../mol-repr/representation';\nimport { ComplexRepresentation, StructureRepresentationProvider, StructureRepresentationStateBuilder } from '../../../../mol-repr/structure/representation';\nimport { MarkerAction } from '../../../../mol-util/marker-action';\nimport { ParamDefinition as PD } from '../../../../mol-util/param-definition';\nimport { isMVSStructure } from '../is-mvs-model-prop';\nimport { MVSAnnotationLabelTextParams, MVSAnnotationLabelTextVisual } from './visual';\n/** Components of \"MVS Annotation Label\" representation */\nconst MVSAnnotationLabelVisuals = {\n    'label-text': (ctx, getParams) => ComplexRepresentation('Label text', ctx, getParams, MVSAnnotationLabelTextVisual),\n};\nexport const MVSAnnotationLabelParams = {\n    ...MVSAnnotationLabelTextParams,\n    visuals: PD.MultiSelect(['label-text'], PD.objectToOptions(MVSAnnotationLabelVisuals)),\n};\nexport function MVSAnnotationLabelRepresentation(ctx, getParams) {\n    const repr = Representation.createMulti('Label', ctx, getParams, StructureRepresentationStateBuilder, MVSAnnotationLabelVisuals);\n    repr.setState({ pickable: false, markerActions: MarkerAction.None });\n    return repr;\n}\n/** A thingy that is needed to register representation type \"MVS Annotation Label\", allowing showing labels based on \"MVS Annotations\" custom props */\nexport const MVSAnnotationLabelRepresentationProvider = StructureRepresentationProvider({\n    name: 'mvs-annotation-label',\n    label: 'MVS Annotation Label',\n    description: 'Displays labels based on annotation custom model property',\n    factory: MVSAnnotationLabelRepresentation,\n    getParams: () => MVSAnnotationLabelParams,\n    defaultValues: PD.getDefaultValues(MVSAnnotationLabelParams),\n    defaultColorTheme: { name: 'uniform' }, // this ain't workin\n    defaultSizeTheme: { name: 'physical' },\n    isApplicable: (structure) => structure.elementCount > 0 && isMVSStructure(structure),\n});\n", "/**\n * Copyright (c) 2023 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Adam Midlik <midlik@gmail.com>\n */\nimport { CustomStructureProperty } from '../../../mol-model-props/common/custom-structure-property';\nimport { CustomPropertyDescriptor } from '../../../mol-model/custom-property';\nimport { StructureElement } from '../../../mol-model/structure';\nimport { ParamDefinition as PD } from '../../../mol-util/param-definition';\nimport { filterDefined } from '../helpers/utils';\nimport { MVSAnnotationsProvider } from './annotation-prop';\n/** Parameter definition for custom structure property \"MVSAnnotationTooltips\" */\nexport const MVSAnnotationTooltipsParams = {\n    tooltips: PD.ObjectList({\n        annotationId: PD.Text('', { description: 'Reference to \"MVS Annotation\" custom model property' }),\n        fieldName: PD.Text('tooltip', { description: 'Annotation field (column) from which to take color values' }),\n    }, obj => `${obj.annotationId}:${obj.fieldName}`),\n};\n/** Provider for custom structure property \"MVSAnnotationTooltips\" */\nexport const MVSAnnotationTooltipsProvider = CustomStructureProperty.createProvider({\n    label: 'MVS Annotation Tooltips',\n    descriptor: CustomPropertyDescriptor({\n        name: 'mvs-annotation-tooltips',\n    }),\n    type: 'local',\n    defaultParams: MVSAnnotationTooltipsParams,\n    getParams: (data) => MVSAnnotationTooltipsParams,\n    isApplicable: (data) => data.root === data,\n    obtain: async (ctx, data, props) => {\n        const fullProps = { ...PD.getDefaultValues(MVSAnnotationTooltipsParams), ...props };\n        return { value: fullProps };\n    },\n});\n/** Label provider based on data from \"MVS Annotation\" custom model property */\nexport const MVSAnnotationTooltipsLabelProvider = {\n    label: (loci) => {\n        switch (loci.kind) {\n            case 'element-loci':\n                if (!loci.structure.customPropertyDescriptors.hasReference(MVSAnnotationTooltipsProvider.descriptor))\n                    return undefined;\n                const location = StructureElement.Loci.getFirstLocation(loci);\n                if (!location)\n                    return undefined;\n                const tooltipProps = MVSAnnotationTooltipsProvider.get(location.structure).value;\n                if (!tooltipProps || tooltipProps.tooltips.length === 0)\n                    return undefined;\n                const annotations = MVSAnnotationsProvider.get(location.unit.model).value;\n                const texts = tooltipProps.tooltips.map(p => { var _a; return (_a = annotations === null || annotations === void 0 ? void 0 : annotations.getAnnotation(p.annotationId)) === null || _a === void 0 ? void 0 : _a.getValueForLocation(location, p.fieldName); });\n                return filterDefined(texts).join(' | ');\n            default:\n                return undefined;\n        }\n    }\n};\n", "/**\n * Copyright (c) 2023 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Adam Midlik <midlik@gmail.com>\n */\nimport { Structure, StructureSelection } from '../../../mol-model/structure';\nimport { StructureQueryHelper } from '../../../mol-plugin-state/helpers/structure-query';\nimport { PluginStateObject as SO } from '../../../mol-plugin-state/objects';\nimport { StateObject, StateTransformer } from '../../../mol-state';\nimport { deepEqual } from '../../../mol-util';\nimport { omitObjectKeys } from '../../../mol-util/object';\nimport { ParamDefinition as PD } from '../../../mol-util/param-definition';\nimport { rowsToExpression } from '../helpers/selections';\nimport { getMVSAnnotationForStructure } from './annotation-prop';\n/** Parameter definition for `MVSAnnotationStructureComponent` transformer */\nexport const MVSAnnotationStructureComponentParams = {\n    annotationId: PD.Text('', { description: 'Reference to \"Annotation\" custom model property' }),\n    fieldName: PD.Text('component', { description: 'Annotation field (column) from which to take component identifier' }),\n    fieldValues: PD.MappedStatic('all', {\n        all: PD.EmptyGroup(),\n        selected: PD.ObjectList({\n            value: PD.Text(),\n        }, obj => obj.value),\n    }),\n    nullIfEmpty: PD.Optional(PD.Boolean(true, { isHidden: false })),\n    label: PD.Text('', { isHidden: false }),\n};\n/** Transformer builder for MVS extension */\nexport const MVSTransform = StateTransformer.builderFactory('mvs');\nexport const MVSAnnotationStructureComponent = MVSTransform({\n    name: 'mvs-structure-component-from-annotation',\n    display: { name: 'MVS Annotation Component', description: 'A molecular structure component defined by MVS annotation data.' },\n    from: SO.Molecule.Structure,\n    to: SO.Molecule.Structure,\n    params: MVSAnnotationStructureComponentParams,\n})({\n    apply({ a, params }) {\n        return createMVSAnnotationStructureComponent(a.data, params);\n    },\n    update: ({ a, b, oldParams, newParams }) => {\n        return updateMVSAnnotationStructureComponent(a.data, b, oldParams, newParams);\n    },\n    dispose({ b }) {\n        b === null || b === void 0 ? void 0 : b.data.customPropertyDescriptors.dispose();\n    }\n});\n/** Create a substructure based on `MVSAnnotationStructureComponentProps` */\nexport function createMVSAnnotationSubstructure(structure, params) {\n    const { annotation } = getMVSAnnotationForStructure(structure, params.annotationId);\n    if (annotation) {\n        let rows = annotation.getRows();\n        if (params.fieldValues.name === 'selected') {\n            const selectedValues = new Set(params.fieldValues.params.map(obj => obj.value));\n            rows = rows.filter((row, i) => selectedValues.has(annotation.getValueForRow(i, params.fieldName)));\n        }\n        const expression = rowsToExpression(rows);\n        const { selection } = StructureQueryHelper.createAndRun(structure, expression);\n        return StructureSelection.unionStructure(selection);\n    }\n    else {\n        return Structure.Empty;\n    }\n}\n/** Create a substructure PSO based on `MVSAnnotationStructureComponentProps` */\nexport function createMVSAnnotationStructureComponent(structure, params) {\n    const component = createMVSAnnotationSubstructure(structure, params);\n    if (params.nullIfEmpty && component.elementCount === 0)\n        return StateObject.Null;\n    let label = params.label;\n    if (label === undefined || label === '') {\n        if (params.fieldValues.name === 'selected' && params.fieldValues.params.length > 0) {\n            const values = params.fieldValues.params;\n            let valuesStr = `\"${values[0].value}\"`;\n            if (values.length === 2) {\n                valuesStr += ` + \"${values[1].value}\"`;\n            }\n            else if (values.length > 2) {\n                valuesStr += ` + ${values.length - 1} more values`;\n            }\n            label = `MVS Annotation Component (${params.fieldName}: ${valuesStr})`;\n        }\n        else {\n            label = 'MVS Annotation Component';\n        }\n    }\n    const props = { label, description: Structure.elementDescription(component) };\n    return new SO.Molecule.Structure(component, props);\n}\n/** Update a substructure PSO based on `MVSAnnotationStructureComponentProps` */\nexport function updateMVSAnnotationStructureComponent(a, b, oldParams, newParams) {\n    const change = !deepEqual(newParams, oldParams);\n    const needsRecreate = !deepEqual(omitObjectKeys(newParams, ['label']), omitObjectKeys(oldParams, ['label']));\n    if (!change) {\n        return StateTransformer.UpdateResult.Unchanged;\n    }\n    if (!needsRecreate) {\n        b.label = newParams.label || b.label;\n        return StateTransformer.UpdateResult.Updated;\n    }\n    return StateTransformer.UpdateResult.Recreate;\n}\n", "/**\n * Copyright (c) 2023 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Adam Midlik <midlik@gmail.com>\n */\nimport { SortedArray } from '../../../mol-data/int';\nimport { Structure, StructureElement } from '../../../mol-model/structure';\nimport { StaticStructureComponentTypes, createStructureComponent } from '../../../mol-plugin-state/helpers/structure-component';\nimport { PluginStateObject } from '../../../mol-plugin-state/objects';\nimport { MolScriptBuilder } from '../../../mol-script/language/builder';\nimport { arrayExtend, sortIfNeeded } from '../../../mol-util/array';\nimport { mapArrayToObject, pickObjectKeys } from '../../../mol-util/object';\nimport { Choice } from '../../../mol-util/param-choice';\nimport { ParamDefinition as PD } from '../../../mol-util/param-definition';\nimport { capitalize } from '../../../mol-util/string';\nimport { MVSAnnotationStructureComponentParams, createMVSAnnotationStructureComponent } from './annotation-structure-component';\n/** Allowed values for a static selector */\nexport const StaticSelectorChoice = new Choice(mapArrayToObject(StaticStructureComponentTypes, t => capitalize(t)), 'all');\n/** Parameter definition for specifying a part of structure (kinda extension of `StructureComponentParams` from mol-plugin-state/helpers/structure-component) */\nexport const SelectorParams = PD.MappedStatic('static', {\n    static: StaticSelectorChoice.PDSelect(),\n    expression: PD.Value(MolScriptBuilder.struct.generator.all),\n    bundle: PD.Value(StructureElement.Bundle.Empty),\n    script: PD.Script({ language: 'mol-script', expression: '(sel.atom.all)' }),\n    annotation: PD.Group(pickObjectKeys(MVSAnnotationStructureComponentParams, ['annotationId', 'fieldName', 'fieldValues'])),\n}, { description: 'Define a part of the structure where this layer applies (use Static:all to apply to the whole structure)' });\n/** `Selector` for selecting the whole structure */\nexport const SelectorAll = { name: 'static', params: 'all' };\n/** Decide whether a selector is `SelectorAll` */\nexport function isSelectorAll(props) {\n    return props.name === 'static' && props.params === 'all';\n}\nexport const ElementSet = {\n    /** Create an `ElementSet` from the substructure of `structure` defined by `selector` */\n    fromSelector(structure, selector) {\n        var _a;\n        var _b;\n        if (!structure)\n            return {};\n        const arrays = {};\n        const selection = substructureFromSelector(structure, selector); // using `getAtomRangesForRow` might (might not) be faster here\n        for (const unit of selection.units) {\n            arrayExtend((_a = arrays[_b = unit.model.id]) !== null && _a !== void 0 ? _a : (arrays[_b] = []), unit.elements);\n        }\n        const result = {};\n        for (const modelId in arrays) {\n            const array = arrays[modelId];\n            sortIfNeeded(array, (a, b) => a - b);\n            result[modelId] = SortedArray.ofSortedArray(array);\n        }\n        return result;\n    },\n    /** Decide if the element set `set` contains structure element location `location` */\n    has(set, location) {\n        const array = set[location.unit.model.id];\n        return array ? SortedArray.has(array, location.element) : false;\n    },\n};\n/** Return a substructure of `structure` defined by `selector` */\nexport function substructureFromSelector(structure, selector) {\n    const pso = (selector.name === 'annotation') ?\n        createMVSAnnotationStructureComponent(structure, { ...selector.params, label: '', nullIfEmpty: false })\n        : createStructureComponent(structure, { type: selector, label: '', nullIfEmpty: false }, { source: structure });\n    return PluginStateObject.Molecule.Structure.is(pso) ? pso.data : Structure.Empty;\n}\n", "/**\n * Copyright (c) 2023 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Adam Midlik <midlik@gmail.com>\n */\nimport { SortedArray } from '../../../../mol-data/int';\nimport { TextBuilder } from '../../../../mol-geo/geometry/text/text-builder';\nimport { ComplexTextVisual } from '../../../../mol-repr/structure/complex-visual';\nimport * as Original from '../../../../mol-repr/structure/visual/label-text';\nimport { ElementIterator, eachSerialElement, getSerialElementLoci } from '../../../../mol-repr/structure/visual/util/element';\nimport { deepEqual } from '../../../../mol-util';\nimport { ColorNames } from '../../../../mol-util/color/names';\nimport { omitObjectKeys } from '../../../../mol-util/object';\nimport { ParamDefinition as PD } from '../../../../mol-util/param-definition';\nimport { textPropsForSelection } from '../../helpers/label-text';\nimport { SelectorParams, substructureFromSelector } from '../selector';\nexport const CustomLabelTextParams = {\n    items: PD.ObjectList({\n        text: PD.Text('\\\\_()_/'),\n        position: PD.MappedStatic('selection', {\n            x_y_z: PD.Group({\n                x: PD.Numeric(0),\n                y: PD.Numeric(0),\n                z: PD.Numeric(0),\n                scale: PD.Numeric(1, { min: 0, max: 20, step: 0.1 })\n            }),\n            selection: PD.Group({\n                selector: SelectorParams,\n            }),\n        }),\n    }, obj => obj.text, { isEssential: true }),\n    ...omitObjectKeys(Original.LabelTextParams, ['level', 'chainScale', 'residueScale', 'elementScale']),\n    borderColor: { ...Original.LabelTextParams.borderColor, defaultValue: ColorNames.black },\n};\n/** Create \"label-text\" visual for \"Custom Label\" representation */\nexport function CustomLabelTextVisual(materialId) {\n    return ComplexTextVisual({\n        defaultProps: PD.getDefaultValues(CustomLabelTextParams),\n        createGeometry: createLabelText,\n        createLocationIterator: ElementIterator.fromStructure,\n        getLoci: getSerialElementLoci,\n        eachLocation: eachSerialElement,\n        setUpdateState: (state, newProps, currentProps) => {\n            state.createGeometry = !deepEqual(newProps.items, currentProps.items);\n        }\n    }, materialId);\n}\nfunction createLabelText(ctx, structure, theme, props, text) {\n    var _a;\n    const count = props.items.length;\n    const builder = TextBuilder.create(props, count, count / 2, text);\n    for (const item of props.items) {\n        switch (item.position.name) {\n            case 'x_y_z':\n                const scale = item.position.params.scale;\n                builder.add(item.text, item.position.params.x, item.position.params.y, item.position.params.z, scale, scale, 0);\n                break;\n            case 'selection':\n                const substructure = substructureFromSelector(structure, item.position.params.selector);\n                const p = textPropsForSelection(substructure, theme.size.size, {});\n                const group = (_a = serialIndexOfSubstructure(structure, substructure)) !== null && _a !== void 0 ? _a : 0;\n                if (p)\n                    builder.add(item.text, p.center[0], p.center[1], p.center[2], p.depth, p.scale, group);\n                break;\n        }\n    }\n    return builder.getText();\n}\n/** Return the serial index within `structure` of the first element of `substructure` (or `undefined` in that element is not in `structure`)  */\nfunction serialIndexOfSubstructure(structure, substructure) {\n    if (substructure.isEmpty)\n        return undefined;\n    const theUnit = substructure.units[0];\n    const theElement = theUnit.elements[0];\n    for (const unit of structure.units) {\n        if (unit.model.id === theUnit.model.id && SortedArray.has(unit.elements, theElement)) {\n            return structure.serialMapping.getSerialIndex(unit, theElement);\n        }\n    }\n    return undefined;\n}\n", "/**\n * Copyright (c) 2023-2024 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Adam Midlik <midlik@gmail.com>\n */\nimport { Representation } from '../../../../mol-repr/representation';\nimport { ComplexRepresentation, StructureRepresentationProvider, StructureRepresentationStateBuilder } from '../../../../mol-repr/structure/representation';\nimport { MarkerAction } from '../../../../mol-util/marker-action';\nimport { ParamDefinition as PD } from '../../../../mol-util/param-definition';\nimport { isMVSStructure } from '../is-mvs-model-prop';\nimport { CustomLabelTextParams, CustomLabelTextVisual } from './visual';\n/** Components of \"Custom Label\" representation */\nconst CustomLabelVisuals = {\n    'label-text': (ctx, getParams) => ComplexRepresentation('Label text', ctx, getParams, CustomLabelTextVisual),\n};\nexport const CustomLabelParams = {\n    ...CustomLabelTextParams,\n    visuals: PD.MultiSelect(['label-text'], PD.objectToOptions(CustomLabelVisuals)),\n};\nexport function CustomLabelRepresentation(ctx, getParams) {\n    const repr = Representation.createMulti('Label', ctx, getParams, StructureRepresentationStateBuilder, CustomLabelVisuals);\n    repr.setState({ pickable: false, markerActions: MarkerAction.None });\n    return repr;\n}\n/** A thingy that is needed to register representation type \"Custom Label\", allowing user-defined labels at at user-defined positions */\nexport const CustomLabelRepresentationProvider = StructureRepresentationProvider({\n    name: 'mvs-custom-label',\n    label: 'MVS Custom Label',\n    description: 'Displays labels with custom text',\n    factory: CustomLabelRepresentation,\n    getParams: () => CustomLabelParams,\n    defaultValues: PD.getDefaultValues(CustomLabelParams),\n    defaultColorTheme: { name: 'uniform' },\n    defaultSizeTheme: { name: 'physical' },\n    isApplicable: (structure) => structure.elementCount > 0 && isMVSStructure(structure),\n});\n", "/**\n * Copyright (c) 2023-2024 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Adam Midlik <midlik@gmail.com>\n */\nimport { CustomStructureProperty } from '../../../mol-model-props/common/custom-structure-property';\nimport { CustomPropertyDescriptor } from '../../../mol-model/custom-property';\nimport { StructureElement } from '../../../mol-model/structure';\nimport { ParamDefinition as PD } from '../../../mol-util/param-definition';\nimport { filterDefined } from '../helpers/utils';\nimport { ElementSet, SelectorParams } from './selector';\nexport const CustomTooltipsParams = {\n    tooltips: PD.ObjectList({\n        text: PD.Text('', { description: 'Text of the tooltip' }),\n        selector: SelectorParams,\n    }, obj => obj.text),\n};\n/** Provider for custom structure property \"CustomTooltips\" */\nexport const CustomTooltipsProvider = CustomStructureProperty.createProvider({\n    label: 'MVS Custom Tooltips',\n    descriptor: CustomPropertyDescriptor({\n        name: 'mvs-custom-tooltips',\n    }),\n    type: 'local',\n    defaultParams: CustomTooltipsParams,\n    getParams: (data) => CustomTooltipsParams,\n    isApplicable: (data) => data.root === data,\n    obtain: async (ctx, data, props) => {\n        const fullProps = { ...PD.getDefaultValues(CustomTooltipsParams), ...props };\n        const value = fullProps.tooltips.map(t => ({\n            selector: t.selector,\n            text: t.text,\n        }));\n        return { value: value };\n    },\n});\n/** Label provider based on custom structure property \"CustomTooltips\" */\nexport const CustomTooltipsLabelProvider = {\n    label: (loci) => {\n        var _a;\n        switch (loci.kind) {\n            case 'element-loci':\n                if (!loci.structure.customPropertyDescriptors.hasReference(CustomTooltipsProvider.descriptor))\n                    return undefined;\n                const location = StructureElement.Loci.getFirstLocation(loci);\n                if (!location)\n                    return undefined;\n                const tooltipData = CustomTooltipsProvider.get(location.structure).value;\n                if (!tooltipData || tooltipData.length === 0)\n                    return undefined;\n                const texts = [];\n                for (const tooltip of tooltipData) {\n                    const elements = (_a = tooltip.elementSet) !== null && _a !== void 0 ? _a : (tooltip.elementSet = ElementSet.fromSelector(location.structure, tooltip.selector));\n                    if (ElementSet.has(elements, location))\n                        texts.push(tooltip.text);\n                }\n                return filterDefined(texts).join(' | ');\n            default:\n                return undefined;\n        }\n    }\n};\n", "/**\n * Copyright (c) 2023-2025 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Adam Midlik <midlik@gmail.com>\n * @author David Sehnal <david.sehnal@gmail.com>\n */\nimport { hashFnv32a } from '../../../mol-data/util';\nimport { StringLike } from '../../../mol-io/common/string-like';\nimport { DataFormatProvider } from '../../../mol-plugin-state/formats/provider';\nimport { PluginStateObject as SO } from '../../../mol-plugin-state/objects';\nimport { Download } from '../../../mol-plugin-state/transforms/data';\nimport { StateAction, StateObjectRef } from '../../../mol-state';\nimport { Task } from '../../../mol-task';\nimport { Asset } from '../../../mol-util/assets';\nimport { ParamDefinition as PD } from '../../../mol-util/param-definition';\nimport { unzip } from '../../../mol-util/zip/zip';\nimport { loadMVS } from '../load';\nimport { MVSData } from '../mvs-data';\nimport { MVSTransform } from './annotation-structure-component';\n/** Plugin state object storing `MVSData` */\nexport class Mvs extends SO.Create({ name: 'MVS Data', typeClass: 'Data' }) {\n}\n/** Transformer for parsing data in MVSJ format */\nexport const ParseMVSJ = MVSTransform({\n    name: 'mvs-parse-mvsj',\n    display: { name: 'MolViewSpec from MVSJ', description: 'Create MolViewSpec view from MVSJ data' },\n    from: SO.Data.String,\n    to: Mvs,\n})({\n    apply({ a }, plugin) {\n        const mvsData = MVSData.fromMVSJ(StringLike.toString(a.data));\n        const sourceUrl = tryGetDownloadUrl(a, plugin);\n        return new Mvs({ mvsData, sourceUrl });\n    },\n});\n/** Transformer for parsing data in MVSX format (= zipped MVSJ + referenced files like structures and annotations) */\nexport const ParseMVSX = MVSTransform({\n    name: 'mvs-parse-mvsx',\n    display: { name: 'MolViewSpec from MVSX', description: 'Create MolViewSpec view from MVSX data' },\n    from: SO.Data.Binary,\n    to: Mvs,\n    params: {\n        mainFilePath: PD.Text('index.mvsj'),\n    },\n})({\n    apply({ a, params }, plugin) {\n        return Task.create('Parse MVSX file', async (ctx) => {\n            const data = await loadMVSX(plugin, ctx, a.data, params.mainFilePath);\n            return new Mvs(data);\n        });\n    },\n});\n/** Params for the `LoadMvsData` action */\nexport const LoadMvsDataParams = {\n    appendSnapshots: PD.Boolean(false, { description: 'If true, add snapshots from MVS into current snapshot list; if false, replace the snapshot list.' }),\n    keepCamera: PD.Boolean(false, { description: 'If true, any camera positioning from the MVS state will be ignored and the current camera position will be kept.' }),\n    applyExtensions: PD.Boolean(true, { description: 'If true, apply builtin MVS-loading extensions (not a part of standard MVS specification).' }),\n};\n/** State action which loads a MVS view into Mol* */\nexport const LoadMvsData = StateAction.build({\n    display: { name: 'Load MVS Data' },\n    from: Mvs,\n    params: LoadMvsDataParams,\n})(({ a, params }, plugin) => Task.create('Load MVS Data', async () => {\n    const { mvsData, sourceUrl } = a.data;\n    await loadMVS(plugin, mvsData, { appendSnapshots: params.appendSnapshots, keepCamera: params.keepCamera, sourceUrl: sourceUrl, extensions: params.applyExtensions ? undefined : [] });\n}));\n/** Data format provider for MVSJ format.\n * If Visuals:On, it will load the parsed MVS view;\n * otherwise it will just create a plugin state object with parsed data. */\nexport const MVSJFormatProvider = DataFormatProvider({\n    label: 'MVSJ',\n    description: 'MVSJ',\n    category: 'Miscellaneous',\n    stringExtensions: ['mvsj'],\n    parse: async (plugin, data) => {\n        return plugin.state.data.build().to(data).apply(ParseMVSJ).commit();\n    },\n    visuals: async (plugin, data) => {\n        const ref = StateObjectRef.resolveRef(data);\n        const params = PD.getDefaultValues(LoadMvsDataParams);\n        return await plugin.state.data.applyAction(LoadMvsData, params, ref).run();\n    },\n});\n/** Data format provider for MVSX format.\n * If Visuals:On, it will load the parsed MVS view;\n * otherwise it will just create a plugin state object with parsed data. */\nexport const MVSXFormatProvider = DataFormatProvider({\n    label: 'MVSX',\n    description: 'MVSX',\n    category: 'Miscellaneous',\n    binaryExtensions: ['mvsx'],\n    parse: async (plugin, data) => {\n        return plugin.state.data.build().to(data).apply(ParseMVSX).commit();\n    },\n    visuals: MVSJFormatProvider.visuals,\n});\n/** Parse binary data `data` as MVSX archive,\n * add all contained files to `plugin`'s asset manager,\n * and parse the main file in the archive as MVSJ.\n * Return parsed MVS data and `sourceUrl` for resolution of relative URIs.  */\nexport async function loadMVSX(plugin, runtimeCtx, data, mainFilePath = 'index.mvsj') {\n    // Ensure at most one generation of MVSX file assets exists in the asset manager.\n    // Hopefully, this is a reasonable compromise to ensure MVSX files work in multi-snapshot\n    // states.\n    clearMVSXFileAssets(plugin);\n    const archiveId = `ni,fnv1a;${hashFnv32a(data)}`;\n    let files;\n    try {\n        files = await unzip(runtimeCtx, data);\n    }\n    catch (err) {\n        plugin.log.error('Invalid MVSX file');\n        throw err;\n    }\n    for (const path in files) {\n        const url = arcpUri(archiveId, path);\n        // Need to use static assets so they persist accross snapsho\n        ensureUrlAsset(plugin.managers.asset, url, files[path], { isFile: true });\n    }\n    const mainFile = files[mainFilePath];\n    if (!mainFile)\n        throw new Error(`File ${mainFilePath} not found in the MVSX archive`);\n    const mvsData = MVSData.fromMVSJ(decodeUtf8(mainFile));\n    const sourceUrl = arcpUri(archiveId, mainFilePath);\n    return { mvsData, sourceUrl };\n}\nexport async function loadMVSData(plugin, data, format, options) {\n    if (typeof data === 'string' && data.startsWith('base64')) {\n        data = Uint8Array.from(atob(data.substring(7)), c => c.charCodeAt(0)); // Decode base64 string to Uint8Array\n    }\n    if (format === 'mvsj') {\n        if (data.BYTES_PER_ELEMENT && data.buffer) {\n            data = new TextDecoder().decode(data); // Decode Uint8Array to string using UTF8\n        }\n        let mvsData;\n        if (typeof data === 'string') {\n            mvsData = MVSData.fromMVSJ(data);\n        }\n        else {\n            mvsData = data;\n        }\n        await loadMVS(plugin, mvsData, { sanityChecks: true, sourceUrl: undefined, ...options });\n    }\n    else if (format === 'mvsx') {\n        if (typeof data === 'string') {\n            throw new Error(\"loadMvsData: if `format` is 'mvsx', then `data` must be a Uint8Array or a base64-encoded string prefixed with 'base64,'.\");\n        }\n        await plugin.runTask(Task.create('Load MVSX file', async (ctx) => {\n            const parsed = await loadMVSX(plugin, ctx, data);\n            await loadMVS(plugin, parsed.mvsData, { sanityChecks: true, ...options, sourceUrl: parsed.sourceUrl });\n        }));\n    }\n    else {\n        throw new Error(`Unknown MolViewSpec format: ${format}`);\n    }\n}\nfunction clearMVSXFileAssets(plugin) {\n    plugin.managers.asset.clearTag('mvsx-file');\n}\n/** If the PluginStateObject `pso` comes from a Download transform, try to get its `url` parameter. */\nfunction tryGetDownloadUrl(pso, plugin) {\n    var _a;\n    const theCell = plugin.state.data.selectQ(q => q.ofTransformer(Download)).find(cell => cell.obj === pso);\n    const urlParam = (_a = theCell === null || theCell === void 0 ? void 0 : theCell.transform.params) === null || _a === void 0 ? void 0 : _a.url;\n    return urlParam ? Asset.getUrl(urlParam) : undefined;\n}\n/** Return a URI referencing a file within an archive, using ARCP scheme (https://arxiv.org/pdf/1809.06935.pdf).\n * `archiveId` corresponds to the `authority` part of URI (e.g. 'uuid,EYVwjDiZhM20PWbF1OWWvQ' or 'ni,fnv1a;938511930')\n * `path` corresponds to the path to a file within the archive */\nfunction arcpUri(archiveId, path) {\n    return new URL(path, `arcp://${archiveId}/`).href;\n}\n/** Add a URL asset to asset manager.\n * Skip if an asset with the same URL already exists. */\nfunction ensureUrlAsset(manager, url, data, options) {\n    var _a;\n    const asset = Asset.getUrlAsset(manager, url);\n    if (!manager.has(asset)) {\n        const filename = (_a = url.split('/').pop()) !== null && _a !== void 0 ? _a : 'file';\n        // We need to mark files as static resources to prevent deleting them\n        // when changing state snapshots.\n        manager.set(asset, new File([data], filename), (options === null || options === void 0 ? void 0 : options.isFile) ? { isStatic: true, tag: 'mvsx-file' } : undefined);\n    }\n}\n/** Decode bytes to text using UTF-8 encoding */\nfunction decodeUtf8(bytes) {\n    _decoder !== null && _decoder !== void 0 ? _decoder : (_decoder = new TextDecoder());\n    return _decoder.decode(bytes);\n}\nlet _decoder;\n", "/**\n * Copyright (c) 2023-2024 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Adam Midlik <midlik@gmail.com>\n */\nimport { Bond, Structure, StructureElement } from '../../../mol-model/structure';\nimport { ColorThemeCategory } from '../../../mol-theme/color/categories';\nimport { Color } from '../../../mol-util/color';\nimport { ColorNames } from '../../../mol-util/color/names';\nimport { ParamDefinition as PD } from '../../../mol-util/param-definition';\nimport { stringToWords } from '../../../mol-util/string';\nimport { isMVSStructure } from './is-mvs-model-prop';\nimport { ElementSet, SelectorParams, isSelectorAll } from './selector';\n/** Special value that can be used as color with null-like semantic (i.e. \"no color provided\").\n * By some lucky coincidence, Mol* treats -1 as white. */\nexport const NoColor = Color(-1);\n/** Return true if `color` is a real color, false if it is `NoColor`. */\nfunction isValidColor(color) {\n    return color >= 0;\n}\nconst DefaultBackgroundColor = ColorNames.white;\n/** Parameter definition for color theme \"Multilayer\" */\nexport function makeMultilayerColorThemeParams(colorThemeRegistry, ctx) {\n    const colorThemeInfo = {\n        help: (value) => {\n            const { name, params } = value;\n            const p = colorThemeRegistry.get(name);\n            const ct = p.factory({}, params);\n            return { description: ct.description, legend: ct.legend };\n        }\n    };\n    const nestedThemeTypes = colorThemeRegistry.types.filter(([name, label, category]) => name !== MultilayerColorThemeName && colorThemeRegistry.get(name).isApplicable(ctx)); // Adding 'multilayer' theme itself would cause infinite recursion\n    return {\n        layers: PD.ObjectList({\n            theme: PD.Mapped('uniform', nestedThemeTypes, name => PD.Group(colorThemeRegistry.get(name).getParams({ structure: Structure.Empty })), colorThemeInfo),\n            selection: SelectorParams,\n        }, obj => stringToWords(obj.theme.name), { description: 'A list of layers, each defining a color theme. The last listed layer is the top layer (applies first). If the top layer does not provide color for a location or its selection does not cover the location, the underneath layers will apply.' }),\n        background: PD.Color(DefaultBackgroundColor, { description: 'Color for elements where no layer applies' }),\n    };\n}\n/** Default values for `MultilayerColorThemeProps` */\nexport const DefaultMultilayerColorThemeProps = { layers: [], background: DefaultBackgroundColor };\n/** Return color theme that assigns colors based on a list of nested color themes (layers).\n * The last layer in the list whose selection covers the given location\n * and which provides a valid (non-negative) color value will be used.\n * If a nested theme provider has `ensureCustomProperties` methods, these will not be called automatically\n * (the caller must ensure that any required custom properties be attached). */\nfunction makeMultilayerColorTheme(ctx, props, colorThemeRegistry) {\n    var _a;\n    const colorLayers = []; // undefined elementSet means 'all'\n    for (let i = props.layers.length - 1; i >= 0; i--) { // iterate from end to get top layer first, bottom layer last\n        const layer = props.layers[i];\n        const themeProvider = colorThemeRegistry.get(layer.theme.name);\n        if (!themeProvider) {\n            console.warn(`Skipping color theme '${layer.theme.name}', cannot find it in registry.`);\n            continue;\n        }\n        if ((_a = themeProvider.ensureCustomProperties) === null || _a === void 0 ? void 0 : _a.attach) {\n            console.warn(`Multilayer color theme: layer \"${themeProvider.name}\" has ensureCustomProperties.attach method, but Multilayer color theme does not call it. If the layer does not work, make sure you call ensureCustomProperties.attach somewhere.`);\n        }\n        const theme = themeProvider.factory(ctx, layer.theme.params);\n        switch (theme.granularity) {\n            case 'uniform':\n            case 'instance':\n            case 'group':\n            case 'groupInstance':\n            case 'vertex':\n            case 'vertexInstance':\n                const elementSet = isSelectorAll(layer.selection) ? undefined : ElementSet.fromSelector(ctx.structure, layer.selection); // treating 'all' specially for performance reasons (it's expected to be used most often)\n                colorLayers.push({ color: theme.color, elementSet });\n                break;\n            default:\n                console.warn(`Skipping color theme '${layer.theme.name}', cannot process granularity '${theme.granularity}'`);\n        }\n    }\n    ;\n    function structureElementColor(loc, isSecondary) {\n        for (const layer of colorLayers) {\n            const matches = !layer.elementSet || ElementSet.has(layer.elementSet, loc);\n            if (!matches)\n                continue;\n            const color = layer.color(loc, isSecondary);\n            if (!isValidColor(color))\n                continue;\n            return color;\n        }\n        return props.background;\n    }\n    const auxLocation = StructureElement.Location.create(ctx.structure);\n    const color = (location, isSecondary) => {\n        if (StructureElement.Location.is(location)) {\n            return structureElementColor(location, isSecondary);\n        }\n        else if (Bond.isLocation(location)) {\n            // this will be applied for each bond twice, to get color of each half (a* refers to the adjacent atom, b* to the opposite atom)\n            auxLocation.unit = location.aUnit;\n            auxLocation.element = location.aUnit.elements[location.aIndex];\n            return structureElementColor(auxLocation, isSecondary);\n        }\n        return props.background;\n    };\n    return {\n        factory: (ctx_, props_) => makeMultilayerColorTheme(ctx_, props_, colorThemeRegistry),\n        granularity: 'group',\n        preferSmoothing: true,\n        color: color,\n        props: props,\n        description: 'Combines colors from multiple color themes.',\n    };\n}\n/** Unique name for \"Multilayer\" color theme */\nexport const MultilayerColorThemeName = 'mvs-multilayer';\n/** A thingy that is needed to register color theme \"Multilayer\" */\nexport function makeMultilayerColorThemeProvider(colorThemeRegistry) {\n    return {\n        name: MultilayerColorThemeName,\n        label: 'MVS Multi-layer',\n        category: ColorThemeCategory.Misc,\n        factory: (ctx, props) => makeMultilayerColorTheme(ctx, props, colorThemeRegistry),\n        getParams: (ctx) => makeMultilayerColorThemeParams(colorThemeRegistry, ctx),\n        defaultValues: DefaultMultilayerColorThemeProps,\n        isApplicable: (ctx) => !!ctx.structure && isMVSStructure(ctx.structure),\n    };\n}\n", "/**\n * Copyright (c) 2023-2024 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Adam Midlik <midlik@gmail.com>\n */\nimport { PluginBehavior } from '../../mol-plugin/behavior/behavior';\nimport { Task } from '../../mol-task';\nimport { ParamDefinition as PD } from '../../mol-util/param-definition';\nimport { MVSAnnotationColorThemeProvider } from './components/annotation-color-theme';\nimport { MVSAnnotationLabelRepresentationProvider } from './components/annotation-label/representation';\nimport { MVSAnnotationsProvider } from './components/annotation-prop';\nimport { MVSAnnotationTooltipsLabelProvider, MVSAnnotationTooltipsProvider } from './components/annotation-tooltips-prop';\nimport { CustomLabelRepresentationProvider } from './components/custom-label/representation';\nimport { CustomTooltipsLabelProvider, CustomTooltipsProvider } from './components/custom-tooltips-prop';\nimport { LoadMvsData, MVSJFormatProvider, MVSXFormatProvider, loadMVSX } from './components/formats';\nimport { IsMVSModelProvider } from './components/is-mvs-model-prop';\nimport { makeMultilayerColorThemeProvider } from './components/multilayer-color-theme';\nimport { loadMVS } from './load';\nimport { MVSData } from './mvs-data';\n/** Registers everything needed for loading MolViewSpec files */\nexport const MolViewSpec = PluginBehavior.create({\n    name: 'molviewspec',\n    category: 'misc',\n    display: {\n        name: 'MolViewSpec',\n        description: 'MolViewSpec extension',\n    },\n    ctor: class extends PluginBehavior.Handler {\n        constructor() {\n            super(...arguments);\n            this.registrables = {\n                customModelProperties: [\n                    IsMVSModelProvider,\n                    MVSAnnotationsProvider,\n                ],\n                customStructureProperties: [\n                    CustomTooltipsProvider,\n                    MVSAnnotationTooltipsProvider,\n                ],\n                representations: [\n                    CustomLabelRepresentationProvider,\n                    MVSAnnotationLabelRepresentationProvider,\n                ],\n                colorThemes: [\n                    MVSAnnotationColorThemeProvider,\n                    makeMultilayerColorThemeProvider(this.ctx.representation.structure.themes.colorThemeRegistry),\n                ],\n                lociLabels: [\n                    CustomTooltipsLabelProvider,\n                    MVSAnnotationTooltipsLabelProvider,\n                ],\n                dragAndDropHandlers: [\n                    MVSDragAndDropHandler,\n                ],\n                dataFormats: [\n                    { name: 'MVSJ', provider: MVSJFormatProvider },\n                    { name: 'MVSX', provider: MVSXFormatProvider },\n                ],\n                actions: [\n                    LoadMvsData,\n                ]\n            };\n        }\n        register() {\n            var _a, _b, _c, _d, _e, _f, _g, _h;\n            for (const prop of (_a = this.registrables.customModelProperties) !== null && _a !== void 0 ? _a : []) {\n                this.ctx.customModelProperties.register(prop, this.params.autoAttach);\n            }\n            for (const prop of (_b = this.registrables.customStructureProperties) !== null && _b !== void 0 ? _b : []) {\n                this.ctx.customStructureProperties.register(prop, this.params.autoAttach);\n            }\n            for (const repr of (_c = this.registrables.representations) !== null && _c !== void 0 ? _c : []) {\n                this.ctx.representation.structure.registry.add(repr);\n            }\n            for (const theme of (_d = this.registrables.colorThemes) !== null && _d !== void 0 ? _d : []) {\n                this.ctx.representation.structure.themes.colorThemeRegistry.add(theme);\n            }\n            for (const provider of (_e = this.registrables.lociLabels) !== null && _e !== void 0 ? _e : []) {\n                this.ctx.managers.lociLabels.addProvider(provider);\n            }\n            for (const handler of (_f = this.registrables.dragAndDropHandlers) !== null && _f !== void 0 ? _f : []) {\n                this.ctx.managers.dragAndDrop.addHandler(handler.name, handler.handle);\n            }\n            for (const format of (_g = this.registrables.dataFormats) !== null && _g !== void 0 ? _g : []) {\n                this.ctx.dataFormats.add(format.name, format.provider);\n            }\n            for (const action of (_h = this.registrables.actions) !== null && _h !== void 0 ? _h : []) {\n                this.ctx.state.data.actions.add(action);\n            }\n        }\n        update(p) {\n            var _a, _b;\n            const updated = this.params.autoAttach !== p.autoAttach;\n            this.params.autoAttach = p.autoAttach;\n            for (const prop of (_a = this.registrables.customModelProperties) !== null && _a !== void 0 ? _a : []) {\n                this.ctx.customModelProperties.setDefaultAutoAttach(prop.descriptor.name, this.params.autoAttach);\n            }\n            for (const prop of (_b = this.registrables.customStructureProperties) !== null && _b !== void 0 ? _b : []) {\n                this.ctx.customStructureProperties.setDefaultAutoAttach(prop.descriptor.name, this.params.autoAttach);\n            }\n            return updated;\n        }\n        unregister() {\n            var _a, _b, _c, _d, _e, _f, _g, _h;\n            for (const prop of (_a = this.registrables.customModelProperties) !== null && _a !== void 0 ? _a : []) {\n                this.ctx.customModelProperties.unregister(prop.descriptor.name);\n            }\n            for (const prop of (_b = this.registrables.customStructureProperties) !== null && _b !== void 0 ? _b : []) {\n                this.ctx.customStructureProperties.unregister(prop.descriptor.name);\n            }\n            for (const repr of (_c = this.registrables.representations) !== null && _c !== void 0 ? _c : []) {\n                this.ctx.representation.structure.registry.remove(repr);\n            }\n            for (const theme of (_d = this.registrables.colorThemes) !== null && _d !== void 0 ? _d : []) {\n                this.ctx.representation.structure.themes.colorThemeRegistry.remove(theme);\n            }\n            for (const labelProvider of (_e = this.registrables.lociLabels) !== null && _e !== void 0 ? _e : []) {\n                this.ctx.managers.lociLabels.removeProvider(labelProvider);\n            }\n            for (const handler of (_f = this.registrables.dragAndDropHandlers) !== null && _f !== void 0 ? _f : []) {\n                this.ctx.managers.dragAndDrop.removeHandler(handler.name);\n            }\n            for (const format of (_g = this.registrables.dataFormats) !== null && _g !== void 0 ? _g : []) {\n                this.ctx.dataFormats.remove(format.name);\n            }\n            for (const action of (_h = this.registrables.actions) !== null && _h !== void 0 ? _h : []) {\n                this.ctx.state.data.actions.remove(action);\n            }\n        }\n    },\n    params: () => ({\n        autoAttach: PD.Boolean(false),\n    })\n});\n/** DragAndDropHandler handler for `.mvsj` and `.mvsx` files */\nconst MVSDragAndDropHandler = {\n    name: 'mvs-mvsj-mvsx',\n    /** Load .mvsj and .mvsx files. Delete previous plugin state before loading.\n     * If multiple files are provided, merge their MVS data into one state.\n     * Return `true` if at least one file has been loaded. */\n    async handle(files, plugin) {\n        let applied = false;\n        for (const file of files) {\n            if (file.name.toLowerCase().endsWith('.mvsj')) {\n                const task = Task.create('Load MVSJ file', async (ctx) => {\n                    const data = await file.text();\n                    const mvsData = MVSData.fromMVSJ(data);\n                    await loadMVS(plugin, mvsData, { sanityChecks: true, appendSnapshots: applied, sourceUrl: undefined });\n                });\n                await plugin.runTask(task);\n                applied = true;\n            }\n            if (file.name.toLowerCase().endsWith('.mvsx')) {\n                const task = Task.create('Load MVSX file', async (ctx) => {\n                    const buffer = await file.arrayBuffer();\n                    const array = new Uint8Array(buffer);\n                    const parsed = await loadMVSX(plugin, ctx, array);\n                    await loadMVS(plugin, parsed.mvsData, { sanityChecks: true, appendSnapshots: applied, sourceUrl: parsed.sourceUrl });\n                });\n                await plugin.runTask(task);\n                applied = true;\n            }\n        }\n        return applied;\n    },\n};\n", "/**\n * Copyright (c) 2023-2024 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Adam Midlik <midlik@gmail.com>\n * @author David Sehnal <david.sehnal@gmail.com>\n */\nimport { Canvas3DParams } from '../../mol-canvas3d/canvas3d';\nimport { Vec3 } from '../../mol-math/linear-algebra';\nimport { getFocusSnapshot, getPluginBoundingSphere } from '../../mol-plugin-state/manager/focus-camera/focus-object';\nimport { PluginCommands } from '../../mol-plugin/commands';\nimport { fovAdjustedPosition } from '../../mol-util/camera';\nimport { ColorNames } from '../../mol-util/color/names';\nimport { decodeColor } from './helpers/utils';\nimport { MVSTreeSchema } from './tree/mvs/mvs-tree';\nconst DefaultFocusOptions = {\n    minRadius: 5,\n    extraRadius: 0,\n};\nconst DefaultCanvasBackgroundColor = ColorNames.white;\nconst _tmpVec = Vec3();\n/** Set the camera position to the current position (thus suppress automatic adjustment). */\nexport async function suppressCameraAutoreset(plugin) {\n    var _a;\n    const snapshot = { ...(_a = plugin.canvas3d) === null || _a === void 0 ? void 0 : _a.camera.state, radius: Infinity }; // `radius: Infinity` avoids clipping when the scene expands\n    adjustSceneRadiusFactor(plugin, snapshot.target);\n    await PluginCommands.Camera.SetSnapshot(plugin, { snapshot });\n}\n/** Set the camera based on a camera node params. */\nexport async function setCamera(plugin, params) {\n    const snapshot = cameraParamsToCameraSnapshot(plugin, params);\n    adjustSceneRadiusFactor(plugin, snapshot.target);\n    await PluginCommands.Camera.SetSnapshot(plugin, { snapshot });\n}\nexport function cameraParamsToCameraSnapshot(plugin, params) {\n    const target = Vec3.create(...params.target);\n    let position = Vec3.create(...params.position);\n    const radius = Vec3.distance(target, position) / 2;\n    if (plugin.canvas3d)\n        position = fovAdjustedPosition(target, position, plugin.canvas3d.camera.state.mode, plugin.canvas3d.camera.state.fov);\n    const up = Vec3.create(...params.up);\n    Vec3.orthogonalize(up, Vec3.sub(_tmpVec, target, position), up);\n    const snapshot = { target, position, up, radius, radiusMax: radius };\n    return snapshot;\n}\n/** Focus the camera on the bounding sphere of a (sub)structure (or on the whole scene if `structureNodeSelector` is undefined).\n  * Orient the camera based on a focus node params. **/\nexport async function setFocus(plugin, focuses) {\n    const snapshot = getFocusSnapshot(plugin, {\n        ...snapshotFocusInfoFromMvsFocuses(focuses),\n        minRadius: DefaultFocusOptions.minRadius,\n    });\n    if (!snapshot)\n        return;\n    resetSceneRadiusFactor(plugin);\n    await PluginCommands.Camera.SetSnapshot(plugin, { snapshot });\n}\nfunction snapshotFocusInfoFromMvsFocuses(focuses) {\n    var _a, _b;\n    const lastFocus = (focuses.length > 0) ? focuses[focuses.length - 1] : undefined;\n    const direction = (_a = lastFocus === null || lastFocus === void 0 ? void 0 : lastFocus.params.direction) !== null && _a !== void 0 ? _a : MVSTreeSchema.nodes.focus.params.fields.direction.default;\n    const up = (_b = lastFocus === null || lastFocus === void 0 ? void 0 : lastFocus.params.up) !== null && _b !== void 0 ? _b : MVSTreeSchema.nodes.focus.params.fields.up.default;\n    return {\n        targets: focuses.map(f => {\n            var _a;\n            return ({\n                targetRef: f.target.ref === '-=root=-' ? undefined : f.target.ref, // need to treat root separately so it does not include invisible structure parts etc.\n                radius: (_a = f.params.radius) !== null && _a !== void 0 ? _a : undefined,\n                radiusFactor: f.params.radius_factor,\n                extraRadius: f.params.radius_extent,\n            });\n        }),\n        direction: Vec3.create(...direction),\n        up: Vec3.create(...up),\n    };\n}\n/** Adjust `sceneRadiusFactor` property so that the current scene is not cropped */\nfunction adjustSceneRadiusFactor(plugin, cameraTarget) {\n    var _a;\n    if (!cameraTarget)\n        return;\n    const boundingSphere = getPluginBoundingSphere(plugin);\n    const offset = Vec3.distance(cameraTarget, boundingSphere.center);\n    const sceneRadiusFactor = boundingSphere.radius > 0 ? ((boundingSphere.radius + offset) / boundingSphere.radius) : 1;\n    (_a = plugin.canvas3d) === null || _a === void 0 ? void 0 : _a.setProps({ sceneRadiusFactor });\n}\n/** Reset `sceneRadiusFactor` property to the default value */\nfunction resetSceneRadiusFactor(plugin) {\n    var _a;\n    const sceneRadiusFactor = Canvas3DParams.sceneRadiusFactor.defaultValue;\n    (_a = plugin.canvas3d) === null || _a === void 0 ? void 0 : _a.setProps({ sceneRadiusFactor });\n}\n/** Create object for PluginState.Snapshot.camera based on tree loading context and MVS snapshot metadata */\nexport function createPluginStateSnapshotCamera(plugin, context, metadata) {\n    var _a;\n    const camera = {\n        transitionStyle: 'animate',\n        transitionDurationInMs: (_a = metadata.previousTransitionDurationMs) !== null && _a !== void 0 ? _a : 0,\n    };\n    if (context.camera.cameraParams !== undefined) {\n        const currentCameraSnapshot = plugin.canvas3d.camera.getSnapshot();\n        const cameraSnapshot = cameraParamsToCameraSnapshot(plugin, context.camera.cameraParams);\n        camera.current = { ...currentCameraSnapshot, ...cameraSnapshot };\n    }\n    else {\n        camera.focus = snapshotFocusInfoFromMvsFocuses(context.camera.focuses);\n    }\n    return camera;\n}\n/** Set canvas properties based on a canvas node params. */\nexport function setCanvas(plugin, params) {\n    var _a;\n    (_a = plugin.canvas3d) === null || _a === void 0 ? void 0 : _a.setProps(old => modifyCanvasProps(old, params));\n}\n/** Create a deep copy of `oldCanvasProps` with values modified according to a canvas node params. */\nexport function modifyCanvasProps(oldCanvasProps, params) {\n    var _a;\n    const backgroundColor = (_a = decodeColor(params === null || params === void 0 ? void 0 : params.background_color)) !== null && _a !== void 0 ? _a : DefaultCanvasBackgroundColor;\n    return {\n        ...oldCanvasProps,\n        renderer: {\n            ...oldCanvasProps.renderer,\n            backgroundColor: backgroundColor,\n        },\n    };\n}\n", "/**\n * Copyright (c) 2024-2025 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author David Sehnal <david.sehnal@gmail.com>\n * @author Adam Midlik <midlik@gmail.com>\n */\nimport { Lines } from '../../../mol-geo/geometry/lines/lines';\nimport { LinesBuilder } from '../../../mol-geo/geometry/lines/lines-builder';\nimport { addFixedCountDashedCylinder, addSimpleCylinder } from '../../../mol-geo/geometry/mesh/builder/cylinder';\nimport { addEllipsoid } from '../../../mol-geo/geometry/mesh/builder/ellipsoid';\nimport { Mesh } from '../../../mol-geo/geometry/mesh/mesh';\nimport { MeshBuilder } from '../../../mol-geo/geometry/mesh/mesh-builder';\nimport { Text } from '../../../mol-geo/geometry/text/text';\nimport { TextBuilder } from '../../../mol-geo/geometry/text/text-builder';\nimport { Box, BoxCage } from '../../../mol-geo/primitive/box';\nimport { Circle } from '../../../mol-geo/primitive/circle';\nimport { StringLike } from '../../../mol-io/common/string-like';\nimport { Box3D, Sphere3D } from '../../../mol-math/geometry';\nimport { Mat4, Vec3 } from '../../../mol-math/linear-algebra';\nimport { radToDeg } from '../../../mol-math/misc';\nimport { Shape } from '../../../mol-model/shape';\nimport { StructureElement, StructureSelection } from '../../../mol-model/structure';\nimport { StructureQueryHelper } from '../../../mol-plugin-state/helpers/structure-query';\nimport { PluginStateObject as SO } from '../../../mol-plugin-state/objects';\nimport { StateObject } from '../../../mol-state';\nimport { Task } from '../../../mol-task';\nimport { round } from '../../../mol-util';\nimport { range } from '../../../mol-util/array';\nimport { Asset } from '../../../mol-util/assets';\nimport { Color } from '../../../mol-util/color';\nimport { ParamDefinition as PD } from '../../../mol-util/param-definition';\nimport { capitalize } from '../../../mol-util/string';\nimport { rowsToExpression, rowToExpression } from '../helpers/selections';\nimport { collectMVSReferences, decodeColor } from '../helpers/utils';\nimport { isComponentExpression, isPrimitiveComponentExpressions, isVector3 } from '../tree/mvs/param-types';\nimport { MVSTransform } from './annotation-structure-component';\nexport function getPrimitiveStructureRefs(primitives) {\n    var _a, _b, _c;\n    const refs = new Set();\n    for (const c of (_a = primitives.children) !== null && _a !== void 0 ? _a : []) {\n        if (c.kind !== 'primitive')\n            continue;\n        const p = c.params;\n        (_c = (_b = Builders[p.kind]).resolveRefs) === null || _c === void 0 ? void 0 : _c.call(_b, p, refs);\n    }\n    return refs;\n}\nexport class MVSPrimitivesData extends SO.Create({ name: 'Primitive Data', typeClass: 'Object' }) {\n}\nexport class MVSPrimitiveShapes extends SO.Create({ name: 'Primitive Shapes', typeClass: 'Object' }) {\n}\nexport const MVSDownloadPrimitiveData = MVSTransform({\n    name: 'mvs-download-primitive-data',\n    display: { name: 'MVS Primitives' },\n    from: [SO.Root, SO.Molecule.Structure],\n    to: MVSPrimitivesData,\n    params: {\n        uri: PD.Url('', { isHidden: true }),\n        format: PD.Text('mvs-node-json', { isHidden: true })\n    },\n})({\n    apply({ a, params, cache }, plugin) {\n        return Task.create('Download Primitive Data', async (ctx) => {\n            const url = Asset.getUrlAsset(plugin.managers.asset, params.uri);\n            const asset = await plugin.managers.asset.resolve(url, 'string').runInContext(ctx);\n            const node = JSON.parse(StringLike.toString(asset.data));\n            cache.asset = asset;\n            return new MVSPrimitivesData({\n                node,\n                defaultStructure: SO.Molecule.Structure.is(a) ? a.data : undefined,\n                structureRefs: {},\n                primitives: getPrimitives(node),\n                options: { ...node.params },\n                positionCache: new Map(),\n                instances: getInstances(node.params),\n            }, { label: 'Primitive Data' });\n        });\n    },\n    dispose({ cache }) {\n        var _a;\n        (_a = cache === null || cache === void 0 ? void 0 : cache.asset) === null || _a === void 0 ? void 0 : _a.dispose();\n    },\n});\nexport const MVSInlinePrimitiveData = MVSTransform({\n    name: 'mvs-inline-primitive-data',\n    display: { name: 'MVS Primitives' },\n    from: [SO.Root, SO.Molecule.Structure],\n    to: MVSPrimitivesData,\n    params: {\n        node: PD.Value(undefined, { isHidden: true }),\n    },\n})({\n    apply({ a, params }) {\n        return new MVSPrimitivesData({\n            node: params.node,\n            defaultStructure: SO.Molecule.Structure.is(a) ? a.data : undefined,\n            structureRefs: {},\n            primitives: getPrimitives(params.node),\n            options: { ...params.node.params },\n            positionCache: new Map(),\n            instances: getInstances(params.node.params),\n        }, { label: 'Primitive Data' });\n    }\n});\nexport const MVSBuildPrimitiveShape = MVSTransform({\n    name: 'mvs-build-primitive-shape',\n    display: { name: 'MVS Primitives' },\n    from: MVSPrimitivesData,\n    to: SO.Shape.Provider,\n    params: {\n        kind: PD.Text('mesh')\n    }\n})({\n    apply({ a, params, dependencies }) {\n        var _a, _b, _c, _d, _e, _f;\n        const structureRefs = dependencies ? collectMVSReferences([SO.Molecule.Structure], dependencies) : {};\n        const context = { ...a.data, structureRefs };\n        const label = capitalize(params.kind);\n        if (params.kind === 'mesh') {\n            if (!hasPrimitiveKind(a.data, 'mesh'))\n                return StateObject.Null;\n            return new SO.Shape.Provider({\n                label,\n                data: context,\n                params: PD.withDefaults(Mesh.Params, { alpha: (_b = (_a = a.data.options) === null || _a === void 0 ? void 0 : _a.opacity) !== null && _b !== void 0 ? _b : 1 }),\n                getShape: (_, data, __, prev) => buildPrimitiveMesh(data, prev === null || prev === void 0 ? void 0 : prev.geometry),\n                geometryUtils: Mesh.Utils,\n            }, { label });\n        }\n        else if (params.kind === 'labels') {\n            if (!hasPrimitiveKind(a.data, 'label'))\n                return StateObject.Null;\n            return new SO.Shape.Provider({\n                label,\n                data: context,\n                params: PD.withDefaults(DefaultLabelParams, { alpha: (_d = (_c = a.data.options) === null || _c === void 0 ? void 0 : _c.label_opacity) !== null && _d !== void 0 ? _d : 1 }),\n                getShape: (_, data, __, prev) => buildPrimitiveLabels(data, prev === null || prev === void 0 ? void 0 : prev.geometry),\n                geometryUtils: Text.Utils,\n            }, { label });\n        }\n        else if (params.kind === 'lines') {\n            if (!hasPrimitiveKind(a.data, 'line'))\n                return StateObject.Null;\n            return new SO.Shape.Provider({\n                label,\n                data: context,\n                params: PD.withDefaults(Lines.Params, { alpha: (_f = (_e = a.data.options) === null || _e === void 0 ? void 0 : _e.opacity) !== null && _f !== void 0 ? _f : 1 }),\n                getShape: (_, data, __, prev) => buildPrimitiveLines(data, prev === null || prev === void 0 ? void 0 : prev.geometry),\n                geometryUtils: Lines.Utils,\n            }, { label });\n        }\n        return StateObject.Null;\n    }\n});\n/* **************************************************** */\nclass GroupManager {\n    constructor() {\n        this.current = -1;\n        this.groupToNodeMap = new Map();\n        this.sizes = new Map();\n        this.colors = new Map();\n        this.tooltips = new Map();\n    }\n    allocateSingle(node) {\n        const group = ++this.current;\n        this.groupToNodeMap.set(group, node);\n        return group;\n    }\n    allocateMany(node, groups) {\n        const newGroups = new Map();\n        const base = this.current;\n        for (const g of groups) {\n            if (newGroups.has(g))\n                continue;\n            const group = base + newGroups.size + 1;\n            this.groupToNodeMap.set(group, node);\n            newGroups.set(g, group);\n        }\n        this.current += newGroups.size + 1;\n        return newGroups;\n    }\n    updateColor(group, color) {\n        const c = decodeColor(color);\n        if (typeof c === 'number')\n            this.colors.set(group, c);\n    }\n    updateTooltip(group, tooltip) {\n        if (typeof tooltip === 'string')\n            this.tooltips.set(group, tooltip);\n    }\n    updateSize(group, size) {\n        if (typeof size === 'number')\n            this.sizes.set(group, size);\n    }\n}\nfunction printEmptySelectionWarning(ctx, position) {\n    if (!ctx.emptySelectionWarningPrinted) {\n        console.warn('Some primitives use positions which refer to empty substructure, not showing these primitives.', position, '(There may be more)');\n        ctx.emptySelectionWarningPrinted = true;\n    }\n}\nconst BaseLabelProps = {\n    ...PD.getDefaultValues(Text.Params),\n    attachment: 'middle-center',\n    fontQuality: 3,\n    fontWeight: 'normal',\n    borderWidth: 0.15,\n    borderColor: Color(0x0),\n    background: false,\n    backgroundOpacity: 0.5,\n    tether: false,\n};\nconst DefaultLabelParams = PD.withDefaults(Text.Params, BaseLabelProps);\nconst Builders = {\n    mesh: {\n        builders: {\n            mesh: addMesh,\n            line: addMeshWireframe,\n        },\n        isApplicable: {\n            mesh: (m) => m.show_triangles,\n            line: (m) => m.show_wireframe,\n        },\n    },\n    lines: {\n        builders: {\n            line: addLines,\n        },\n    },\n    tube: {\n        builders: {\n            mesh: addTubeMesh,\n        },\n        resolveRefs: resolveLineRefs,\n    },\n    arrow: {\n        builders: {\n            mesh: addArrowMesh,\n        },\n        resolveRefs: (params, refs) => {\n            addRef(params.start, refs);\n            if (params.end)\n                addRef(params.end, refs);\n        },\n    },\n    label: {\n        builders: {\n            label: addPrimitiveLabel,\n        },\n        resolveRefs: resolveLabelRefs,\n    },\n    distance_measurement: {\n        builders: {\n            mesh: addDistanceMesh,\n            label: addDistanceLabel,\n        },\n        resolveRefs: resolveLineRefs,\n    },\n    angle_measurement: {\n        builders: {\n            mesh: addAngleMesh,\n            label: addAngleLabel,\n        },\n        resolveRefs: (params, refs) => {\n            addRef(params.a, refs);\n            addRef(params.b, refs);\n            addRef(params.c, refs);\n        },\n    },\n    ellipse: {\n        builders: {\n            mesh: addEllipseMesh,\n        },\n        resolveRefs: (params, refs) => {\n            addRef(params.center, refs);\n            if (params.major_axis_endpoint)\n                addRef(params.major_axis_endpoint, refs);\n            if (params.minor_axis_endpoint)\n                addRef(params.minor_axis_endpoint, refs);\n        },\n    },\n    ellipsoid: {\n        builders: {\n            mesh: addEllipsoidMesh,\n        },\n        resolveRefs: (params, refs) => {\n            addRef(params.center, refs);\n            if (params.major_axis_endpoint)\n                addRef(params.major_axis_endpoint, refs);\n            if (params.minor_axis_endpoint)\n                addRef(params.minor_axis_endpoint, refs);\n        },\n    },\n    box: {\n        builders: {\n            mesh: addBoxMesh,\n        },\n        resolveRefs: (params, refs) => {\n            addRef(params.center, refs);\n        },\n    }\n};\nfunction getPrimitives(primitives) {\n    var _a;\n    return ((_a = primitives.children) !== null && _a !== void 0 ? _a : []).filter(c => c.kind === 'primitive');\n}\nfunction addRef(position, refs) {\n    if (isPrimitiveComponentExpressions(position) && position.structure_ref) {\n        refs.add(position.structure_ref);\n    }\n}\nfunction hasPrimitiveKind(context, kind) {\n    var _a;\n    for (const c of context.primitives) {\n        const params = c.params;\n        const b = Builders[params.kind];\n        const builderFunction = b.builders[kind];\n        if (builderFunction) {\n            const test = (_a = b.isApplicable) === null || _a === void 0 ? void 0 : _a[kind];\n            if (test === undefined || test(params, context)) {\n                return true;\n            }\n        }\n    }\n    return false;\n}\n/** Save resolved position into `targetPosition`.\n * Return `true` if the resolved position is defined (i.e. vector or non-empty selection);\n * return `false` if the resolved position is not defined (i.e. empty selection). */\nfunction resolveBasePosition(context, position, targetPosition) {\n    return resolvePosition(context, position, targetPosition, undefined, undefined);\n}\nconst _EmptySphere = Sphere3D.zero();\nconst _EmptyBox = Box3D.zero();\n/** Save resolved position into `targetPosition`, `targetSphere`, `targetBox`.\n * Return `true` if the resolved position is defined (i.e. vector or non-empty selection);\n * return `false` if the resolved position is not defined (i.e. empty selection). */\nfunction resolvePosition(context, position, targetPosition, targetSphere, targetBox) {\n    let expr;\n    let pivotRef;\n    if (isVector3(position)) {\n        if (targetPosition)\n            Vec3.copy(targetPosition, position);\n        if (targetSphere)\n            Sphere3D.set(targetSphere, position, 0);\n        if (targetBox)\n            Box3D.set(targetBox, position, position);\n        return true;\n    }\n    if (isPrimitiveComponentExpressions(position)) {\n        // TODO: take schema into account for possible optimization\n        expr = rowsToExpression(position.expressions);\n        pivotRef = position.structure_ref;\n    }\n    else if (isComponentExpression(position)) {\n        expr = rowToExpression(position);\n    }\n    if (!expr) {\n        console.error('Invalid expression', position);\n        throw new Error('Invalid primitive potition expression, see console for details.');\n    }\n    const pivot = !pivotRef ? context.defaultStructure : context.structureRefs[pivotRef];\n    if (!pivot) {\n        throw new Error(`Structure with ref '${pivotRef !== null && pivotRef !== void 0 ? pivotRef : '<default>'}' not found.`);\n    }\n    const cacheKey = JSON.stringify(position);\n    if (context.positionCache.has(cacheKey)) {\n        const [isDefined, sphere, box] = context.positionCache.get(cacheKey);\n        if (targetPosition)\n            Vec3.copy(targetPosition, sphere.center);\n        if (targetSphere)\n            Sphere3D.copy(targetSphere, sphere);\n        if (targetBox)\n            Box3D.copy(targetBox, box);\n        return isDefined;\n    }\n    const { selection } = StructureQueryHelper.createAndRun(pivot, expr);\n    let box;\n    let sphere;\n    let isDefined;\n    if (StructureSelection.isEmpty(selection)) {\n        if (targetPosition)\n            Vec3.set(targetPosition, 0, 0, 0);\n        box = _EmptyBox;\n        sphere = _EmptySphere;\n        isDefined = false;\n        printEmptySelectionWarning(context, position);\n    }\n    else {\n        const loci = StructureSelection.toLociWithSourceUnits(selection);\n        const boundary = StructureElement.Loci.getBoundary(loci);\n        if (targetPosition)\n            Vec3.copy(targetPosition, boundary.sphere.center);\n        box = boundary.box;\n        sphere = boundary.sphere;\n        isDefined = true;\n    }\n    if (targetSphere)\n        Sphere3D.copy(targetSphere, sphere);\n    if (targetBox)\n        Box3D.copy(targetBox, box);\n    context.positionCache.set(cacheKey, [isDefined, sphere, box]);\n    return isDefined;\n}\nfunction getInstances(options) {\n    var _a;\n    if (!((_a = options === null || options === void 0 ? void 0 : options.instances) === null || _a === void 0 ? void 0 : _a.length))\n        return undefined;\n    return options.instances.map(i => Mat4.fromArray(Mat4(), i, 0));\n}\nfunction buildPrimitiveMesh(context, prev) {\n    var _a, _b, _c, _d, _e, _f;\n    const meshBuilder = MeshBuilder.createState(1024, 1024, prev);\n    const state = { groups: new GroupManager(), mesh: meshBuilder };\n    meshBuilder.currentGroup = -1;\n    for (const c of context.primitives) {\n        const p = c.params;\n        const b = Builders[p.kind];\n        if (!b) {\n            console.warn(`Primitive ${p.kind} not supported`);\n            continue;\n        }\n        (_b = (_a = b.builders).mesh) === null || _b === void 0 ? void 0 : _b.call(_a, context, state, c, p);\n    }\n    const { colors, tooltips } = state.groups;\n    const tooltip = (_d = (_c = context.options) === null || _c === void 0 ? void 0 : _c.tooltip) !== null && _d !== void 0 ? _d : '';\n    const color = (_f = decodeColor((_e = context.options) === null || _e === void 0 ? void 0 : _e.color)) !== null && _f !== void 0 ? _f : Color(0);\n    return Shape.create('Mesh', {\n        kind: 'mvs-primitives',\n        node: context.node,\n        groupToNode: state.groups.groupToNodeMap,\n    }, MeshBuilder.getMesh(meshBuilder), (g) => { var _a; return (_a = colors.get(g)) !== null && _a !== void 0 ? _a : color; }, (g) => 1, (g) => { var _a; return (_a = tooltips.get(g)) !== null && _a !== void 0 ? _a : tooltip; }, context.instances);\n}\nfunction buildPrimitiveLines(context, prev) {\n    var _a, _b, _c, _d, _e, _f;\n    const linesBuilder = LinesBuilder.create(1024, 1024, prev);\n    const state = { groups: new GroupManager(), lines: linesBuilder };\n    for (const c of context.primitives) {\n        const p = c.params;\n        const b = Builders[p.kind];\n        if (!b) {\n            console.warn(`Primitive ${p.kind} not supported`);\n            continue;\n        }\n        (_b = (_a = b.builders).line) === null || _b === void 0 ? void 0 : _b.call(_a, context, state, c, p);\n    }\n    const { colors, sizes, tooltips } = state.groups;\n    const tooltip = (_d = (_c = context.options) === null || _c === void 0 ? void 0 : _c.tooltip) !== null && _d !== void 0 ? _d : '';\n    const color = (_f = decodeColor((_e = context.options) === null || _e === void 0 ? void 0 : _e.color)) !== null && _f !== void 0 ? _f : Color(0);\n    return Shape.create('Lines', {\n        kind: 'mvs-primitives',\n        node: context.node,\n        groupToNode: state.groups.groupToNodeMap,\n    }, linesBuilder.getLines(), (g) => { var _a; return (_a = colors.get(g)) !== null && _a !== void 0 ? _a : color; }, (g) => { var _a; return (_a = sizes.get(g)) !== null && _a !== void 0 ? _a : 1; }, (g) => { var _a; return (_a = tooltips.get(g)) !== null && _a !== void 0 ? _a : tooltip; }, context.instances);\n}\nfunction buildPrimitiveLabels(context, prev) {\n    var _a, _b, _c, _d;\n    const labelsBuilder = TextBuilder.create(BaseLabelProps, 1024, 1024, prev);\n    const state = { groups: new GroupManager(), labels: labelsBuilder };\n    for (const c of context.primitives) {\n        const p = c.params;\n        const b = Builders[p.kind];\n        if (!b) {\n            console.warn(`Primitive ${p.kind} not supported`);\n            continue;\n        }\n        (_b = (_a = b.builders).label) === null || _b === void 0 ? void 0 : _b.call(_a, context, state, c, p);\n    }\n    const color = (_d = decodeColor((_c = context.options) === null || _c === void 0 ? void 0 : _c.label_color)) !== null && _d !== void 0 ? _d : Color(0);\n    const { colors, sizes, tooltips } = state.groups;\n    return Shape.create('Labels', {\n        kind: 'mvs-primitives',\n        node: context.node,\n        groupToNode: state.groups.groupToNodeMap,\n    }, labelsBuilder.getText(), (g) => { var _a; return (_a = colors.get(g)) !== null && _a !== void 0 ? _a : color; }, (g) => { var _a; return (_a = sizes.get(g)) !== null && _a !== void 0 ? _a : 1; }, (g) => { var _a; return (_a = tooltips.get(g)) !== null && _a !== void 0 ? _a : ''; }, context.instances);\n}\nfunction addMeshFaces(context, groups, node, params, addFace) {\n    const a = Vec3.zero();\n    const b = Vec3.zero();\n    const c = Vec3.zero();\n    let { indices, vertices, triangle_groups } = params;\n    const nTriangles = Math.floor(indices.length / 3);\n    triangle_groups !== null && triangle_groups !== void 0 ? triangle_groups : (triangle_groups = range(nTriangles)); // implicit grouping (triangle i = group i)\n    const groupSet = groups.allocateMany(node, triangle_groups);\n    for (let i = 0; i < nTriangles; i++) {\n        const mvsGroup = triangle_groups[i];\n        const builderGroup = groupSet.get(mvsGroup);\n        Vec3.fromArray(a, vertices, 3 * indices[3 * i]);\n        Vec3.fromArray(b, vertices, 3 * indices[3 * i + 1]);\n        Vec3.fromArray(c, vertices, 3 * indices[3 * i + 2]);\n        addFace(mvsGroup, builderGroup, a, b, c);\n    }\n}\nfunction addMesh(context, { groups, mesh }, node, params) {\n    if (!params.show_triangles)\n        return;\n    const { group_colors, group_tooltips, color, tooltip } = params;\n    addMeshFaces(context, groups, node, params, (mvsGroup, builderGroup, a, b, c) => {\n        var _a, _b;\n        groups.updateColor(builderGroup, (_a = group_colors[mvsGroup]) !== null && _a !== void 0 ? _a : color);\n        groups.updateTooltip(builderGroup, (_b = group_tooltips[mvsGroup]) !== null && _b !== void 0 ? _b : tooltip);\n        mesh.currentGroup = builderGroup;\n        MeshBuilder.addTriangle(mesh, a, b, c);\n    });\n    // this could be slightly improved by only updating color and tooltip once per group instead of once per triangle\n}\nfunction addMeshWireframe(context, { groups, lines }, node, params) {\n    if (!params.show_wireframe)\n        return;\n    const width = params.wireframe_width;\n    const { group_colors, group_tooltips, wireframe_color, color, tooltip } = params;\n    addMeshFaces(context, groups, node, params, (mvsGroup, builderGroup, a, b, c) => {\n        var _a, _b;\n        groups.updateColor(builderGroup, (_a = wireframe_color !== null && wireframe_color !== void 0 ? wireframe_color : group_colors[mvsGroup]) !== null && _a !== void 0 ? _a : color);\n        groups.updateTooltip(builderGroup, (_b = group_tooltips[mvsGroup]) !== null && _b !== void 0 ? _b : tooltip);\n        groups.updateSize(builderGroup, width);\n        lines.add(a[0], a[1], a[2], b[0], b[1], b[2], builderGroup);\n        lines.add(b[0], b[1], b[2], c[0], c[1], c[2], builderGroup);\n        lines.add(c[0], c[1], c[2], a[0], a[1], a[2], builderGroup);\n    });\n}\nfunction addLines(context, { groups, lines }, node, params) {\n    var _a, _b, _c;\n    const a = Vec3.zero();\n    const b = Vec3.zero();\n    let { indices, vertices, line_groups, group_colors, group_tooltips, group_widths } = params;\n    const width = params.width;\n    const nLines = Math.floor(indices.length / 2);\n    line_groups !== null && line_groups !== void 0 ? line_groups : (line_groups = range(nLines)); // implicit grouping (line i = group i)\n    const groupSet = groups.allocateMany(node, line_groups);\n    for (let i = 0; i < nLines; i++) {\n        const mvsGroup = line_groups[i];\n        const builderGroup = groupSet.get(mvsGroup);\n        groups.updateColor(builderGroup, (_a = group_colors[mvsGroup]) !== null && _a !== void 0 ? _a : params.color);\n        groups.updateTooltip(builderGroup, (_b = group_tooltips[mvsGroup]) !== null && _b !== void 0 ? _b : params.tooltip);\n        groups.updateSize(builderGroup, (_c = group_widths[mvsGroup]) !== null && _c !== void 0 ? _c : width);\n        Vec3.fromArray(a, vertices, 3 * indices[2 * i]);\n        Vec3.fromArray(b, vertices, 3 * indices[2 * i + 1]);\n        lines.add(a[0], a[1], a[2], b[0], b[1], b[2], builderGroup);\n    }\n}\nfunction resolveLineRefs(params, refs) {\n    addRef(params.start, refs);\n    addRef(params.end, refs);\n}\nconst lStart = Vec3.zero();\nconst lEnd = Vec3.zero();\nfunction addTubeMesh(context, { groups, mesh }, node, params, options) {\n    if (!(options === null || options === void 0 ? void 0 : options.skipResolvePosition)) {\n        const startDefined = resolveBasePosition(context, params.start, lStart);\n        const endDefined = resolveBasePosition(context, params.end, lEnd);\n        if (!startDefined || !endDefined)\n            return;\n    }\n    const radius = params.radius;\n    const cylinderProps = {\n        radiusBottom: radius,\n        radiusTop: radius,\n        topCap: true,\n        bottomCap: true,\n    };\n    mesh.currentGroup = groups.allocateSingle(node);\n    groups.updateColor(mesh.currentGroup, params.color);\n    groups.updateTooltip(mesh.currentGroup, params.tooltip);\n    if (params.dash_length) {\n        const dist = Vec3.distance(lStart, lEnd);\n        const count = Math.ceil(dist / (2 * params.dash_length));\n        addFixedCountDashedCylinder(mesh, lStart, lEnd, 1.0, count, true, cylinderProps);\n    }\n    else {\n        addSimpleCylinder(mesh, lStart, lEnd, cylinderProps);\n    }\n}\nconst ArrowState = {\n    start: Vec3.zero(),\n    end: Vec3.zero(),\n    dir: Vec3.zero(),\n    startCap: Vec3.zero(),\n    endCap: Vec3.zero(),\n};\nfunction addArrowMesh(context, { groups, mesh }, node, params) {\n    var _a, _b, _c, _d;\n    const startDefined = resolveBasePosition(context, params.start, ArrowState.start);\n    if (!startDefined)\n        return;\n    if (params.end) {\n        const endDefined = resolveBasePosition(context, params.end, ArrowState.end);\n        if (!endDefined)\n            return;\n    }\n    else if (params.direction) {\n        Vec3.add(ArrowState.end, ArrowState.start, params.direction);\n    }\n    else {\n        console.warn(`Primitive arrow does not contain \"end\" nor \"distance\". Not showing.`);\n        return;\n    }\n    Vec3.sub(ArrowState.dir, ArrowState.end, ArrowState.start);\n    Vec3.normalize(ArrowState.dir, ArrowState.dir);\n    if (params.length) {\n        Vec3.scaleAndAdd(ArrowState.end, ArrowState.start, ArrowState.dir, params.length);\n    }\n    const length = Vec3.distance(ArrowState.start, ArrowState.end);\n    if (length < 1e-3)\n        return;\n    const tubeRadius = params.tube_radius;\n    const tubeProps = {\n        radiusBottom: tubeRadius,\n        radiusTop: tubeRadius,\n        topCap: !params.show_end_cap,\n        bottomCap: !params.show_start_cap,\n    };\n    mesh.currentGroup = groups.allocateSingle(node);\n    groups.updateColor(mesh.currentGroup, params.color);\n    groups.updateTooltip(mesh.currentGroup, params.tooltip);\n    if (params.show_start_cap) {\n        const startRadius = (_a = params.start_cap_radius) !== null && _a !== void 0 ? _a : 2 * tubeRadius;\n        const startCapLength = (_b = params.start_cap_length) !== null && _b !== void 0 ? _b : 2 * startRadius;\n        Vec3.scaleAndAdd(ArrowState.startCap, ArrowState.start, ArrowState.dir, startCapLength);\n        addSimpleCylinder(mesh, ArrowState.startCap, ArrowState.start, {\n            radiusBottom: startRadius,\n            radiusTop: 0,\n            topCap: false,\n            bottomCap: true,\n            radialSegments: 12,\n        });\n    }\n    else {\n        Vec3.copy(ArrowState.startCap, ArrowState.start);\n    }\n    if (params.show_end_cap) {\n        const endRadius = (_c = params.end_cap_radius) !== null && _c !== void 0 ? _c : 2 * tubeRadius;\n        const endCapLength = (_d = params.end_cap_length) !== null && _d !== void 0 ? _d : 2 * endRadius;\n        Vec3.scaleAndAdd(ArrowState.endCap, ArrowState.end, ArrowState.dir, -endCapLength);\n        addSimpleCylinder(mesh, ArrowState.endCap, ArrowState.end, {\n            radiusBottom: endRadius,\n            radiusTop: 0,\n            topCap: false,\n            bottomCap: true,\n            radialSegments: 12,\n        });\n    }\n    else {\n        Vec3.copy(ArrowState.endCap, ArrowState.end);\n    }\n    if (params.show_tube) {\n        if (params.tube_dash_length) {\n            const dist = Vec3.distance(ArrowState.startCap, ArrowState.endCap);\n            const count = Math.ceil(dist / (2 * params.tube_dash_length));\n            addFixedCountDashedCylinder(mesh, ArrowState.startCap, ArrowState.endCap, 1.0, count, true, tubeProps);\n        }\n        else {\n            addSimpleCylinder(mesh, ArrowState.startCap, ArrowState.endCap, tubeProps);\n        }\n    }\n}\n/** Return distance in angstroms, or `undefined` if any of the endpoints corresponds to empty substructure.\n * This function also sets `lStart`, `lEnd` globals. */\nfunction computeDistance(context, start, end) {\n    const startDefined = resolveBasePosition(context, start, lStart);\n    const endDefined = resolveBasePosition(context, end, lEnd);\n    if (startDefined && endDefined)\n        return Vec3.distance(lStart, lEnd);\n    else\n        return undefined;\n}\n// /** Return text for distance measurement label/tooltip. */\nfunction distanceLabel(distance, params) {\n    const distStr = `${round(distance, 2)} `;\n    if (typeof params.label_template === 'string')\n        return params.label_template.replace('{{distance}}', distStr);\n    else\n        return distStr;\n}\nfunction addDistanceMesh(context, state, node, params) {\n    const distance = computeDistance(context, params.start, params.end); // sets lStart, lEnd\n    if (distance === undefined)\n        return; // empty substructure in measurement\n    const tooltip = distanceLabel(distance, params);\n    addTubeMesh(context, state, node, { ...params, tooltip }, { skipResolvePosition: true });\n}\nconst labelPos = Vec3.zero();\nfunction addDistanceLabel(context, state, node, params) {\n    const { labels, groups } = state;\n    const dist = computeDistance(context, params.start, params.end); // sets lStart, lEnd\n    if (dist === undefined)\n        return; // empty substructure in measurement\n    let size;\n    if (typeof params.label_size === 'number') {\n        size = params.label_size;\n    }\n    else {\n        size = Math.max(dist * (params.label_auto_size_scale), params.label_auto_size_min);\n    }\n    Vec3.add(labelPos, lStart, lEnd);\n    Vec3.scale(labelPos, labelPos, 0.5);\n    const group = groups.allocateSingle(node);\n    groups.updateColor(group, params.label_color);\n    groups.updateSize(group, size);\n    labels.add(distanceLabel(dist, params), labelPos[0], labelPos[1], labelPos[2], 1.05 * (params.radius), 1, group);\n}\nconst AngleState = {\n    isDefined: false,\n    a: Vec3(),\n    b: Vec3(),\n    c: Vec3(),\n    ba: Vec3(),\n    bc: Vec3(),\n    labelPos: Vec3(),\n    /** Sector radius */\n    radius: 0,\n    label: '',\n};\nfunction syncAngleState(context, params) {\n    const aDefined = resolveBasePosition(context, params.a, AngleState.a);\n    const bDefined = resolveBasePosition(context, params.b, AngleState.b);\n    const cDefined = resolveBasePosition(context, params.c, AngleState.c);\n    AngleState.isDefined = aDefined && bDefined && cDefined;\n    if (!AngleState.isDefined)\n        return;\n    Vec3.sub(AngleState.ba, AngleState.a, AngleState.b);\n    Vec3.sub(AngleState.bc, AngleState.c, AngleState.b);\n    const value = radToDeg(Vec3.angle(AngleState.ba, AngleState.bc));\n    const angle = `${round(value, 2)}\\u00B0`;\n    AngleState.label = typeof params.label_template === 'string' ? params.label_template.replace('{{angle}}', angle) : angle;\n    if (typeof params.section_radius === 'number') {\n        AngleState.radius = params.section_radius;\n    }\n    else {\n        AngleState.radius = Math.min(Vec3.magnitude(AngleState.ba), Vec3.magnitude(AngleState.bc));\n        if (typeof params.section_radius_scale === 'number') {\n            AngleState.radius *= params.section_radius_scale;\n        }\n    }\n}\nfunction addAngleMesh(context, state, node, params) {\n    var _a;\n    syncAngleState(context, params);\n    if (!AngleState.isDefined)\n        return; // empty substructure in measurement\n    const { groups, mesh } = state;\n    if (params.show_vector) {\n        const radius = (_a = params.vector_radius) !== null && _a !== void 0 ? _a : 0.05;\n        const cylinderProps = {\n            radiusBottom: radius,\n            radiusTop: radius,\n            topCap: true,\n            bottomCap: true,\n        };\n        mesh.currentGroup = groups.allocateSingle(node);\n        groups.updateColor(mesh.currentGroup, params.vector_color);\n        groups.updateTooltip(mesh.currentGroup, AngleState.label);\n        let count = Math.ceil(Vec3.magnitude(AngleState.ba) / (2 * radius));\n        addFixedCountDashedCylinder(mesh, AngleState.a, AngleState.b, 1.0, count, true, cylinderProps);\n        count = Math.ceil(Vec3.magnitude(AngleState.bc) / (2 * radius));\n        addFixedCountDashedCylinder(mesh, AngleState.b, AngleState.c, 1.0, count, true, cylinderProps);\n    }\n    if (params.show_section) {\n        const angle = Vec3.angle(AngleState.ba, AngleState.bc);\n        Vec3.normalize(AngleState.ba, AngleState.ba);\n        Vec3.normalize(AngleState.bc, AngleState.bc);\n        Vec3.scale(AngleState.ba, AngleState.ba, AngleState.radius);\n        Vec3.scale(AngleState.bc, AngleState.bc, AngleState.radius);\n        addEllipseMesh(context, state, node, {\n            kind: 'ellipse',\n            as_circle: true,\n            center: AngleState.b,\n            major_axis_endpoint: null,\n            major_axis: AngleState.ba,\n            minor_axis_endpoint: null,\n            minor_axis: AngleState.bc,\n            radius_major: AngleState.radius,\n            radius_minor: AngleState.radius,\n            theta_start: 0,\n            theta_end: angle,\n            color: params.section_color,\n            tooltip: AngleState.label,\n        });\n    }\n}\nfunction addAngleLabel(context, state, node, params) {\n    const { labels, groups } = state;\n    syncAngleState(context, params);\n    if (!AngleState.isDefined)\n        return; // empty substructure in measurement\n    Vec3.normalize(AngleState.ba, AngleState.ba);\n    Vec3.normalize(AngleState.bc, AngleState.bc);\n    Vec3.scale(AngleState.ba, AngleState.ba, AngleState.radius);\n    Vec3.scale(AngleState.bc, AngleState.bc, AngleState.radius);\n    let size;\n    if (typeof params.label_size === 'number') {\n        size = params.label_size;\n    }\n    else {\n        size = Math.max(AngleState.radius * (params.label_auto_size_scale), params.label_auto_size_min);\n    }\n    Vec3.add(AngleState.labelPos, AngleState.ba, AngleState.bc);\n    Vec3.normalize(AngleState.labelPos, AngleState.labelPos);\n    Vec3.scale(AngleState.labelPos, AngleState.labelPos, AngleState.radius);\n    Vec3.add(AngleState.labelPos, AngleState.labelPos, AngleState.b);\n    const group = groups.allocateSingle(node);\n    groups.updateColor(group, params.label_color);\n    groups.updateSize(group, size);\n    labels.add(AngleState.label, AngleState.labelPos[0], AngleState.labelPos[1], AngleState.labelPos[2], 1, 1, group);\n}\nfunction resolveLabelRefs(params, refs) {\n    addRef(params.position, refs);\n}\nconst PrimitiveLabelState = {\n    position: Vec3.zero(),\n    sphere: Sphere3D.zero(),\n};\nfunction addPrimitiveLabel(context, state, node, params) {\n    const { labels, groups } = state;\n    const positionDefined = resolvePosition(context, params.position, PrimitiveLabelState.position, PrimitiveLabelState.sphere, undefined);\n    if (!positionDefined)\n        return;\n    const group = groups.allocateSingle(node);\n    groups.updateColor(group, params.label_color);\n    groups.updateSize(group, params.label_size);\n    const offset = PrimitiveLabelState.sphere.radius + params.label_offset;\n    labels.add(params.text, PrimitiveLabelState.position[0], PrimitiveLabelState.position[1], PrimitiveLabelState.position[2], offset, 1, group);\n}\nconst circleCache = new Map();\nfunction getCircle(options) {\n    var _a, _b, _c;\n    const key = JSON.stringify(options);\n    if (circleCache.has(key))\n        return circleCache.get(key);\n    const thetaLength = ((_a = options.thetaEnd) !== null && _a !== void 0 ? _a : 2 * Math.PI) - ((_b = options.thetaStart) !== null && _b !== void 0 ? _b : 0);\n    if (Math.abs(thetaLength) < 1e-3)\n        return null;\n    const circle = Circle({\n        radius: 1,\n        thetaStart: (_c = options.thetaStart) !== null && _c !== void 0 ? _c : 0,\n        thetaLength,\n        segments: Math.ceil(2 * Math.PI / thetaLength * 64),\n    });\n    circleCache.set(key, circle);\n    return circle;\n}\nconst EllipseState = {\n    centerPos: Vec3.zero(),\n    majorPos: Vec3.zero(),\n    minorPos: Vec3.zero(),\n    majorAxis: Vec3.zero(),\n    minorAxis: Vec3.zero(),\n    scale: Vec3.zero(),\n    normal: Vec3.zero(),\n    scaleXform: Mat4.identity(),\n    rotationXform: Mat4.identity(),\n    translationXform: Mat4.identity(),\n    xform: Mat4.identity(),\n};\nfunction addEllipseMesh(context, state, node, params) {\n    // Unit circle in the XZ plane (Y up)\n    // X = minor axis, Y = normal, Z = major axis\n    var _a, _b, _c;\n    const circle = getCircle({ thetaStart: params.theta_start, thetaEnd: params.theta_end });\n    if (!circle)\n        return;\n    const centerDefined = resolvePosition(context, params.center, EllipseState.centerPos, undefined, undefined);\n    if (!centerDefined)\n        return;\n    if (params.major_axis_endpoint) {\n        const endpointDefined = resolvePosition(context, params.major_axis_endpoint, EllipseState.majorPos, undefined, undefined);\n        if (!endpointDefined)\n            return;\n        Vec3.sub(EllipseState.majorAxis, EllipseState.majorPos, EllipseState.centerPos);\n    }\n    else {\n        Vec3.copy(EllipseState.majorAxis, params.major_axis);\n    }\n    if (params.minor_axis_endpoint) {\n        const endpointDefined = resolvePosition(context, params.minor_axis_endpoint, EllipseState.minorPos, undefined, undefined);\n        if (!endpointDefined)\n            return;\n        Vec3.sub(EllipseState.minorAxis, EllipseState.minorPos, EllipseState.centerPos);\n    }\n    else {\n        Vec3.copy(EllipseState.minorAxis, params.minor_axis);\n    }\n    const { mesh, groups } = state;\n    // Translation\n    Mat4.fromTranslation(EllipseState.translationXform, EllipseState.centerPos);\n    // Scale\n    if (params.as_circle) {\n        const r = (_a = params.radius_major) !== null && _a !== void 0 ? _a : Vec3.magnitude(EllipseState.majorAxis);\n        Vec3.set(EllipseState.scale, r, 1, r);\n    }\n    else {\n        const major = (_b = params.radius_major) !== null && _b !== void 0 ? _b : Vec3.magnitude(EllipseState.majorAxis);\n        const minor = (_c = params.radius_minor) !== null && _c !== void 0 ? _c : Vec3.magnitude(EllipseState.minorAxis);\n        Vec3.set(EllipseState.scale, minor, 1, major);\n    }\n    Mat4.fromScaling(EllipseState.scaleXform, EllipseState.scale);\n    // Rotation\n    Vec3.normalize(EllipseState.minorAxis, EllipseState.minorAxis);\n    Vec3.normalize(EllipseState.majorAxis, EllipseState.majorAxis);\n    Vec3.cross(EllipseState.normal, EllipseState.majorAxis, EllipseState.minorAxis);\n    Mat4.targetTo(EllipseState.rotationXform, Vec3.origin, EllipseState.majorAxis, EllipseState.normal);\n    Mat4.mul(EllipseState.rotationXform, EllipseState.rotationXform, Mat4.rotY180);\n    // Final xform\n    Mat4.mul3(EllipseState.xform, EllipseState.translationXform, EllipseState.rotationXform, EllipseState.scaleXform);\n    mesh.currentGroup = groups.allocateSingle(node);\n    groups.updateColor(mesh.currentGroup, params.color);\n    groups.updateTooltip(mesh.currentGroup, params.tooltip);\n    MeshBuilder.addPrimitive(mesh, EllipseState.xform, circle);\n    MeshBuilder.addPrimitiveFlipped(mesh, EllipseState.xform, circle);\n}\nconst EllipsoidState = {\n    centerPos: Vec3.zero(),\n    majorPos: Vec3.zero(),\n    minorPos: Vec3.zero(),\n    majorAxis: Vec3.zero(),\n    minorAxis: Vec3.zero(),\n    sphere: Sphere3D.zero(),\n    radius: Vec3.zero(),\n    extent: Vec3.zero(),\n    up: Vec3.zero(),\n};\nfunction addEllipsoidMesh(context, state, node, params) {\n    const centerDefined = resolvePosition(context, params.center, EllipsoidState.centerPos, EllipsoidState.sphere, undefined);\n    if (!centerDefined)\n        return;\n    if (params.major_axis_endpoint) {\n        const endpointDefined = resolvePosition(context, params.major_axis_endpoint, EllipsoidState.majorPos, undefined, undefined);\n        if (!endpointDefined)\n            return;\n        Vec3.sub(EllipsoidState.majorAxis, EllipsoidState.majorPos, EllipsoidState.centerPos);\n    }\n    else if (params.major_axis) {\n        Vec3.copy(EllipsoidState.majorAxis, params.major_axis);\n    }\n    else {\n        Vec3.copy(EllipsoidState.majorAxis, Vec3.unitX);\n    }\n    if (params.minor_axis_endpoint) {\n        const endpointDefined = resolvePosition(context, params.minor_axis_endpoint, EllipsoidState.minorPos, undefined, undefined);\n        if (!endpointDefined)\n            return;\n        Vec3.sub(EllipsoidState.minorAxis, EllipsoidState.minorPos, EllipsoidState.centerPos);\n    }\n    else if (params.minor_axis) {\n        Vec3.copy(EllipsoidState.minorAxis, params.minor_axis);\n    }\n    else {\n        Vec3.copy(EllipsoidState.minorAxis, Vec3.unitY);\n    }\n    if (typeof params.radius === 'number') {\n        Vec3.set(EllipsoidState.radius, params.radius, params.radius, params.radius);\n    }\n    else if (params.radius) {\n        Vec3.copy(EllipsoidState.radius, params.radius);\n    }\n    else {\n        const r = EllipsoidState.sphere.radius;\n        Vec3.set(EllipsoidState.radius, r, r, r);\n    }\n    if (typeof params.radius_extent === 'number') {\n        Vec3.set(EllipsoidState.extent, params.radius_extent, params.radius_extent, params.radius_extent);\n    }\n    else if (params.radius_extent) {\n        Vec3.copy(EllipsoidState.extent, params.radius_extent);\n    }\n    else {\n        Vec3.set(EllipsoidState.extent, 0, 0, 0);\n    }\n    Vec3.add(EllipsoidState.radius, EllipsoidState.radius, EllipsoidState.extent);\n    const { mesh, groups } = state;\n    mesh.currentGroup = groups.allocateSingle(node);\n    groups.updateColor(mesh.currentGroup, params.color);\n    groups.updateTooltip(mesh.currentGroup, params.tooltip);\n    Vec3.normalize(EllipsoidState.majorAxis, EllipsoidState.majorAxis);\n    Vec3.normalize(EllipsoidState.minorAxis, EllipsoidState.minorAxis);\n    Vec3.cross(EllipsoidState.up, EllipsoidState.majorAxis, EllipsoidState.minorAxis);\n    addEllipsoid(mesh, EllipsoidState.centerPos, EllipsoidState.up, EllipsoidState.minorAxis, EllipsoidState.radius, 3);\n}\nconst BoxState = {\n    center: Vec3.zero(),\n    boundary: Box3D.zero(),\n    size: Vec3.zero(),\n    cage: BoxCage(),\n    translationXform: Mat4.identity(),\n    scaleXform: Mat4.identity(),\n    xform: Mat4.identity(),\n};\nfunction addBoxMesh(context, state, node, params) {\n    if (!params.show_edges && !params.show_faces)\n        return;\n    const positionDefined = resolvePosition(context, params.center, BoxState.center, undefined, BoxState.boundary);\n    if (!positionDefined)\n        return;\n    if (params.extent) {\n        Box3D.expand(BoxState.boundary, BoxState.boundary, params.extent);\n    }\n    if (Box3D.volume(BoxState.boundary) < 1e-3)\n        return;\n    const { mesh, groups } = state;\n    Mat4.fromScaling(BoxState.scaleXform, Box3D.size(BoxState.size, BoxState.boundary));\n    Mat4.fromTranslation(BoxState.translationXform, BoxState.center);\n    Mat4.mul(BoxState.xform, BoxState.translationXform, BoxState.scaleXform);\n    if (params.show_faces) {\n        mesh.currentGroup = groups.allocateSingle(node);\n        groups.updateColor(mesh.currentGroup, params.face_color);\n        groups.updateTooltip(mesh.currentGroup, params.tooltip);\n        MeshBuilder.addPrimitive(mesh, BoxState.xform, Box());\n    }\n    if (params.show_edges) {\n        mesh.currentGroup = groups.allocateSingle(node);\n        groups.updateColor(mesh.currentGroup, params.edge_color);\n        groups.updateTooltip(mesh.currentGroup, params.tooltip);\n        MeshBuilder.addCage(mesh, BoxState.xform, BoxCage(), params.edge_radius, 2, 8);\n    }\n}\n", "/**\n * Copyright (c) 2025 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author David Sehnal <david.sehnal@gmail.com>\n */\nexport const IsHiddenCustomStateExtension = {\n    id: 'ww-pdb/is-hidden-custom-state',\n    description: 'Allow updating initial visibility of nodes',\n    createExtensionContext: () => ({}),\n    action: (updateTarget, node) => {\n        var _a;\n        if (!node.custom || !((_a = node.custom) === null || _a === void 0 ? void 0 : _a.is_hidden))\n            return;\n        updateTarget.update.to(updateTarget.selector).updateState({ isHidden: true });\n    },\n};\n", "/**\n * Copyright (c) 2024 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Adam Midlik <midlik@gmail.com>\n */\nimport { StructureElement } from '../../../mol-model/structure';\nimport { createStructureComponent } from '../../../mol-plugin-state/helpers/structure-component';\nimport { PluginStateTransform, PluginStateObject as SO } from '../../../mol-plugin-state/objects';\nimport { MolScriptBuilder } from '../../../mol-script/language/builder';\nimport { ParamDefinition as PD } from '../../../mol-util/param-definition';\nexport const StructureSurroundingsParams = {\n    radius: PD.Numeric(5, { min: 0 }, { description: 'Surroundings radius in Angstroms' }),\n    includeSelf: PD.Boolean(true, { description: 'Include parent selection itself in the surroundings' }),\n    wholeResidues: PD.Boolean(true, { description: 'Include whole residues, instead of individual atoms' }),\n    nullIfEmpty: PD.Optional(PD.Boolean(true, { isHidden: true })),\n};\nexport const StructureSurroundings = PluginStateTransform.BuiltIn({\n    name: 'structure-surroundings',\n    display: { name: 'Surroundings', description: 'Surroundings of a structure component.' },\n    from: SO.Molecule.Structure,\n    to: SO.Molecule.Structure,\n    params: StructureSurroundingsParams,\n})({\n    apply({ a, params, cache }) {\n        var _a;\n        const struct = a.data;\n        const rootStruct = (_a = struct.parent) !== null && _a !== void 0 ? _a : struct;\n        const targetBundle = StructureElement.Bundle.fromSubStructure(rootStruct, struct);\n        const targetExpr = StructureElement.Bundle.toExpression(targetBundle);\n        let surroundingsExpr = MolScriptBuilder.struct.modifier.includeSurroundings({\n            0: targetExpr,\n            radius: params.radius,\n            'as-whole-residues': params.wholeResidues,\n        });\n        if (!params.includeSelf) {\n            surroundingsExpr = MolScriptBuilder.struct.modifier.exceptBy({\n                0: surroundingsExpr,\n                by: targetExpr,\n            });\n        }\n        return createStructureComponent(rootStruct, { label: `Surroundings (${params.radius} )`, type: { name: 'expression', params: surroundingsExpr }, nullIfEmpty: params.nullIfEmpty }, cache);\n    },\n    dispose({ b }) {\n        b === null || b === void 0 ? void 0 : b.data.customPropertyDescriptors.dispose();\n    }\n});\n", "/**\n * Copyright (c) 2023-2025 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Adam Midlik <midlik@gmail.com>\n * @author David Sehnal <david.sehnal@gmail.com>\n */\nimport { StructureRepresentation3D } from '../../mol-plugin-state/transforms/representation';\nimport { StateTree } from '../../mol-state';\nimport { UUID } from '../../mol-util';\nimport { stringHash } from './helpers/utils';\nimport { dfs } from './tree/generic/tree-utils';\nexport function loadTreeVirtual(plugin, tree, loadingActions, context, options) {\n    var _a;\n    const updateRoot = UpdateTarget.create(plugin, (_a = options === null || options === void 0 ? void 0 : options.replaceExisting) !== null && _a !== void 0 ? _a : false);\n    loadTreeInUpdate(updateRoot, tree, loadingActions, context, options);\n    const stateTree = updateRoot.update.getTree();\n    const stateSnapshot = { tree: StateTree.toJSON(stateTree) };\n    const pluginStateSnapshot = { id: UUID.create22(), data: stateSnapshot };\n    return pluginStateSnapshot;\n}\nfunction loadTreeInUpdate(updateRoot, tree, loadingActions, context, options) {\n    var _a;\n    const mapping = new Map();\n    if (options === null || options === void 0 ? void 0 : options.replaceExisting) {\n        UpdateTarget.deleteChildren(updateRoot);\n    }\n    const extensionContexts = ((_a = options === null || options === void 0 ? void 0 : options.extensions) !== null && _a !== void 0 ? _a : []).map(ext => ({ ext, extCtx: ext.createExtensionContext(tree, context) }));\n    const mvsRefMap = new Map();\n    dfs(tree, (node, parent) => {\n        const kind = node.kind;\n        let msNode;\n        const updateParent = parent ? mapping.get(parent) : updateRoot;\n        const action = loadingActions[kind];\n        if (action) {\n            if (updateParent) {\n                msNode = action(updateParent, node, context);\n                if (msNode && node.ref) {\n                    UpdateTarget.tag(msNode, mvsRefTags(node.ref));\n                    mvsRefMap.set(node.ref, msNode.selector.ref);\n                }\n                mapping.set(node, msNode);\n            }\n            else {\n                console.warn(`No target found for this \"${node.kind}\" node`);\n                return;\n            }\n        }\n        if (updateParent) {\n            for (const { ext, extCtx } of extensionContexts) {\n                ext.action(msNode !== null && msNode !== void 0 ? msNode : updateParent, node, context, extCtx);\n            }\n        }\n    });\n    for (const target of updateRoot.targetManager.allTargets) {\n        UpdateTarget.dependsOn(target, mvsRefMap);\n    }\n    extensionContexts.forEach(e => { var _a, _b; return (_b = (_a = e.ext).disposeExtensionContext) === null || _b === void 0 ? void 0 : _b.call(_a, e.extCtx, tree, context); });\n}\nexport const UpdateTarget = {\n    /** Create a new update, with `selector` pointing to the root. */\n    create(plugin, replaceExisting) {\n        const update = plugin.build();\n        const msTarget = update.toRoot();\n        return { update, selector: msTarget.selector, targetManager: new TargetManager(plugin, replaceExisting), mvsDependencyRefs: new Set() };\n    },\n    /** Add a child node to `target.selector`, return a new `UpdateTarget` pointing to the new child. */\n    apply(target, transformer, params, options) {\n        var _a, _b;\n        let refSuffix = transformer.id;\n        if (transformer.id === StructureRepresentation3D.id) {\n            const reprType = (_b = (_a = params === null || params === void 0 ? void 0 : params.type) === null || _a === void 0 ? void 0 : _a.name) !== null && _b !== void 0 ? _b : '';\n            refSuffix += `:${reprType}`;\n        }\n        const ref = target.targetManager.getChildRef(target.selector, refSuffix);\n        const apply = target.update.to(target.selector).apply(transformer, params, { ...options, ref });\n        const result = { ...target, selector: apply.selector, mvsDependencyRefs: new Set(), transformer, transformParams: params };\n        target.targetManager.allTargets.push(result);\n        return result;\n    },\n    setMvsDependencies(target, refs) {\n        refs.forEach(ref => target.mvsDependencyRefs.add(ref));\n        return target;\n    },\n    dependsOn(target, mapping) {\n        if (!target.mvsDependencyRefs.size)\n            return target;\n        const dependsOn = Array.from(target.mvsDependencyRefs).map(d => mapping.get(d)).filter(d => d);\n        if (!dependsOn.length)\n            return target;\n        target.update.to(target.selector).dependsOn(dependsOn);\n        return target;\n    },\n    /** Add tags to `target.selector` */\n    tag(target, tags) {\n        if (tags.length > 0) {\n            target.update.to(target.selector).tag(tags);\n        }\n        return target;\n    },\n    /** Delete all children of `target.selector`. */\n    deleteChildren(target) {\n        const children = target.update.currentTree.children.get(target.selector.ref);\n        children.forEach(child => target.update.delete(child));\n        return target;\n    },\n    /** Commit all changes done in the current update. */\n    commit(target) {\n        return target.update.commit();\n    },\n};\n/** Manages transform refs in a deterministic way. Uses refs like !mvs:3ce3664304d32c5d:0 */\nclass TargetManager {\n    constructor(plugin, replaceExisting) {\n        /** For each hash (e.g. 3ce3664304d32c5d), store the number of already used refs with that hash. */\n        this._counter = {};\n        this.allTargets = [];\n        if (!replaceExisting) {\n            plugin.state.data.cells.forEach(cell => {\n                var _a;\n                const ref = cell.transform.ref;\n                if (ref.startsWith('!mvs:')) {\n                    const [_, hash, idNumber] = ref.split(':');\n                    const nextIdNumber = parseInt(idNumber) + 1;\n                    if (nextIdNumber > ((_a = this._counter[hash]) !== null && _a !== void 0 ? _a : 0)) {\n                        this._counter[hash] = nextIdNumber;\n                    }\n                }\n            });\n        }\n    }\n    /** Return ref for a new node with given `hash`; update the counter accordingly. */\n    nextRef(hash) {\n        var _a;\n        var _b;\n        (_a = (_b = this._counter)[hash]) !== null && _a !== void 0 ? _a : (_b[hash] = 0);\n        const idNumber = this._counter[hash]++;\n        return `!mvs:${hash}:${idNumber}`;\n    }\n    /** Return ref for a new node based on parent and desired suffix. */\n    getChildRef(parent, suffix) {\n        const hashBase = parent.ref.replace(/^!mvs:/, '') + ':' + suffix;\n        const hash = stringHash(hashBase);\n        const result = this.nextRef(hash);\n        return result;\n    }\n}\n/** Create node tags based of MVS node.ref */\nexport function mvsRefTags(mvsNodeRef) {\n    if (mvsNodeRef === undefined)\n        return [];\n    else\n        return [`mvs-ref:${mvsNodeRef}`];\n}\n", "/**\n * Copyright (c) 2024 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Adam Midlik <midlik@gmail.com>\n */\nimport { StateTransforms } from '../../../mol-plugin-state/transforms';\nimport { StructureSurroundings } from '../components/surroundings';\nimport { UpdateTarget } from '../load-generic';\nimport { getCustomProps } from '../tree/generic/tree-schema';\nconst DefaultNonCovalentInteractionRadius = 5;\nexport const NonCovalentInteractionsExtension = {\n    id: 'wwpdb/non-covalent-interactions',\n    description: 'Allow showing non-covalent interactions around components with molstar_show_non_covalent_interactions additional property',\n    createExtensionContext: () => ({}),\n    action: (updateTarget, node, context, extContext) => {\n        var _a;\n        if (node.kind !== 'component' && node.kind !== 'component_from_uri' && node.kind !== 'component_from_source')\n            return;\n        const customProps = getCustomProps(node);\n        if (!customProps.molstar_show_non_covalent_interactions)\n            return undefined;\n        const surroundings = UpdateTarget.apply(updateTarget, StructureSurroundings, {\n            radius: (_a = customProps.molstar_non_covalent_interactions_radius_ang) !== null && _a !== void 0 ? _a : DefaultNonCovalentInteractionRadius,\n            includeSelf: true,\n            wholeResidues: true,\n            nullIfEmpty: false,\n        });\n        // Bubble on target\n        UpdateTarget.apply(updateTarget, StateTransforms.Representation.StructureRepresentation3D, {\n            type: { name: 'ball-and-stick', params: { sizeFactor: 0.22, sizeAspectRatio: 0.73, adjustCylinderLength: true, xrayShaded: true, aromaticBonds: false, multipleBonds: 'off', excludeTypes: ['hydrogen-bond', 'metal-coordination'] } },\n            colorTheme: { name: 'element-symbol', params: {} },\n            sizeTheme: { name: 'physical', params: {} },\n        });\n        // Ball-and-stick on surrounding\n        UpdateTarget.apply(surroundings, StateTransforms.Representation.StructureRepresentation3D, {\n            type: { name: 'ball-and-stick', params: { sizeFactor: 0.16, excludeTypes: ['hydrogen-bond', 'metal-coordination'] } },\n            colorTheme: { name: 'element-symbol', params: {} },\n            sizeTheme: { name: 'physical', params: {} },\n        });\n        // Non-covalent interactions\n        UpdateTarget.apply(surroundings, StateTransforms.Representation.StructureRepresentation3D, {\n            type: { name: 'interactions', params: {} },\n            colorTheme: { name: 'interaction-type', params: {} },\n            sizeTheme: { name: 'uniform', params: {} },\n        });\n    },\n};\n", "/**\n * Copyright (c) 2023-2025 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Adam Midlik <midlik@gmail.com>\n * @author David Sehnal <david.sehnal@gmail.com>\n */\nimport { Mat3, Mat4, Vec3 } from '../../mol-math/linear-algebra';\nimport { Volume } from '../../mol-model/volume';\nimport { arrayDistinct } from '../../mol-util/array';\nimport { canonicalJsonString } from '../../mol-util/json';\nimport { stringToWords } from '../../mol-util/string';\nimport { MVSAnnotationColorThemeProvider } from './components/annotation-color-theme';\nimport { MVSAnnotationLabelRepresentationProvider } from './components/annotation-label/representation';\nimport { MultilayerColorThemeName, NoColor } from './components/multilayer-color-theme';\nimport { SelectorAll } from './components/selector';\nimport { rowToExpression, rowsToExpression } from './helpers/selections';\nimport { decodeColor, isDefined, stringHash } from './helpers/utils';\nimport { getChildren } from './tree/generic/tree-schema';\nimport { dfs, formatObject } from './tree/generic/tree-utils';\nimport { DefaultColor } from './tree/mvs/mvs-tree';\nexport const AnnotationFromUriKinds = new Set(['color_from_uri', 'component_from_uri', 'label_from_uri', 'tooltip_from_uri']);\nexport const AnnotationFromSourceKinds = new Set(['color_from_source', 'component_from_source', 'label_from_source', 'tooltip_from_source']);\n/** Return a 4x4 matrix representing a rotation followed by a translation */\nexport function transformFromRotationTranslation(rotation, translation) {\n    if (rotation && rotation.length !== 9)\n        throw new Error(`'rotation' param for 'transform' node must be array of 9 elements, found ${rotation}`);\n    if (translation && translation.length !== 3)\n        throw new Error(`'translation' param for 'transform' node must be array of 3 elements, found ${translation}`);\n    const T = Mat4.identity();\n    if (rotation) {\n        const rotMatrix = Mat3.fromArray(Mat3(), rotation, 0);\n        ensureRotationMatrix(rotMatrix, rotMatrix);\n        Mat4.fromMat3(T, rotMatrix);\n    }\n    if (translation) {\n        Mat4.setTranslation(T, Vec3.fromArray(Vec3(), translation, 0));\n    }\n    if (!Mat4.isRotationAndTranslation(T))\n        throw new Error(`'rotation' param for 'transform' is not a valid rotation matrix: ${rotation}`);\n    return T;\n}\n/** Adjust values in a close-to-rotation matrix `a` to ensure it is a proper rotation matrix\n * (i.e. its columns and rows are orthonormal and determinant equal to 1, within available precission). */\nfunction ensureRotationMatrix(out, a) {\n    const x = Vec3.fromArray(_tmpVecX, a, 0);\n    const y = Vec3.fromArray(_tmpVecY, a, 3);\n    const z = Vec3.fromArray(_tmpVecZ, a, 6);\n    Vec3.normalize(x, x);\n    Vec3.orthogonalize(y, x, y);\n    Vec3.normalize(z, Vec3.cross(z, x, y));\n    Mat3.fromColumns(out, x, y, z);\n    return out;\n}\nconst _tmpVecX = Vec3();\nconst _tmpVecY = Vec3();\nconst _tmpVecZ = Vec3();\n/** Create an array of props for `TransformStructureConformation` transformers from all 'transform' nodes applied to a 'structure' node. */\nexport function transformProps(node) {\n    const result = [];\n    const transforms = getChildren(node).filter(c => c.kind === 'transform');\n    for (const transform of transforms) {\n        const { rotation, translation } = transform.params;\n        const matrix = transformFromRotationTranslation(rotation, translation);\n        result.push({ transform: { name: 'matrix', params: { data: matrix, transpose: false } } });\n    }\n    return result;\n}\n/** Collect distinct annotation specs from all nodes in `tree` and set `context.annotationMap[node]` to respective annotationIds */\nexport function collectAnnotationReferences(tree, context) {\n    const distinctSpecs = {};\n    dfs(tree, node => {\n        var _a, _b, _c;\n        let spec = undefined;\n        if (AnnotationFromUriKinds.has(node.kind)) {\n            const p = node.params;\n            spec = { source: { name: 'url', params: { url: p.uri, format: p.format } }, schema: p.schema, cifBlock: blockSpec(p.block_header, p.block_index), cifCategory: (_a = p.category_name) !== null && _a !== void 0 ? _a : undefined };\n        }\n        else if (AnnotationFromSourceKinds.has(node.kind)) {\n            const p = node.params;\n            spec = { source: { name: 'source-cif', params: {} }, schema: p.schema, cifBlock: blockSpec(p.block_header, p.block_index), cifCategory: (_b = p.category_name) !== null && _b !== void 0 ? _b : undefined };\n        }\n        if (spec) {\n            const key = canonicalJsonString(spec);\n            (_c = distinctSpecs[key]) !== null && _c !== void 0 ? _c : (distinctSpecs[key] = { ...spec, id: stringHash(key) });\n            context.annotationMap.set(node, distinctSpecs[key].id);\n        }\n    });\n    return Object.values(distinctSpecs);\n}\nfunction blockSpec(header, index) {\n    if (isDefined(header)) {\n        return { name: 'header', params: { header: header } };\n    }\n    else {\n        return { name: 'index', params: { index: index !== null && index !== void 0 ? index : 0 } };\n    }\n}\n/** Collect annotation tooltips from all nodes in `tree` and map them to annotationIds. */\nexport function collectAnnotationTooltips(tree, context) {\n    const annotationTooltips = [];\n    dfs(tree, node => {\n        if (node.kind === 'tooltip_from_uri' || node.kind === 'tooltip_from_source') {\n            const annotationId = context.annotationMap.get(node);\n            if (annotationId) {\n                annotationTooltips.push({ annotationId, fieldName: node.params.field_name });\n            }\n            ;\n        }\n    });\n    return arrayDistinct(annotationTooltips);\n}\n/** Collect inline tooltips from all nodes in `tree`. */\nexport function collectInlineTooltips(tree, context) {\n    const inlineTooltips = [];\n    dfs(tree, (node, parent) => {\n        if (node.kind === 'tooltip') {\n            if ((parent === null || parent === void 0 ? void 0 : parent.kind) === 'component') {\n                inlineTooltips.push({\n                    text: node.params.text,\n                    selector: componentPropsFromSelector(parent.params.selector),\n                });\n            }\n            else if ((parent === null || parent === void 0 ? void 0 : parent.kind) === 'component_from_uri' || (parent === null || parent === void 0 ? void 0 : parent.kind) === 'component_from_source') {\n                const p = componentFromXProps(parent, context);\n                if (isDefined(p.annotationId) && isDefined(p.fieldName) && isDefined(p.fieldValues)) {\n                    inlineTooltips.push({\n                        text: node.params.text,\n                        selector: {\n                            name: 'annotation',\n                            params: { annotationId: p.annotationId, fieldName: p.fieldName, fieldValues: p.fieldValues },\n                        },\n                    });\n                }\n            }\n        }\n    });\n    return inlineTooltips;\n}\n/** Collect inline labels from all nodes in `tree`. */\nexport function collectInlineLabels(tree, context) {\n    const inlineLabels = [];\n    dfs(tree, (node, parent) => {\n        if (node.kind === 'label') {\n            if ((parent === null || parent === void 0 ? void 0 : parent.kind) === 'component') {\n                inlineLabels.push({\n                    text: node.params.text,\n                    position: {\n                        name: 'selection',\n                        params: {\n                            selector: componentPropsFromSelector(parent.params.selector),\n                        },\n                    },\n                });\n            }\n            else if ((parent === null || parent === void 0 ? void 0 : parent.kind) === 'component_from_uri' || (parent === null || parent === void 0 ? void 0 : parent.kind) === 'component_from_source') {\n                const p = componentFromXProps(parent, context);\n                if (isDefined(p.annotationId) && isDefined(p.fieldName) && isDefined(p.fieldValues)) {\n                    inlineLabels.push({\n                        text: node.params.text,\n                        position: {\n                            name: 'selection',\n                            params: {\n                                selector: {\n                                    name: 'annotation',\n                                    params: { annotationId: p.annotationId, fieldName: p.fieldName, fieldValues: p.fieldValues },\n                                },\n                            },\n                        },\n                    });\n                }\n            }\n        }\n    });\n    return inlineLabels;\n}\n/** Return `true` for components nodes which only serve for tooltip placement (not to be created in the MolStar object hierarchy) */\nexport function isPhantomComponent(node) {\n    if (node.ref !== undefined)\n        return false;\n    if (node.custom !== undefined && Object.keys(node.custom).length > 0)\n        return false;\n    return node.children && node.children.every(child => child.kind === 'tooltip' || child.kind === 'label');\n    // These nodes could theoretically be removed when converting MVS to Molstar tree, but would get very tricky if we allow nested components\n}\n/** Create props for `StructureFromModel` transformer from a structure node. */\nexport function structureProps(node) {\n    var _a;\n    const params = node.params;\n    switch (params.type) {\n        case 'model':\n            return {\n                type: {\n                    name: 'model',\n                    params: {}\n                },\n            };\n        case 'assembly':\n            return {\n                type: {\n                    name: 'assembly',\n                    params: { id: (_a = params.assembly_id) !== null && _a !== void 0 ? _a : undefined }\n                },\n            };\n        case 'symmetry':\n            return {\n                type: {\n                    name: 'symmetry',\n                    params: { ijkMin: Vec3.ofArray(params.ijk_min), ijkMax: Vec3.ofArray(params.ijk_max) }\n                },\n            };\n        case 'symmetry_mates':\n            return {\n                type: {\n                    name: 'symmetry-mates',\n                    params: { radius: params.radius }\n                }\n            };\n        default:\n            throw new Error(`NotImplementedError: Loading action for \"structure\" node, type \"${params.type}\"`);\n    }\n}\n/** Create value for `type` prop for `StructureComponent` transformer based on a MVS selector. */\nexport function componentPropsFromSelector(selector) {\n    if (selector === undefined) {\n        return SelectorAll;\n    }\n    else if (typeof selector === 'string') {\n        return { name: 'static', params: selector };\n    }\n    else if (Array.isArray(selector)) {\n        return { name: 'expression', params: rowsToExpression(selector) };\n    }\n    else {\n        return { name: 'expression', params: rowToExpression(selector) };\n    }\n}\n/** Return a pretty name for a value of selector param, e.g.  \"protein\" -> 'Protein', {label_asym_id: \"A\"} -> 'Custom Selection: {label_asym_id: \"A\"}' */\nexport function prettyNameFromSelector(selector) {\n    if (selector === undefined) {\n        return 'All';\n    }\n    else if (typeof selector === 'string') {\n        return stringToWords(selector);\n    }\n    else if (Array.isArray(selector)) {\n        return `Custom Selection: [${selector.map(formatObject).join(', ')}]`;\n    }\n    else {\n        return `Custom Selection: ${formatObject(selector)}`;\n    }\n}\n/** Create props for `StructureRepresentation3D` transformer from a label_from_* node. */\nexport function labelFromXProps(node, context) {\n    var _a;\n    const annotationId = context.annotationMap.get(node);\n    const fieldName = node.params.field_name;\n    const nearestReprNode = (_a = context.nearestReprMap) === null || _a === void 0 ? void 0 : _a.get(node);\n    return {\n        type: { name: MVSAnnotationLabelRepresentationProvider.name, params: { annotationId, fieldName } },\n        colorTheme: colorThemeForNode(nearestReprNode, context),\n    };\n}\n/** Create props for `AnnotationStructureComponent` transformer from a component_from_* node. */\nexport function componentFromXProps(node, context) {\n    const annotationId = context.annotationMap.get(node);\n    const { field_name, field_values } = node.params;\n    return {\n        annotationId,\n        fieldName: field_name,\n        fieldValues: field_values ? { name: 'selected', params: field_values.map(v => ({ value: v })) } : { name: 'all', params: {} },\n        nullIfEmpty: false,\n    };\n}\n/** Create props for `StructureRepresentation3D` transformer from a representation node. */\nexport function representationProps(node) {\n    var _a, _b;\n    const alpha = alphaForNode(node);\n    const params = node.params;\n    switch (params.type) {\n        case 'cartoon':\n            return {\n                type: { name: 'cartoon', params: { alpha, tubularHelices: params.tubular_helices } },\n                sizeTheme: { name: 'uniform', params: { value: params.size_factor } },\n            };\n        case 'ball_and_stick':\n            return {\n                type: { name: 'ball-and-stick', params: { sizeFactor: ((_a = params.size_factor) !== null && _a !== void 0 ? _a : 1) * 0.5, sizeAspectRatio: 0.5, alpha, ignoreHydrogens: params.ignore_hydrogens } },\n            };\n        case 'spacefill':\n            return {\n                type: { name: 'spacefill', params: { alpha, ignoreHydrogens: params.ignore_hydrogens } },\n                sizeTheme: { name: 'physical', params: { scale: params.size_factor } },\n            };\n        case 'carbohydrate':\n            return {\n                type: { name: 'carbohydrate', params: { alpha, sizeFactor: (_b = params.size_factor) !== null && _b !== void 0 ? _b : 1 } },\n            };\n        case 'surface':\n            return {\n                type: { name: 'molecular-surface', params: { alpha, ignoreHydrogens: params.ignore_hydrogens } },\n                sizeTheme: { name: 'physical', params: { scale: params.size_factor } },\n            };\n        default:\n            throw new Error('NotImplementedError');\n    }\n}\n/** Create value for `type.params.alpha` prop for `StructureRepresentation3D` transformer from a representation node based on 'opacity' nodes in its subtree. */\nexport function alphaForNode(node) {\n    const children = getChildren(node).filter(c => c.kind === 'opacity');\n    if (children.length > 0) {\n        return children[children.length - 1].params.opacity;\n    }\n    else {\n        return 1;\n    }\n}\nfunction hasMolStarUseDefaultColoring(node) {\n    if (!node.custom)\n        return false;\n    return 'molstar_use_default_coloring' in node.custom || 'molstar_color_theme_name' in node.custom;\n}\n/** Create value for `colorTheme` prop for `StructureRepresentation3D` transformer from a representation node based on color* nodes in its subtree. */\nexport function colorThemeForNode(node, context) {\n    var _a, _b, _c;\n    if ((node === null || node === void 0 ? void 0 : node.kind) === 'representation') {\n        const children = getChildren(node).filter(c => c.kind === 'color' || c.kind === 'color_from_uri' || c.kind === 'color_from_source');\n        if (children.length === 0) {\n            return {\n                name: 'uniform',\n                params: { value: decodeColor(DefaultColor) },\n            };\n        }\n        else if (children.length === 1 && hasMolStarUseDefaultColoring(children[0])) {\n            if ((_a = children[0].custom) === null || _a === void 0 ? void 0 : _a.molstar_use_default_coloring)\n                return undefined;\n            const custom = children[0].custom;\n            return {\n                name: (_b = custom === null || custom === void 0 ? void 0 : custom.molstar_color_theme_name) !== null && _b !== void 0 ? _b : undefined,\n                params: (_c = custom === null || custom === void 0 ? void 0 : custom.molstar_color_theme_params) !== null && _c !== void 0 ? _c : {},\n            };\n        }\n        else if (children.length === 1 && appliesColorToWholeRepr(children[0])) {\n            return colorThemeForNode(children[0], context);\n        }\n        else {\n            const layers = children.map(c => {\n                const theme = colorThemeForNode(c, context);\n                if (!theme)\n                    return undefined;\n                return { theme, selection: componentPropsFromSelector(c.kind === 'color' ? c.params.selector : undefined) };\n            }).filter(t => !!t);\n            return {\n                name: MultilayerColorThemeName,\n                params: { layers },\n            };\n        }\n    }\n    let annotationId = undefined;\n    let fieldName = undefined;\n    let color = undefined;\n    switch (node === null || node === void 0 ? void 0 : node.kind) {\n        case 'color_from_uri':\n        case 'color_from_source':\n            annotationId = context.annotationMap.get(node);\n            fieldName = node.params.field_name;\n            break;\n        case 'color':\n            color = node.params.color;\n            break;\n    }\n    if (annotationId) {\n        return {\n            name: MVSAnnotationColorThemeProvider.name,\n            params: { annotationId, fieldName, background: NoColor },\n        };\n    }\n    else {\n        return {\n            name: 'uniform',\n            params: { value: decodeColor(color) },\n        };\n    }\n}\nfunction appliesColorToWholeRepr(node) {\n    if (node.kind === 'color') {\n        return !isDefined(node.params.selector) || node.params.selector === 'all';\n    }\n    else {\n        return true;\n    }\n}\n/** Create a mapping of nearest representation nodes for each node in the tree\n * (to transfer coloring to label nodes smartly).\n * Only considers nodes within the same 'structure' subtree. */\nexport function makeNearestReprMap(root) {\n    const map = new Map();\n    // Propagate up:\n    dfs(root, undefined, (node, parent) => {\n        if (node.kind === 'representation') {\n            map.set(node, node);\n        }\n        if (node.kind !== 'structure' && map.has(node) && parent && !map.has(parent)) { // do not propagate above the lowest structure node\n            map.set(parent, map.get(node));\n        }\n    });\n    // Propagate down:\n    dfs(root, (node, parent) => {\n        if (!map.has(node) && parent && map.has(parent)) {\n            map.set(node, map.get(parent));\n        }\n    });\n    return map;\n}\n/** Create props for `VolumeRepresentation3D` transformer from a representation node. */\nexport function volumeRepresentationProps(node) {\n    var _a;\n    const alpha = alphaForNode(node);\n    const params = node.params;\n    switch (params.type) {\n        case 'isosurface':\n            const isoValue = typeof params.absolute_isovalue === 'number' ? Volume.IsoValue.absolute(params.absolute_isovalue) : Volume.IsoValue.relative((_a = params.relative_isovalue) !== null && _a !== void 0 ? _a : 0);\n            const visuals = [];\n            if (params.show_wireframe)\n                visuals.push('wireframe');\n            if (params.show_faces)\n                visuals.push('solid');\n            return {\n                type: { name: 'isosurface', params: { alpha, isoValue, visuals } },\n            };\n        default:\n            throw new Error('NotImplementedError');\n    }\n}\n/** Create value for `colorTheme` prop for `StructureRepresentation3D` transformer from a representation node based on color* nodes in its subtree. */\nexport function volumeColorThemeForNode(node, context) {\n    if ((node === null || node === void 0 ? void 0 : node.kind) !== 'volume_representation')\n        return undefined;\n    const children = getChildren(node).filter(c => c.kind === 'color');\n    if (children.length === 0) {\n        return {\n            name: 'uniform',\n            params: { value: decodeColor(DefaultColor) },\n        };\n    }\n    if (children.length === 1) {\n        return colorThemeForNode(children[0], context);\n    }\n}\n", "/**\n * Copyright (c) 2023-2025 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Adam Midlik <midlik@gmail.com>\n * @author David Sehnal <david.sehnal@gmail.com>\n */\nimport { omitObjectKeys, pickObjectKeys } from '../../../../mol-util/object';\nimport { addDefaults, condenseTree, convertTree, dfs, resolveUris } from '../generic/tree-utils';\nimport { MVSTreeSchema } from '../mvs/mvs-tree';\n/** Convert `format` parameter of `parse` node in `MolstarTree`\n * into `format` and `is_binary` parameters in `MolstarTree` */\nexport const ParseFormatMvsToMolstar = {\n    mmcif: { format: 'cif', is_binary: false },\n    bcif: { format: 'cif', is_binary: true },\n    pdb: { format: 'pdb', is_binary: false },\n    map: { format: 'map', is_binary: true },\n};\n/** Conversion rules for conversion from `MVSTree` (with all parameter values) to `MolstarTree` */\nconst mvsToMolstarConversionRules = {\n    'download': node => [],\n    'parse': (node, parent) => {\n        const { format, is_binary } = ParseFormatMvsToMolstar[node.params.format];\n        const convertedNode = { kind: 'parse', params: { ...node.params, format }, custom: node.custom, ref: node.ref };\n        if ((parent === null || parent === void 0 ? void 0 : parent.kind) === 'download') {\n            return [\n                { kind: 'download', params: { ...parent.params, is_binary }, custom: parent.custom, ref: parent.ref },\n                convertedNode,\n            ];\n        }\n        else {\n            console.warn('\"parse\" node is not being converted, this is suspicious');\n            return [convertedNode];\n        }\n    },\n    'structure': (node, parent) => {\n        if ((parent === null || parent === void 0 ? void 0 : parent.kind) !== 'parse')\n            throw new Error(`Parent of \"structure\" must be \"parse\", not \"${parent === null || parent === void 0 ? void 0 : parent.kind}\".`);\n        const { format } = ParseFormatMvsToMolstar[parent.params.format];\n        return [\n            { kind: 'trajectory', params: { format, ...pickObjectKeys(node.params, ['block_header', 'block_index']) } },\n            { kind: 'model', params: pickObjectKeys(node.params, ['model_index']) },\n            { kind: 'structure', params: omitObjectKeys(node.params, ['block_header', 'block_index', 'model_index']), custom: node.custom, ref: node.ref },\n        ];\n    },\n};\n/** Node kinds in `MolstarTree` that it makes sense to condense */\nconst molstarNodesToCondense = new Set(['download', 'parse', 'trajectory', 'model']);\n/** Convert MolViewSpec tree into MolStar tree */\nexport function convertMvsToMolstar(mvsTree, sourceUrl) {\n    const full = addDefaults(mvsTree, MVSTreeSchema);\n    if (sourceUrl)\n        resolveUris(full, sourceUrl, ['uri', 'url']);\n    const converted = convertTree(full, mvsToMolstarConversionRules);\n    if (converted.kind !== 'root')\n        throw new Error(\"Root's type is not 'root' after conversion from MVS tree to Molstar tree.\");\n    const condensed = condenseTree(converted, molstarNodesToCondense);\n    return condensed;\n}\nfunction fileExtensionMatches(filename, extensions) {\n    filename = filename.toLowerCase();\n    return extensions.some(ext => ext === '*' || filename.endsWith(ext));\n}\nconst StructureFormatExtensions = {\n    mmcif: ['.cif', '.mmif'],\n    bcif: ['.bcif'],\n    pdb: ['.pdb', '.ent'],\n    map: ['.map', '.ccp4', '.mrc', '.mrcs'],\n};\n/** Run some sanity check on a MVSTree. Return a list of potential problems (`undefined` if there are none) */\nexport function mvsSanityCheckIssues(tree) {\n    const result = [];\n    dfs(tree, (node, parent) => {\n        if (node.kind === 'parse' && (parent === null || parent === void 0 ? void 0 : parent.kind) === 'download') {\n            const source = parent.params.url;\n            const extensions = StructureFormatExtensions[node.params.format];\n            if (!fileExtensionMatches(source, extensions)) {\n                result.push(`Parsing data from ${source} as ${node.params.format} format might be a mistake. The file extension doesn't match recommended file extensions (${extensions.join(', ')})`);\n            }\n        }\n    });\n    return result.length > 0 ? result : undefined;\n}\n/** Run some sanity check on a MVSTree and print potential issues to the console. */\nexport function mvsSanityCheck(tree) {\n    const issues = mvsSanityCheckIssues(tree);\n    if (issues) {\n        console.warn('There are potential issues in the MVS tree:');\n        for (const issue of issues) {\n            console.warn(' ', issue);\n        }\n    }\n}\n", "/**\n * Copyright (c) 2023-2024 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Adam Midlik <midlik@gmail.com>\n */\nimport { omitObjectKeys, pickObjectKeys } from '../../../../mol-util/object';\nimport { RequiredField, bool } from '../generic/field-schema';\nimport { SimpleParamsSchema } from '../generic/params-schema';\nimport { TreeSchema } from '../generic/tree-schema';\nimport { FullMVSTreeSchema } from '../mvs/mvs-tree';\nimport { MolstarParseFormatT } from '../mvs/param-types';\n/** Schema for `MolstarTree` (intermediate tree representation between `MVSTree` and a real Molstar state) */\nexport const MolstarTreeSchema = TreeSchema({\n    rootKind: 'root',\n    nodes: {\n        ...FullMVSTreeSchema.nodes,\n        download: {\n            ...FullMVSTreeSchema.nodes.download,\n            params: SimpleParamsSchema({\n                ...FullMVSTreeSchema.nodes.download.params.fields,\n                is_binary: RequiredField(bool, 'Specifies whether file is downloaded as bytes array or string'),\n            }),\n        },\n        parse: {\n            ...FullMVSTreeSchema.nodes.parse,\n            params: SimpleParamsSchema({\n                format: RequiredField(MolstarParseFormatT, 'File format'),\n            }),\n        },\n        /** Auxiliary node corresponding to Molstar's TrajectoryFrom*. */\n        trajectory: {\n            description: \"Auxiliary node corresponding to Molstar's TrajectoryFrom*.\",\n            parent: ['parse'],\n            params: SimpleParamsSchema({\n                format: RequiredField(MolstarParseFormatT, 'File format'),\n                ...pickObjectKeys(FullMVSTreeSchema.nodes.structure.params.fields, ['block_header', 'block_index']),\n            }),\n        },\n        /** Auxiliary node corresponding to Molstar's ModelFromTrajectory. */\n        model: {\n            description: \"Auxiliary node corresponding to Molstar's ModelFromTrajectory.\",\n            parent: ['trajectory'],\n            params: SimpleParamsSchema(pickObjectKeys(FullMVSTreeSchema.nodes.structure.params.fields, ['model_index'])),\n        },\n        /** Auxiliary node corresponding to Molstar's StructureFromModel. */\n        structure: {\n            ...FullMVSTreeSchema.nodes.structure,\n            parent: ['model'],\n            params: SimpleParamsSchema(omitObjectKeys(FullMVSTreeSchema.nodes.structure.params.fields, ['block_header', 'block_index', 'model_index'])),\n        },\n    }\n});\n", "/**\n * Copyright (c) 2023-2025 mol* contributors, licensed under MIT, See LICENSE file for more info.\n *\n * @author Adam Midlik <midlik@gmail.com>\n * @author David Sehnal <david.sehnal@gmail.com>\n * @author Aliaksei Chareshneu <chareshneu.tech@gmail.com>\n */\nimport { PluginStateSnapshotManager } from '../../mol-plugin-state/manager/snapshots';\nimport { PluginStateObject } from '../../mol-plugin-state/objects';\nimport { Download, ParseCcp4, ParseCif } from '../../mol-plugin-state/transforms/data';\nimport { CustomModelProperties, CustomStructureProperties, ModelFromTrajectory, StructureComponent, StructureFromModel, TrajectoryFromMmCif, TrajectoryFromPDB, TransformStructureConformation } from '../../mol-plugin-state/transforms/model';\nimport { ShapeRepresentation3D, StructureRepresentation3D, VolumeRepresentation3D } from '../../mol-plugin-state/transforms/representation';\nimport { VolumeFromCcp4, VolumeFromDensityServerCif } from '../../mol-plugin-state/transforms/volume';\nimport { PluginCommands } from '../../mol-plugin/commands';\nimport { MolViewSpec } from './behavior';\nimport { createPluginStateSnapshotCamera, modifyCanvasProps } from './camera';\nimport { MVSAnnotationsProvider } from './components/annotation-prop';\nimport { MVSAnnotationStructureComponent } from './components/annotation-structure-component';\nimport { MVSAnnotationTooltipsProvider } from './components/annotation-tooltips-prop';\nimport { CustomLabelRepresentationProvider } from './components/custom-label/representation';\nimport { CustomTooltipsProvider } from './components/custom-tooltips-prop';\nimport { IsMVSModelProvider } from './components/is-mvs-model-prop';\nimport { getPrimitiveStructureRefs, MVSBuildPrimitiveShape, MVSDownloadPrimitiveData, MVSInlinePrimitiveData } from './components/primitives';\nimport { IsHiddenCustomStateExtension } from './load-extensions/is-hidden-custom-state';\nimport { NonCovalentInteractionsExtension } from './load-extensions/non-covalent-interactions';\nimport { loadTreeVirtual, UpdateTarget } from './load-generic';\nimport { collectAnnotationReferences, collectAnnotationTooltips, collectInlineLabels, collectInlineTooltips, colorThemeForNode, componentFromXProps, componentPropsFromSelector, isPhantomComponent, labelFromXProps, makeNearestReprMap, prettyNameFromSelector, representationProps, structureProps, transformProps, volumeColorThemeForNode, volumeRepresentationProps } from './load-helpers';\nimport { MVSData } from './mvs-data';\nimport { validateTree } from './tree/generic/tree-schema';\nimport { convertMvsToMolstar, mvsSanityCheck } from './tree/molstar/conversion';\nimport { MolstarTreeSchema } from './tree/molstar/molstar-tree';\nimport { MVSTreeSchema } from './tree/mvs/mvs-tree';\n/** Load a MolViewSpec (MVS) state(s) into the Mol* plugin as plugin state snapshots. */\nexport async function loadMVS(plugin, data, options = {}) {\n    plugin.errorContext.clear('mvs');\n    try {\n        const mvsExtensionLoaded = plugin.state.hasBehavior(MolViewSpec);\n        if (!mvsExtensionLoaded)\n            throw new Error('MolViewSpec extension is not loaded.');\n        // console.log(`MVS tree:\\n${MVSData.toPrettyString(data)}`)\n        const multiData = data.kind === 'multiple' ? data : MVSData.stateToStates(data);\n        const entries = [];\n        for (let i = 0; i < multiData.snapshots.length; i++) {\n            const snapshot = multiData.snapshots[i];\n            const previousSnapshot = i > 0 ? multiData.snapshots[i - 1] : multiData.snapshots[multiData.snapshots.length - 1];\n            validateTree(MVSTreeSchema, snapshot.root, 'MVS');\n            if (options.sanityChecks)\n                mvsSanityCheck(snapshot.root);\n            const molstarTree = convertMvsToMolstar(snapshot.root, options.sourceUrl);\n            validateTree(MolstarTreeSchema, molstarTree, 'Converted Molstar');\n            const entry = molstarTreeToEntry(plugin, molstarTree, { ...snapshot.metadata, previousTransitionDurationMs: previousSnapshot.metadata.transition_duration_ms }, options);\n            entries.push(entry);\n        }\n        if (!options.appendSnapshots) {\n            plugin.managers.snapshot.clear();\n        }\n        for (const entry of entries) {\n            plugin.managers.snapshot.add(entry);\n        }\n        if (entries.length > 0) {\n            await PluginCommands.State.Snapshots.Apply(plugin, { id: entries[0].snapshot.id });\n        }\n    }\n    catch (err) {\n        plugin.log.error(`${err}`);\n        throw err;\n    }\n    finally {\n        if (!options.doNotReportErrors) {\n            for (const error of plugin.errorContext.get('mvs')) {\n                plugin.log.warn(error);\n                PluginCommands.Toast.Show(plugin, {\n                    title: 'Error',\n                    message: error,\n                    timeoutMs: 10000\n                });\n            }\n        }\n        plugin.errorContext.clear('mvs');\n    }\n}\nfunction molstarTreeToEntry(plugin, tree, metadata, options) {\n    var _a, _b, _c;\n    const context = MolstarLoadingContext.create();\n    const snapshot = loadTreeVirtual(plugin, tree, MolstarLoadingActions, context, { replaceExisting: true, extensions: (_a = options === null || options === void 0 ? void 0 : options.extensions) !== null && _a !== void 0 ? _a : BuiltinLoadingExtensions });\n    snapshot.canvas3d = {\n        props: plugin.canvas3d ? modifyCanvasProps(plugin.canvas3d.props, context.canvas) : undefined,\n    };\n    if (!(options === null || options === void 0 ? void 0 : options.keepCamera)) {\n        snapshot.camera = createPluginStateSnapshotCamera(plugin, context, metadata);\n    }\n    snapshot.durationInMs = metadata.linger_duration_ms + ((_b = metadata.previousTransitionDurationMs) !== null && _b !== void 0 ? _b : 0);\n    const entryParams = {\n        key: metadata.key,\n        name: metadata.title,\n        description: metadata.description,\n        descriptionFormat: (_c = metadata.description_format) !== null && _c !== void 0 ? _c : 'markdown',\n    };\n    const entry = PluginStateSnapshotManager.Entry(snapshot, entryParams);\n    return entry;\n}\nexport const MolstarLoadingContext = {\n    create() {\n        return {\n            annotationMap: new Map(),\n            camera: { focuses: [] },\n        };\n    },\n};\n/** Loading actions for loading a `MolstarTree`, per node kind. */\nconst MolstarLoadingActions = {\n    root(updateParent, node, context) {\n        context.nearestReprMap = makeNearestReprMap(node);\n        return updateParent;\n    },\n    download(updateParent, node) {\n        return UpdateTarget.apply(updateParent, Download, {\n            url: node.params.url,\n            isBinary: node.params.is_binary,\n        });\n    },\n    parse(updateParent, node) {\n        const format = node.params.format;\n        if (format === 'cif') {\n            return UpdateTarget.apply(updateParent, ParseCif, {});\n        }\n        else if (format === 'pdb') {\n            return updateParent;\n        }\n        else if (format === 'map') {\n            return UpdateTarget.apply(updateParent, ParseCcp4, {});\n        }\n        else {\n            console.error(`Unknown format in \"parse\" node: \"${format}\"`);\n            return undefined;\n        }\n    },\n    trajectory(updateParent, node) {\n        var _a, _b;\n        const format = node.params.format;\n        if (format === 'cif') {\n            return UpdateTarget.apply(updateParent, TrajectoryFromMmCif, {\n                blockHeader: (_a = node.params.block_header) !== null && _a !== void 0 ? _a : '', // Must set to '' because just undefined would get overwritten by createDefaults\n                blockIndex: (_b = node.params.block_index) !== null && _b !== void 0 ? _b : undefined,\n            });\n        }\n        else if (format === 'pdb') {\n            return UpdateTarget.apply(updateParent, TrajectoryFromPDB, {});\n        }\n        else {\n            console.error(`Unknown format in \"trajectory\" node: \"${format}\"`);\n            return undefined;\n        }\n    },\n    model(updateParent, node, context) {\n        const annotations = collectAnnotationReferences(node, context);\n        const model = UpdateTarget.apply(updateParent, ModelFromTrajectory, {\n            modelIndex: node.params.model_index,\n        });\n        UpdateTarget.apply(model, CustomModelProperties, {\n            properties: {\n                [IsMVSModelProvider.descriptor.name]: { isMvs: true },\n                [MVSAnnotationsProvider.descriptor.name]: { annotations },\n            },\n            autoAttach: [\n                IsMVSModelProvider.descriptor.name,\n                MVSAnnotationsProvider.descriptor.name,\n            ],\n        });\n        return model;\n    },\n    structure(updateParent, node, context) {\n        var _a;\n        const props = structureProps(node);\n        const struct = UpdateTarget.apply(updateParent, StructureFromModel, props);\n        let transformed = struct;\n        for (const t of transformProps(node)) {\n            transformed = UpdateTarget.apply(transformed, TransformStructureConformation, t); // applying to the result of previous transform, to get the correct transform order\n        }\n        const annotationTooltips = collectAnnotationTooltips(node, context);\n        const inlineTooltips = collectInlineTooltips(node, context);\n        if (annotationTooltips.length + inlineTooltips.length > 0) {\n            UpdateTarget.apply(struct, CustomStructureProperties, {\n                properties: {\n                    [MVSAnnotationTooltipsProvider.descriptor.name]: { tooltips: annotationTooltips },\n                    [CustomTooltipsProvider.descriptor.name]: { tooltips: inlineTooltips },\n                },\n                autoAttach: [\n                    MVSAnnotationTooltipsProvider.descriptor.name,\n                    CustomTooltipsProvider.descriptor.name,\n                ],\n            });\n        }\n        const inlineLabels = collectInlineLabels(node, context);\n        if (inlineLabels.length > 0) {\n            const nearestReprNode = (_a = context.nearestReprMap) === null || _a === void 0 ? void 0 : _a.get(node);\n            UpdateTarget.apply(struct, StructureRepresentation3D, {\n                type: {\n                    name: CustomLabelRepresentationProvider.name,\n                    params: { items: inlineLabels },\n                },\n                colorTheme: colorThemeForNode(nearestReprNode, context),\n            });\n        }\n        return struct;\n    },\n    tooltip: undefined, // No action needed, already loaded in `structure`\n    tooltip_from_uri: undefined, // No action needed, already loaded in `structure`\n    tooltip_from_source: undefined, // No action needed, already loaded in `structure`\n    component(updateParent, node) {\n        if (isPhantomComponent(node)) {\n            return updateParent;\n        }\n        const selector = node.params.selector;\n        return UpdateTarget.apply(updateParent, StructureComponent, {\n            type: componentPropsFromSelector(selector),\n            label: prettyNameFromSelector(selector),\n            nullIfEmpty: false,\n        });\n    },\n    component_from_uri(updateParent, node, context) {\n        if (isPhantomComponent(node))\n            return undefined;\n        const props = componentFromXProps(node, context);\n        return UpdateTarget.apply(updateParent, MVSAnnotationStructureComponent, props);\n    },\n    component_from_source(updateParent, node, context) {\n        if (isPhantomComponent(node))\n            return undefined;\n        const props = componentFromXProps(node, context);\n        return UpdateTarget.apply(updateParent, MVSAnnotationStructureComponent, props);\n    },\n    representation(updateParent, node, context) {\n        return UpdateTarget.apply(updateParent, StructureRepresentation3D, {\n            ...representationProps(node),\n            colorTheme: colorThemeForNode(node, context),\n        });\n    },\n    volume(updateParent, node) {\n        var _a, _b;\n        if ((_a = updateParent.transformer) === null || _a === void 0 ? void 0 : _a.definition.to.includes(PluginStateObject.Format.Ccp4)) {\n            return UpdateTarget.apply(updateParent, VolumeFromCcp4, {});\n        }\n        else if ((_b = updateParent.transformer) === null || _b === void 0 ? void 0 : _b.definition.to.includes(PluginStateObject.Format.Cif)) {\n            return UpdateTarget.apply(updateParent, VolumeFromDensityServerCif, { blockHeader: node.params.channel_id || undefined });\n        }\n        else {\n            console.error(`Unsupported volume format`);\n            return undefined;\n        }\n    },\n    volume_representation(updateParent, node, context) {\n        return UpdateTarget.apply(updateParent, VolumeRepresentation3D, {\n            ...volumeRepresentationProps(node),\n            colorTheme: volumeColorThemeForNode(node, context),\n        });\n    },\n    color: undefined, // No action needed, already loaded in `representation`\n    color_from_uri: undefined, // No action needed, already loaded in `representation`\n    color_from_source: undefined, // No action needed, already loaded in `representation`\n    label: undefined, // No action needed, already loaded in `structure`\n    label_from_uri(updateParent, node, context) {\n        const props = labelFromXProps(node, context);\n        return UpdateTarget.apply(updateParent, StructureRepresentation3D, props);\n    },\n    label_from_source(updateParent, node, context) {\n        const props = labelFromXProps(node, context);\n        return UpdateTarget.apply(updateParent, StructureRepresentation3D, props);\n    },\n    focus(updateParent, node, context) {\n        context.camera.focuses.push({ target: updateParent.selector, params: node.params });\n        return updateParent;\n    },\n    camera(updateParent, node, context) {\n        context.camera.cameraParams = node.params;\n        return updateParent;\n    },\n    canvas(updateParent, node, context) {\n        context.canvas = node.params;\n        return updateParent;\n    },\n    primitives(updateParent, tree, context) {\n        const refs = getPrimitiveStructureRefs(tree);\n        const data = UpdateTarget.apply(updateParent, MVSInlinePrimitiveData, { node: tree });\n        return applyPrimitiveVisuals(data, refs);\n    },\n    primitives_from_uri(updateParent, tree, context) {\n        const data = UpdateTarget.apply(updateParent, MVSDownloadPrimitiveData, { uri: tree.params.uri, format: tree.params.format });\n        return applyPrimitiveVisuals(data, new Set(tree.params.references));\n    },\n};\nfunction applyPrimitiveVisuals(data, refs) {\n    const mesh = UpdateTarget.setMvsDependencies(UpdateTarget.apply(data, MVSBuildPrimitiveShape, { kind: 'mesh' }, { state: { isGhost: true } }), refs);\n    UpdateTarget.apply(mesh, ShapeRepresentation3D);\n    const labels = UpdateTarget.setMvsDependencies(UpdateTarget.apply(data, MVSBuildPrimitiveShape, { kind: 'labels' }, { state: { isGhost: true } }), refs);\n    UpdateTarget.apply(labels, ShapeRepresentation3D);\n    const lines = UpdateTarget.setMvsDependencies(UpdateTarget.apply(data, MVSBuildPrimitiveShape, { kind: 'lines' }, { state: { isGhost: true } }), refs);\n    UpdateTarget.apply(lines, ShapeRepresentation3D);\n    return data;\n}\nexport const BuiltinLoadingExtensions = [\n    NonCovalentInteractionsExtension,\n    IsHiddenCustomStateExtension,\n];\n"],
  "mappings": "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",
  "names": ["outFirstAtomIndex", "str", "ranges", "blockSpec", "createLabelText", "matches", "color", "_a", "isDefined", "sphere", "box", "_a", "_a"]
}
